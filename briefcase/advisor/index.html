<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Briefcase | Evelyn Partners Advisor Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:wght@500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2D2047;
            --primary-dark: #1E1530;
            --primary-light: #3D3060;
            --accent-gold: #C4A35A;
            --accent-gold-light: #D4B87A;
            --accent-teal: #34675C;
            --accent-coral: #E07065;
            --success: #2E7D5A;
            --success-light: #E8F5EE;
            --warning: #E09E45;
            --warning-light: #FEF7E8;
            --danger: #C75050;
            --danger-light: #FCEAEA;
            --info: #4A7EB8;
            --info-light: #EBF3FB;
            --white: #FFFFFF;
            --gray-50: #F9FAFB;
            --gray-100: #F2F4F7;
            --gray-200: #E4E7EC;
            --gray-300: #D0D5DD;
            --gray-400: #98A2B3;
            --gray-500: #667085;
            --gray-600: #475467;
            --gray-700: #344054;
            --gray-800: #1D2939;
            --gray-900: #101828;
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --shadow-sm: 0 1px 3px rgba(16,24,40,0.1);
            --shadow-md: 0 4px 8px -2px rgba(16,24,40,0.1);
            --shadow-lg: 0 12px 16px -4px rgba(16,24,40,0.08);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', -apple-system, sans-serif; background: var(--gray-50); color: var(--gray-800); line-height: 1.5; min-height: 100vh; }
        
        /* Login Screen */
        .login-screen {
            position: fixed;
            inset: 0;
            display: flex;
            z-index: 9999;
            transition: opacity 0.4s ease, visibility 0.4s ease;
        }
        .login-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        .login-branding {
            flex: 1;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 48px;
            position: relative;
            overflow: hidden;
        }
        .login-branding::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(196,163,90,0.1) 0%, transparent 70%);
            pointer-events: none;
        }
        .login-branding::after {
            content: '';
            position: absolute;
            bottom: -30%;
            left: -30%;
            width: 80%;
            height: 80%;
            background: radial-gradient(circle, rgba(52,103,92,0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        .login-logo {
            margin-bottom: 40px;
            position: relative;
            z-index: 1;
        }
        .login-logo svg {
            width: 200px;
            height: auto;
        }
        .login-tagline {
            text-align: center;
            position: relative;
            z-index: 1;
        }
        .login-tagline h2 {
            font-family: 'Playfair Display', serif;
            font-size: 32px;
            font-weight: 500;
            color: white;
            margin-bottom: 12px;
        }
        .login-tagline p {
            font-size: 16px;
            color: rgba(255,255,255,0.7);
            max-width: 300px;
        }
        .login-form-container {
            width: 100%;
            max-width: 480px;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 48px;
        }
        .login-header {
            margin-bottom: 32px;
        }
        .login-header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 8px;
        }
        .login-header p {
            font-size: 15px;
            color: var(--gray-500);
        }
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .form-group label {
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-700);
        }
        .form-input {
            padding: 12px 14px;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
        }
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(45,32,71,0.1);
        }
        .form-input::placeholder {
            color: var(--gray-400);
        }
        .form-input.error {
            border-color: var(--danger);
        }
        .password-input-wrap {
            position: relative;
        }
        .password-input-wrap .form-input {
            padding-right: 44px;
        }
        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray-400);
            cursor: pointer;
            padding: 4px;
        }
        .password-toggle:hover {
            color: var(--gray-600);
        }
        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }
        .remember-me {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        .remember-me input {
            width: 16px;
            height: 16px;
            accent-color: var(--primary);
        }
        .forgot-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }
        .forgot-link:hover {
            text-decoration: underline;
        }
        .login-btn {
            padding: 14px 24px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 15px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .login-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(45,32,71,0.3);
        }
        .login-btn:active {
            transform: translateY(0);
        }
        .login-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        .login-btn .spinner,
        .send-btn .spinner,
        .btn .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        .btn-secondary .spinner {
            border-color: rgba(45,32,71,0.2);
            border-top-color: var(--primary);
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .login-error {
            background: var(--danger-light);
            color: var(--danger);
            padding: 12px 14px;
            border-radius: var(--radius-md);
            font-size: 14px;
            display: none;
        }
        .login-error.show {
            display: block;
        }
        .login-divider {
            display: flex;
            align-items: center;
            gap: 16px;
            margin: 8px 0;
        }
        .login-divider span {
            font-size: 13px;
            color: var(--gray-400);
        }
        .login-divider::before,
        .login-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--gray-200);
        }
        .sso-btn {
            padding: 12px 24px;
            background: white;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: var(--gray-700);
        }
        .sso-btn:hover {
            background: var(--gray-50);
            border-color: var(--gray-400);
        }
        .login-footer {
            margin-top: 32px;
            text-align: center;
            font-size: 13px;
            color: var(--gray-500);
        }
        .login-footer a {
            color: var(--primary);
            text-decoration: none;
        }
        /* Mobile branding - shown when branding panel is hidden */
        .login-mobile-brand {
            display: none;
            text-align: center;
            margin-bottom: 32px;
        }
        .login-mobile-brand svg {
            height: 40px;
            width: auto;
            margin-bottom: 16px;
        }
        .login-mobile-brand .app-name {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            font-weight: 600;
            color: var(--primary);
        }
        
        /* Responsive login */
        @media (max-width: 900px) {
            .login-branding {
                display: none;
            }
            .login-form-container {
                max-width: 100%;
                justify-content: flex-start;
                padding-top: 60px;
            }
            .login-mobile-brand {
                display: block;
            }
        }
        @media (max-width: 480px) {
            .login-form-container {
                padding: 24px;
                padding-top: 40px;
            }
            .login-header h1 {
                font-size: 24px;
            }
        }
        
        /* Main Layout */
        .app-container { 
            display: flex; 
            min-height: 100vh; 
        }

        /* Sidebar */
        .sidebar { 
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%); 
            padding: 16px; 
            display: flex; 
            flex-direction: column; 
            width: 240px;
            min-width: 240px;
            height: 100vh; 
            position: sticky;
            top: 0;
            overflow-y: auto; 
            z-index: 50; 
        }
        
        /* Main content wrapper */
        .main-wrapper {
            flex: 1;
            min-width: 0;
        }
        
        .main-content { 
            padding: 28px; 
            min-height: 100vh; 
            min-width: 0;
        }
        .sidebar-logo { padding: 24px 24px 20px 24px; padding-right: 60px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
        .sidebar-logo svg { display: block; max-width: 100%; height: auto; }
        .nav-section { margin-bottom: 24px; }
        .nav-section-title { font-size: 10px; font-weight: 600; color: rgba(255,255,255,0.35); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 8px; padding: 0 12px; }
        .nav-item { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: var(--radius-md); color: rgba(255,255,255,0.65); cursor: pointer; transition: all 0.2s; margin-bottom: 2px; font-size: 14px; }
        .nav-item:hover { background: rgba(255,255,255,0.08); color: white; }
        .nav-item.active { background: rgba(255,255,255,0.12); color: white; }
        .nav-item-icon { width: 18px; height: 18px; opacity: 0.8; }
        .nav-badge { margin-left: auto; background: var(--accent-gold); color: var(--primary-dark); font-size: 10px; font-weight: 600; padding: 2px 7px; border-radius: 10px; }
        .sidebar-user-section {
            margin-top: 8px;
            padding-top: 16px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .sidebar-user-row { display: flex; align-items: center; }
        .advisor-switcher { background: rgba(255,255,255,0.06); border-radius: var(--radius-md); padding: 8px; margin-bottom: 12px; }
        .advisor-switcher select { width: 100%; background: transparent; border: none; color: white; font-size: 13px; font-family: inherit; padding: 4px; cursor: pointer; outline: none; }
        .advisor-switcher select option { background: var(--primary-dark); }
        .advisor-info { display: flex; align-items: center; gap: 10px; padding: 8px; flex: 1; }
        .advisor-avatar { width: 36px; height: 36px; border-radius: 50%; background: var(--accent-gold); display: flex; align-items: center; justify-content: center; font-weight: 600; color: var(--primary-dark); font-size: 13px; }
        .logout-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            color: rgba(255,255,255,0.6);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            margin-right: 8px;
        }
        .logout-btn:hover {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        .advisor-name { font-size: 13px; font-weight: 600; color: white; }
        .advisor-role { font-size: 11px; color: rgba(255,255,255,0.5); }

        .page-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; }
        .page-title { font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 600; color: var(--gray-900); margin-bottom: 4px; }
        .page-subtitle { font-size: 14px; color: var(--gray-500); }
        .header-actions { display: flex; gap: 10px; }

        /* Buttons */
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 6px; padding: 9px 16px; border-radius: var(--radius-md); font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; border: none; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-secondary { background: white; color: var(--gray-700); border: 1px solid var(--gray-300); }
        .btn-secondary:hover { background: var(--gray-50); }
        .btn-gold { background: linear-gradient(135deg, var(--accent-gold) 0%, var(--accent-gold-light) 100%); color: var(--primary-dark); font-weight: 600; }
        .btn-gold:hover { filter: brightness(1.05); }
        .btn-ghost { background: transparent; color: var(--gray-600); padding: 6px 10px; }
        .btn-ghost:hover { background: var(--gray-100); }
        .btn-sm { padding: 6px 10px; font-size: 12px; }

        /* Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .stat-card { background: white; border-radius: var(--radius-lg); padding: 14px 16px; box-shadow: var(--shadow-sm); border: 1px solid var(--gray-100); }
        .stat-header { display: flex; align-items: center; gap: 12px; margin-bottom: 4px; }
        .stat-icon { width: 32px; height: 32px; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; }
        .stat-icon.gold { background: rgba(196,163,90,0.12); }
        .stat-icon.teal { background: rgba(52,103,92,0.12); }
        .stat-icon.coral { background: rgba(224,112,101,0.12); }
        .stat-icon.purple { background: rgba(45,32,71,0.1); }
        .stat-trend { font-size: 10px; font-weight: 600; display: flex; align-items: center; gap: 2px; margin-left: auto; }
        .stat-trend.up { color: var(--success); }
        .stat-value { font-size: 22px; font-weight: 700; color: var(--gray-900); line-height: 1; }
        .stat-label { font-size: 11px; color: var(--gray-500); margin-top: 2px; }

        /* Search & Filters */
        .toolbar { display: flex; gap: 12px; margin-bottom: 20px; }
        .search-box { flex: 1; position: relative; }
        .search-box input { width: 100%; padding: 10px 14px 10px 38px; border: 1px solid var(--gray-200); border-radius: var(--radius-md); font-size: 13px; background: white; }
        .search-box input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(45,32,71,0.1); }
        .search-box svg { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--gray-400); }
        .filter-btn { display: flex; align-items: center; gap: 6px; padding: 10px 14px; background: white; border: 1px solid var(--gray-200); border-radius: var(--radius-md); font-size: 13px; color: var(--gray-600); cursor: pointer; }
        .filter-btn:hover { background: var(--gray-50); }

        /* Tabs */
        .tabs { display: flex; gap: 4px; background: var(--gray-100); padding: 4px; border-radius: var(--radius-md); margin-bottom: 20px; width: fit-content; }
        .tab { padding: 7px 14px; border-radius: var(--radius-sm); font-size: 13px; font-weight: 500; color: var(--gray-600); cursor: pointer; border: none; background: transparent; }
        .tab:hover { color: var(--gray-800); }
        .tab.active { background: white; color: var(--gray-900); box-shadow: var(--shadow-sm); }

        /* Client List - Mobile First Design */
        .client-list { display: flex; flex-direction: column; gap: 12px; }
        
        .client-row { 
            background: white; 
            border-radius: var(--radius-lg); 
            box-shadow: var(--shadow-sm); 
            border: 1px solid var(--gray-100); 
            padding: 16px; 
            cursor: pointer; 
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        .client-row:hover { box-shadow: var(--shadow-md); border-color: var(--gray-200); }
        .client-row.selected { border-color: var(--accent-gold); box-shadow: 0 0 0 3px rgba(196,163,90,0.15); }
        
        /* Card Header - Two rows: Top row and Meta row */
        .client-header {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .client-avatar { 
            width: 48px; 
            height: 48px; 
            min-width: 48px;
            border-radius: 50%; 
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: 600; 
            color: white; 
            font-size: 15px; 
        }
        .client-avatar.joint { background: linear-gradient(135deg, var(--accent-teal) 0%, #4A8A7A 100%); }
        .client-avatar.ie { background: linear-gradient(135deg, #1B5E20 0%, #2E7D32 100%); }
        
        .client-main {
            flex: 1;
            min-width: 0;
        }
        
        .client-top-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 4px;
        }
        
        .client-name { 
            font-size: 16px; 
            font-weight: 600; 
            color: var(--gray-900);
            line-height: 1.3;
        }
        
        .status-badge { 
            display: inline-flex; 
            align-items: center; 
            gap: 4px; 
            font-size: 11px; 
            font-weight: 500; 
            padding: 4px 10px; 
            border-radius: 12px; 
            white-space: nowrap;
            flex-shrink: 0;
        }
        .status-badge.draft { background: var(--gray-100); color: var(--gray-600); }
        .status-badge.sent { background: var(--info-light); color: var(--info); }
        .status-badge.in-progress { background: var(--warning-light); color: var(--warning); }
        .status-badge.complete { background: var(--success-light); color: var(--success); }
        
        .client-meta-row {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .client-type-badge {
            font-size: 9px; 
            font-weight: 600; 
            padding: 3px 6px; 
            border-radius: 4px; 
            text-transform: uppercase; 
            letter-spacing: 0.3px;
        }
        .client-type-badge.joint { background: var(--success-light); color: var(--success); }
        .client-type-badge.individual { background: var(--info-light); color: var(--info); }
        
        .client-meta { 
            font-size: 13px; 
            color: var(--gray-500);
        }
        
        /* Card Footer - Proposition + Progress */
        .client-footer {
            display: flex;
            align-items: center;
            gap: 24px;
            padding-top: 12px;
            border-top: 1px solid var(--gray-100);
        }
        
        .client-detail {
            display: flex;
            flex-direction: column;
            gap: 2px;
            flex-shrink: 0;
        }
        
        .detail-label { 
            font-size: 10px; 
            color: var(--gray-400); 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
        }
        .detail-value { 
            font-size: 14px; 
            font-weight: 600; 
            color: var(--gray-700); 
        }
        
        .client-progress-wrap {
            flex: 1;
            min-width: 100px;
        }
        .progress-bar-bg { 
            height: 8px; 
            background: var(--gray-100); 
            border-radius: 4px; 
            overflow: hidden; 
            margin-bottom: 4px; 
        }
        .progress-bar-fill { 
            height: 100%; 
            border-radius: 4px; 
            transition: width 0.3s; 
        }
        .progress-bar-fill.low { background: var(--gray-300); }
        .progress-bar-fill.started { background: var(--warning); }
        .progress-bar-fill.partial { background: var(--info); }
        .progress-bar-fill.complete { background: var(--success); }
        .progress-text { font-size: 12px; color: var(--gray-500); }

        /* Right Panel */
        /* Right Panel - Always fixed position, visible on large screens, overlay on smaller */
        .panel { 
            position: fixed;
            right: 0;
            top: 0;
            width: 380px;
            height: 100vh; 
            background: white; 
            border-left: 1px solid var(--gray-200); 
            display: flex; 
            flex-direction: column; 
            z-index: 200;
            overflow: hidden;
        }
        
        /* Panel backdrop - hidden by default */
        .panel-backdrop {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            z-index: 199;
            cursor: pointer;
        }
        
        /* Large desktop: Panel visible, main content has margin for it */
        @media (min-width: 1281px) {
            .main-content {
                margin-right: 380px;
            }
        }
        
        /* Tablet/Small Desktop: Panel slides in/out */
        @media (max-width: 1280px) {
            .main-content {
                margin-right: 0;
            }
            .panel {
                box-shadow: -8px 0 30px rgba(0,0,0,0.2);
                transform: translateX(100%);
                transition: transform 0.3s ease;
            }
            .panel.open {
                transform: translateX(0);
            }
            .panel-backdrop.open {
                display: block;
            }
        }
        
        /* Mobile: Smaller panel */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
                min-width: 200px;
            }
            .panel {
                width: 100%;
                max-width: 100%;
                height: 100%;
                max-height: 100vh;
                max-height: 100dvh; /* Dynamic viewport height for mobile browsers */
            }
            .panel-body {
                flex: 1;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                min-height: 0; /* Important for flex scroll */
            }
            .panel-footer {
                flex-shrink: 0;
                padding-bottom: max(16px, env(safe-area-inset-bottom));
            }
            .main-content {
                padding: 20px;
            }
        }
        
        /* Mobile header - hidden by default, shown on small screens */
        .mobile-header {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--primary);
            z-index: 100;
            align-items: center;
            padding: 0 12px;
            gap: 12px;
        }
        .mobile-menu-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }
        .mobile-menu-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        .mobile-header-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0;
        }
        .mobile-header-logo svg {
            height: 22px;
            width: 90px;
            display: block;
            flex-shrink: 0;
        }
        .mobile-header-divider {
            width: 1px;
            height: 28px;
            background: rgba(255,255,255,0.2);
            flex-shrink: 0;
        }
        .mobile-header-title {
            font-family: 'Playfair Display', serif;
            font-size: 16px;
            font-weight: 600;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .sidebar-close-btn {
            display: none;
            position: absolute;
            top: 20px;
            right: 20px;
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(255,255,255,0.15);
            border-radius: 6px;
            cursor: pointer;
            color: white;
            font-size: 16px;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .sidebar-close-btn:hover {
            background: rgba(255,255,255,0.25);
        }
        .sidebar-backdrop {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 299;
        }
        
        /* Very small screens: Show mobile header, collapsible sidebar */
        @media (max-width: 600px) {
            .mobile-header {
                display: flex;
            }
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                z-index: 300;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .sidebar-close-btn {
                display: flex;
            }
            .sidebar-backdrop.open {
                display: block;
            }
            .main-wrapper {
                margin-left: 0;
            }
            .main-content {
                padding: 16px;
                padding-top: 76px;
            }
            .page-header {
                display: none;
            }
        }
        .panel-header { padding: 20px; border-bottom: 1px solid var(--gray-100); background: linear-gradient(135deg, var(--gray-50) 0%, white 100%); display: flex; align-items: flex-start; justify-content: space-between; gap: 12px; }
        .panel-header-content { flex: 1; min-width: 0; }
        .panel-close-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--gray-100);
            border-radius: 8px;
            color: var(--gray-500);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s;
        }
        .panel-close-btn:hover {
            background: var(--gray-200);
            color: var(--gray-700);
        }
        .panel-title { font-family: 'Playfair Display', serif; font-size: 18px; font-weight: 600; color: var(--gray-900); display: flex; align-items: center; gap: 10px; margin-bottom: 4px; }
        .panel-title-icon { width: 28px; height: 28px; background: linear-gradient(135deg, var(--accent-gold) 0%, var(--accent-gold-light) 100%); border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; font-size: 14px; }
        .panel-subtitle { font-size: 12px; color: var(--gray-500); }
        .panel-body { flex: 1; overflow-y: auto; padding: 20px; }
        .panel-footer { padding: 16px 20px; border-top: 1px solid var(--gray-100); background: var(--gray-50); }

        /* Panel Sections */
        .panel-section { margin-bottom: 20px; }
        .panel-section-title { font-size: 12px; font-weight: 600; color: var(--gray-700); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
        
        /* Selected Client Card */
        .selected-client { background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: var(--radius-md); padding: 14px; margin-bottom: 16px; }
        .selected-client-header { display: flex; align-items: center; gap: 12px; }
        .selected-client-avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 600; color: white; font-size: 13px; }
        .selected-client-info { flex: 1; }
        .selected-client-name { font-weight: 600; color: var(--gray-900); font-size: 14px; }
        .selected-client-detail { font-size: 12px; color: var(--gray-500); }
        .remove-btn { width: 28px; height: 28px; border-radius: 50%; background: var(--gray-100); border: none; cursor: pointer; color: var(--gray-400); display: flex; align-items: center; justify-content: center; }
        .remove-btn:hover { background: var(--danger-light); color: var(--danger); }

        /* Advice Summary */
        .advice-summary { background: linear-gradient(135deg, rgba(45,32,71,0.04) 0%, rgba(196,163,90,0.08) 100%); border: 1px solid rgba(196,163,90,0.2); border-radius: var(--radius-md); padding: 14px; margin-bottom: 16px; }
        .advice-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid rgba(196,163,90,0.15); }
        .advice-row:last-child { border-bottom: none; }
        .advice-label { font-size: 12px; color: var(--gray-500); }
        .advice-value { font-size: 12px; font-weight: 600; color: var(--gray-800); }

        /* Entity & Proposition Selectors */
        .selector-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 16px; }
        .selector-option { padding: 12px; border: 1px solid var(--gray-200); border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s; background: white; text-align: center; }
        .selector-option:hover { border-color: var(--gray-300); }
        .selector-option.selected { border-color: var(--accent-gold); background: rgba(196,163,90,0.05); }
        .selector-option.disabled { opacity: 0.4; cursor: not-allowed; }
        .selector-icon { font-size: 20px; margin-bottom: 4px; }
        .selector-label { font-size: 12px; font-weight: 600; color: var(--gray-700); }
        .selector-desc { font-size: 10px; color: var(--gray-500); }

        /* Form Options */
        .form-option { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border: 1px solid var(--gray-200); border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s; margin-bottom: 6px; background: white; }
        .form-option:hover { border-color: var(--gray-300); background: var(--gray-50); }
        .form-option.selected { border-color: var(--accent-gold); background: rgba(196,163,90,0.05); }
        .form-option.required { border-left: 3px solid var(--accent-gold); }
        .form-option.disabled { opacity: 0.5; cursor: not-allowed; }
        .form-checkbox { width: 18px; height: 18px; border: 2px solid var(--gray-300); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: white; transition: all 0.2s; flex-shrink: 0; }
        .form-option.selected .form-checkbox { background: var(--accent-gold); border-color: var(--accent-gold); }
        .form-icon { width: 32px; height: 32px; border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; }
        .form-icon.factfind { background: rgba(196,163,90,0.15); }
        .form-icon.isa { background: rgba(40,167,69,0.1); }
        .form-icon.jisa { background: rgba(233,30,99,0.1); }
        .form-icon.sipp { background: rgba(45,32,71,0.1); }
        .form-icon.gia { background: rgba(44,123,229,0.1); }
        .form-icon.aim { background: rgba(255,107,53,0.1); }
        .form-icon.agreement { background: rgba(45,32,71,0.08); }
        .form-info { flex: 1; min-width: 0; }
        .form-name { font-size: 13px; font-weight: 500; color: var(--gray-800); }
        .form-desc { font-size: 11px; color: var(--gray-500); }
        .form-badge { font-size: 9px; padding: 2px 6px; border-radius: 3px; background: var(--accent-gold); color: var(--primary-dark); font-weight: 600; }

        /* Delivery Options */
        .delivery-options { display: flex; flex-direction: column; gap: 8px; }
        .delivery-option { display: flex; align-items: center; gap: 12px; padding: 12px 14px; border: 1px solid var(--gray-200); border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s; background: white; }
        .delivery-option:hover { border-color: var(--gray-300); background: var(--gray-50); }
        .delivery-option.selected { border-color: var(--primary); background: rgba(45,32,71,0.04); }
        .delivery-icon { font-size: 20px; flex-shrink: 0; }
        .delivery-info { flex: 1; }
        .delivery-name { font-size: 13px; font-weight: 600; color: var(--gray-800); }
        .delivery-desc { font-size: 11px; color: var(--gray-500); }
        .delivery-check { width: 20px; height: 20px; border: 2px solid var(--gray-300); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; color: white; transition: all 0.2s; flex-shrink: 0; }
        .delivery-option.selected .delivery-check { background: var(--primary); border-color: var(--primary); }

        /* Message */
        .message-textarea { width: 100%; padding: 12px; border: 1px solid var(--gray-200); border-radius: var(--radius-md); font-family: inherit; font-size: 13px; resize: vertical; min-height: 80px; }
        .message-textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(45,32,71,0.1); }
        .optional-label { font-weight: 400; color: var(--gray-400); font-size: 11px; }
        .template-btns { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
        .template-btn { padding: 4px 8px; background: var(--gray-100); border: none; border-radius: var(--radius-sm); font-size: 10px; color: var(--gray-600); cursor: pointer; }
        .template-btn:hover { background: var(--gray-200); }

        /* Send Summary */
        .send-summary { display: flex; gap: 12px; margin-bottom: 12px; }
        .send-summary-item { flex: 1; background: white; border: 1px solid var(--gray-200); border-radius: var(--radius-md); padding: 10px; text-align: center; }
        .send-summary-label { font-size: 10px; color: var(--gray-500); margin-bottom: 2px; }
        .send-summary-value { font-size: 13px; font-weight: 600; color: var(--gray-800); }
        .send-btn { width: 100%; padding: 14px; background: linear-gradient(135deg, var(--accent-gold) 0%, var(--accent-gold-light) 100%); border: none; border-radius: var(--radius-md); font-size: 14px; font-weight: 600; color: var(--primary-dark); cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s; }
        .send-btn:hover { filter: brightness(1.05); transform: translateY(-1px); }
        .send-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        /* Sent Briefcase View */
        .sent-progress-card {
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-bottom: 16px;
        }
        .sent-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .sent-progress-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-700);
        }
        .sent-progress-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }
        .sent-progress-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .sent-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-teal) 0%, var(--success) 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .sent-progress-meta {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--gray-500);
        }
        
        /* Form Progress Cards */
        .form-progress-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .form-progress-card:hover {
            border-color: var(--gray-300);
            box-shadow: var(--shadow-sm);
        }
        .form-progress-card.complete {
            border-color: var(--success);
            background: var(--success-light);
        }
        .form-progress-card.in-progress {
            border-color: var(--warning);
            background: var(--warning-light);
        }
        .form-progress-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            background: var(--gray-100);
        }
        .form-progress-info {
            flex: 1;
            min-width: 0;
        }
        .form-progress-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 6px;
        }
        .form-progress-bar-wrap {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .form-progress-bar {
            flex: 1;
            height: 6px;
            background: var(--gray-200);
            border-radius: 3px;
            overflow: hidden;
        }
        .form-progress-card.complete .form-progress-bar {
            background: rgba(255,255,255,0.5);
        }
        .form-progress-card.in-progress .form-progress-bar {
            background: rgba(255,255,255,0.5);
        }
        .form-progress-bar-fill {
            height: 100%;
            background: var(--success);
            border-radius: 3px;
        }
        .form-progress-card.in-progress .form-progress-bar-fill {
            background: var(--warning);
        }
        .form-progress-status {
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
        }
        .form-progress-status.complete { color: var(--success); }
        .form-progress-status.in-progress { color: var(--warning); }
        .form-progress-status.pending { color: var(--gray-400); }
        .form-progress-action {
            font-size: 16px;
            color: var(--gray-400);
        }
        .form-progress-card:hover .form-progress-action {
            color: var(--primary);
        }
        
        /* Sent Actions */
        .sent-actions {
            display: flex;
            gap: 10px;
        }
        .sent-actions .btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        /* Empty State */
        .empty-state { text-align: center; padding: 40px 20px; color: var(--gray-400); }
        .empty-state-icon { font-size: 48px; margin-bottom: 12px; opacity: 0.5; }
        .empty-state-text { font-size: 14px; margin-bottom: 4px; }
        .empty-state-hint { font-size: 12px; }

        /* Modal */
        .modal-overlay { position: fixed; inset: 0; background: rgba(16,24,40,0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s; backdrop-filter: blur(4px); }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal { background: white; border-radius: var(--radius-xl); width: 100%; max-width: 480px; transform: scale(0.95) translateY(10px); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); margin: 20px; }
        .modal-overlay.show .modal { transform: scale(1) translateY(0); }
        .modal-body { padding: 32px; text-align: center; }
        .modal-icon { width: 64px; height: 64px; background: var(--success-light); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 32px; color: var(--success); }
        .modal-title { font-family: 'Playfair Display', serif; font-size: 24px; font-weight: 600; color: var(--gray-900); margin-bottom: 8px; }
        .modal-message { font-size: 14px; color: var(--gray-600); margin-bottom: 24px; line-height: 1.6; }
        .modal-details { background: var(--gray-50); border-radius: var(--radius-md); padding: 16px; text-align: left; margin-bottom: 24px; }
        .modal-detail-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--gray-100); font-size: 13px; }
        .modal-detail-row:last-child { border-bottom: none; }
        .modal-detail-label { color: var(--gray-500); }
        .modal-detail-value { font-weight: 500; color: var(--gray-800); }
        
        /* Animated Checkmark */
        .success-checkmark {
            animation: fadeInScale 0.4s ease;
        }
        .success-checkmark svg {
            color: var(--success);
        }
        .checkmark-circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            animation: checkmarkCircle 0.6s 0.1s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }
        .checkmark-check {
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: checkmarkCheck 0.3s 0.5s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }
        @keyframes checkmarkCircle {
            to { stroke-dashoffset: 0; }
        }
        @keyframes checkmarkCheck {
            to { stroke-dashoffset: 0; }
        }

        /* Animations */
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(8px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        @keyframes checkmark {
            0% { stroke-dashoffset: 100; }
            100% { stroke-dashoffset: 0; }
        }
        @keyframes ripple {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(4); opacity: 0; }
        }
        
        /* Staggered list animations */
        .client-row { 
            animation: fadeIn 0.4s ease forwards; 
            opacity: 0;
        }
        .client-row:nth-child(1) { animation-delay: 0.05s; }
        .client-row:nth-child(2) { animation-delay: 0.1s; }
        .client-row:nth-child(3) { animation-delay: 0.15s; }
        .client-row:nth-child(4) { animation-delay: 0.2s; }
        .client-row:nth-child(5) { animation-delay: 0.25s; }
        .client-row:nth-child(6) { animation-delay: 0.3s; }
        
        /* Stat cards animation */
        .stat-card {
            animation: fadeInScale 0.5s ease forwards;
            opacity: 0;
        }
        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.2s; }
        .stat-card:nth-child(3) { animation-delay: 0.3s; }
        .stat-card:nth-child(4) { animation-delay: 0.4s; }
        
        /* Hover lift effect */
        .client-row,
        .stat-card,
        .form-option,
        .form-progress-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        }
        .client-row:hover,
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        /* Button press effect */
        .btn,
        .send-btn,
        .login-btn,
        .sso-btn {
            position: relative;
            overflow: hidden;
        }
        .btn:active,
        .send-btn:active,
        .login-btn:active,
        .sso-btn:active {
            transform: scale(0.98);
        }
        
        /* Progress bar animations */
        .progress-bar-fill,
        .sent-progress-fill,
        .form-progress-bar-fill {
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Panel slide animation */
        .panel {
            transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.35s ease;
        }
        
        /* Selected client highlight pulse */
        .client-row.selected {
            animation: none;
            opacity: 1;
        }
        .client-row.selected::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--primary);
            border-radius: 0 2px 2px 0;
            animation: slideInLeft 0.3s ease;
        }
        
        /* Form option selection animation */
        .form-option .form-checkbox {
            transition: all 0.2s ease;
        }
        .form-option.selected .form-checkbox {
            animation: pulse 0.3s ease;
        }
        
        /* Status badge animations */
        .status-badge {
            transition: all 0.2s ease;
        }
        .status-badge.sent,
        .status-badge.in-progress {
            animation: pulse 2s ease-in-out infinite;
        }
        
        /* Loading shimmer effect for skeleton states */
        .skeleton {
            background: linear-gradient(90deg, var(--gray-100) 25%, var(--gray-200) 50%, var(--gray-100) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius-md);
        }
        
        /* Tooltip styles */
        [data-tooltip] {
            position: relative;
        }
        [data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-4px);
            padding: 6px 10px;
            background: var(--gray-900);
            color: white;
            font-size: 12px;
            font-weight: 500;
            border-radius: 6px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            pointer-events: none;
            z-index: 100;
        }
        [data-tooltip]:hover::after {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-8px);
        }
        
        /* Focus ring for accessibility */
        .btn:focus-visible,
        .form-input:focus-visible,
        .client-row:focus-visible,
        .form-option:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        
        /* Smooth scrolling */
        .panel-body,
        .client-list {
            scroll-behavior: smooth;
        }
        
        /* Login screen animations */
        .login-form-container {
            animation: slideInRight 0.5s ease;
        }
        .login-branding {
            animation: fadeIn 0.6s ease;
        }
        .login-mobile-brand {
            animation: fadeInScale 0.5s ease;
        }
        
        /* Success modal icon animation */
        .modal-icon {
            animation: fadeInScale 0.4s ease 0.2s both;
        }
        
        /* Empty state animation */
        .empty-state {
            animation: fadeIn 0.5s ease;
        }
        .empty-state-icon {
            animation: pulse 3s ease-in-out infinite;
        }
        
        /* Tab active indicator animation */
        .tab.active::after {
            animation: slideInLeft 0.2s ease;
        }
        
        /* Avatar hover effect */
        .client-avatar,
        .advisor-avatar,
        .selected-client-avatar {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .client-row:hover .client-avatar {
            transform: scale(1.05);
        }
        
        /* Gold accent shimmer on send button */
        .send-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }
        .send-btn:hover::before {
            left: 100%;
        }
        
        /* Form modal slide up animation */
        .form-modal {
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Notification dot pulse */
        .nav-count {
            position: relative;
        }
        .nav-count::after {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 50%;
            background: inherit;
            opacity: 0.4;
            animation: pulse 2s ease-in-out infinite;
            z-index: -1;
        }
        
        /* Reduced motion preference */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Fact Find Section Selector */
        .factfind-section-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .factfind-section-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
        }
        .factfind-section-item:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-sm);
        }
        .factfind-section-item.complete {
            border-color: var(--success);
            background: var(--success-light);
        }
        .factfind-section-item.in-progress {
            border-color: var(--warning);
            background: var(--warning-light);
        }
        .factfind-section-num {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 13px;
            color: var(--gray-600);
        }
        .factfind-section-item.complete .factfind-section-num {
            background: var(--success);
            color: white;
        }
        .factfind-section-item.in-progress .factfind-section-num {
            background: var(--warning);
            color: white;
        }
        .factfind-section-info {
            flex: 1;
        }
        .factfind-section-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--gray-800);
            margin-bottom: 2px;
        }
        .factfind-section-status {
            font-size: 12px;
            color: var(--gray-500);
        }
        .factfind-section-item.complete .factfind-section-status {
            color: var(--success);
        }
        .factfind-section-item.in-progress .factfind-section-status {
            color: #92400E;
        }
        .factfind-section-arrow {
            color: var(--gray-400);
            font-size: 16px;
        }
        .factfind-section-item:hover .factfind-section-arrow {
            color: var(--primary);
        }
        
        /* Fullscreen Form Modal */
        .form-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .form-modal-overlay.show {
            display: block;
            opacity: 1;
        }
        .form-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }
        .form-modal-overlay.show .form-modal {
            transform: translateY(0);
        }
        .form-modal-header {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 20px;
            background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%);
            color: white;
            flex-shrink: 0;
        }
        .form-modal-close {
            width: 36px;
            height: 36px;
            border: none;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        .form-modal-close:hover {
            background: rgba(255,255,255,0.3);
        }
        .form-modal-title {
            flex: 1;
        }
        .form-modal-title h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 2px;
        }
        .form-modal-title span {
            font-size: 12px;
            opacity: 0.9;
        }
        .form-modal-actions {
            display: flex;
            gap: 8px;
        }
        .form-modal-btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            transition: all 0.2s;
        }
        .form-modal-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        .form-modal-btn.primary {
            background: white;
            color: #1E40AF;
            border-color: white;
        }
        .form-modal-btn.primary:hover {
            background: #f0f0f0;
        }
        .form-modal-iframe {
            flex: 1;
            border: none;
            width: 100%;
        }
        @media (max-width: 768px) {
            .form-modal-header {
                padding: 10px 12px;
            }
            .form-modal-title h3 {
                font-size: 14px;
            }
            .form-modal-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-branding">
            <div class="login-logo">
                <svg width="200" height="75" viewBox="0 0 173.61 65.85" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_login)">
                        <path d="M69.2642 56.0118V54.4309H61.6699V65.723H69.4058V64.1421H63.4496V60.6973H68.4753V59.2007H63.4496V56.0118H69.2642Z" fill="#C4A35A"/>
                        <path d="M49.6732 57.7613L56.054 65.723H57.5475V54.4309H55.7408V62.5612L49.2787 54.4309H47.8936V65.723H49.6732V57.7613Z" fill="#C4A35A"/>
                        <path d="M40.9768 65.723V56.0118H44.7318V54.4309H35.415V56.0118H39.2001V65.723H40.9768Z" fill="#C4A35A"/>
                        <path d="M32.8192 58.1016C32.8192 56.072 31.3347 54.4309 29.3171 54.4309H24.4028V65.723H26.1855V61.8084H28.8083L31.2383 65.723H33.2408L30.5879 61.432C31.9158 60.9773 32.8192 59.541 32.8192 58.1016ZM29.29 60.2094H26.1855V55.9937H29.1967C30.2235 55.9937 30.9733 56.9543 30.9733 58.0835C30.9733 59.2127 30.3681 60.2185 29.29 60.2185V60.2094Z" fill="#C4A35A"/>
                        <path d="M81.3783 58.1016C81.3783 56.072 79.8938 54.4309 77.8762 54.4309H72.9619V65.723H74.7325V61.8084H77.3553L79.7854 65.723H81.7878L79.1349 61.432C80.4749 60.9773 81.3783 59.541 81.3783 58.1016ZM77.8491 60.2094H74.7325V55.9937H77.7437C78.7706 55.9937 79.5204 56.9543 79.5204 58.0835C79.5204 59.2127 78.9272 60.2185 77.8491 60.2185V60.2094Z" fill="#C4A35A"/>
                        <path d="M10.9971 65.723H12.8881L14.0745 62.6485H18.4228L19.6272 65.723H21.4882L17.0286 54.4309H15.4748L10.9971 65.723ZM18.0825 61.3206H14.3847L16.2757 56.4605L18.0825 61.3206Z" fill="#C4A35A"/>
                        <path d="M1.48438 54.4309V65.723H3.261V61.8084H6.31137C8.38309 61.8084 9.7261 60.0017 9.7261 58.1106C9.7261 56.1624 8.24156 54.4399 6.22705 54.4399L1.48438 54.4309ZM7.91936 58.1016C7.91936 59.2037 7.31712 60.2094 6.19694 60.2094H3.261V55.9937H6.11263C7.22076 56.0118 7.91936 56.9724 7.91936 58.1016Z" fill="#C4A35A"/>
                        <path d="M84.6697 57.7914C84.6697 59.8149 86.4764 60.369 88.1537 60.8357C89.6774 61.2543 91.1348 61.5674 91.1348 62.787C91.1348 63.8319 90.1471 64.2294 88.9306 64.2294C87.5484 64.2294 85.8561 63.5217 85.1214 62.787L84.2451 64.3137C85.5919 65.3126 87.2267 65.8474 88.9035 65.8374C91.6979 65.8374 93.0258 64.4462 93.0258 62.5912C93.0258 60.4834 91.469 59.9173 89.6894 59.4174C88.1025 58.9687 86.5336 58.7369 86.5336 57.5083C86.5336 56.3791 87.437 55.9274 88.7349 55.9274C89.8068 55.9274 91.1619 56.4634 91.7822 57.0867L92.5742 55.6173C91.473 54.8023 90.1409 54.3593 88.771 54.3525C86.4554 54.3525 84.6697 55.5902 84.6697 57.7914Z" fill="#C4A35A"/>
                        <path d="M94.0043 6.88667V37.0622C94.0043 40.9767 93.7032 42.2926 90.978 43.7712V44.274H105.57V43.7712C102.842 42.2926 102.544 40.9647 102.544 37.0622V0H90.7251V0.502874C93.5135 1.80372 94.0043 3.16179 94.0043 6.88667Z" fill="white"/>
                        <path d="M14.9447 44.8643C21.5875 44.8643 26.3091 41.2267 28.1128 34.9935L27.372 34.8158C25.5924 38.9533 22.3945 40.8383 18.6214 40.8383C12.5719 40.8383 8.65727 35.9932 8.65727 28.5706H28.2302C28.2302 20.5667 24.0145 14.5955 14.8875 14.5955C6.82042 14.5955 0 20.6179 0 29.7871C0 39.3688 6.7602 44.8643 14.9447 44.8643ZM14.8273 15.7247C19.0972 15.7247 19.8078 20.8678 19.8078 27.1673H8.71749C8.95538 20.2746 11.3282 15.7247 14.8273 15.7247Z" fill="white"/>
                        <path d="M74.9677 44.8643C81.6104 44.8643 86.332 41.2267 88.1358 34.9935L87.395 34.8158C85.6154 38.9533 82.4204 40.8383 78.6474 40.8383C72.5948 40.8383 68.6802 35.9932 68.6802 28.5706H88.2532C88.2532 20.5667 84.0375 14.5955 74.9104 14.5955C66.8434 14.5955 60.0229 20.6179 60.0229 29.7871C60.0229 39.3688 66.7832 44.8643 74.9677 44.8643ZM74.8502 15.7247C79.1201 15.7247 79.8338 20.8678 79.8338 27.1673H68.7404C68.9783 20.2746 71.3512 15.7247 74.8502 15.7247Z" fill="white"/>
                        <path d="M61.0735 15.2068H52.2506V15.7097C55.2257 16.8208 55.6713 18.9738 54.1507 22.0061L48.1011 34.7135L38.8687 15.2068H28.4077V15.7097C30.6752 16.9413 30.9582 17.8175 32.8583 21.5906L44.4094 44.8794H44.9213L56.12 21.7682C57.9599 17.9861 59.1613 16.7817 61.0855 15.7097L61.0735 15.2068Z" fill="white"/>
                        <path d="M170.544 37.062V24.8877C170.544 18.7387 167.283 14.6013 161.233 14.6013C156.192 14.6013 152.395 17.3506 150.853 22.7316V15.2066H139.627V15.8088C141.799 16.4924 142.313 18.1576 142.313 21.7409V37.05C142.313 40.9646 142.012 42.2805 139.302 43.759V44.2619H153.892V43.759C151.163 42.2805 150.88 40.9525 150.88 37.05V28.3174C150.88 22.4636 153.491 18.8291 157.168 18.8291C160.667 18.8291 162.031 21.5392 162.031 24.8515V32.6988V44.2378H173.597V43.7349C170.842 42.3076 170.544 40.9646 170.544 37.062Z" fill="white"/>
                        <path d="M129.772 15.2068V15.7097C132.744 16.8208 132.97 18.7871 131.669 22.0061L126.035 35.659L116.429 15.2068H105.929V15.7097C108.193 16.9413 108.479 17.8175 110.377 21.5906L122.075 45.0781C118.501 53.1181 115.396 59.9446 112.49 61.8266C111.96 59.0653 110.383 57.3097 108.127 57.3097C107.598 57.3101 107.074 57.4153 106.586 57.6191C106.098 57.823 105.655 58.1215 105.282 58.4974C104.91 58.8734 104.616 59.3194 104.417 59.8096C104.218 60.2999 104.117 60.8247 104.122 61.3538C104.122 64.0368 106.125 65.8255 108.976 65.8255C113.894 65.8255 117.489 59.3544 123.731 44.8342L133.635 21.7411C133.711 21.5635 133.861 21.2774 133.861 21.2774C135.514 17.8928 136.237 16.6221 138.107 15.791V15.1887L129.772 15.2068Z" fill="white"/>
                    </g>
                    <defs>
                        <clipPath id="clip0_login">
                            <rect width="173.57" height="65.8374" fill="white"/>
                        </clipPath>
                    </defs>
                </svg>
            </div>
            <div class="login-tagline">
                <h2>Digital Briefcase</h2>
                <p>Streamline client onboarding with personalised digital form packs</p>
            </div>
        </div>
        <div class="login-form-container">
            <!-- Mobile branding - shown when side panel hidden -->
            <div class="login-mobile-brand">
                <svg viewBox="0 0 173.61 65.85" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M69.2642 56.0118V54.4309H61.6699V65.723H69.4058V64.1421H63.4496V60.6973H68.4753V59.2007H63.4496V56.0118H69.2642Z" fill="#C4A35A"/>
                    <path d="M49.6732 57.7613L56.054 65.723H57.5475V54.4309H55.7408V62.5612L49.2787 54.4309H47.8936V65.723H49.6732V57.7613Z" fill="#C4A35A"/>
                    <path d="M40.9768 65.723V56.0118H44.7318V54.4309H35.415V56.0118H39.2001V65.723H40.9768Z" fill="#C4A35A"/>
                    <path d="M32.8192 58.1016C32.8192 56.072 31.3347 54.4309 29.3171 54.4309H24.4028V65.723H26.1855V61.8084H28.8083L31.2383 65.723H33.2408L30.5879 61.432C31.9158 60.9773 32.8192 59.541 32.8192 58.1016ZM29.29 60.2094H26.1855V55.9937H29.1967C30.2235 55.9937 30.9733 56.9543 30.9733 58.0835C30.9733 59.2127 30.3681 60.2185 29.29 60.2185V60.2094Z" fill="#C4A35A"/>
                    <path d="M81.3783 58.1016C81.3783 56.072 79.8938 54.4309 77.8762 54.4309H72.9619V65.723H74.7325V61.8084H77.3553L79.7854 65.723H81.7878L79.1349 61.432C80.4749 60.9773 81.3783 59.541 81.3783 58.1016ZM77.8491 60.2094H74.7325V55.9937H77.7437C78.7706 55.9937 79.5204 56.9543 79.5204 58.0835C79.5204 59.2127 78.9272 60.2185 77.8491 60.2185V60.2094Z" fill="#C4A35A"/>
                    <path d="M10.9971 65.723H12.8881L14.0745 62.6485H18.4228L19.6272 65.723H21.4882L17.0286 54.4309H15.4748L10.9971 65.723ZM18.0825 61.3206H14.3847L16.2757 56.4605L18.0825 61.3206Z" fill="#C4A35A"/>
                    <path d="M1.48438 54.4309V65.723H3.261V61.8084H6.31137C8.38309 61.8084 9.7261 60.0017 9.7261 58.1106C9.7261 56.1624 8.24156 54.4399 6.22705 54.4399L1.48438 54.4309ZM7.91936 58.1016C7.91936 59.2037 7.31712 60.2094 6.19694 60.2094H3.261V55.9937H6.11263C7.22076 56.0118 7.91936 56.9724 7.91936 58.1016Z" fill="#C4A35A"/>
                    <path d="M84.6697 57.7914C84.6697 59.8149 86.4764 60.369 88.1537 60.8357C89.6774 61.2543 91.1348 61.5674 91.1348 62.787C91.1348 63.8319 90.1471 64.2294 88.9306 64.2294C87.5484 64.2294 85.8561 63.5217 85.1214 62.787L84.2451 64.3137C85.5919 65.3126 87.2267 65.8474 88.9035 65.8374C91.6979 65.8374 93.0258 64.4462 93.0258 62.5912C93.0258 60.4834 91.469 59.9173 89.6894 59.4174C88.1025 58.9687 86.5336 58.7369 86.5336 57.5083C86.5336 56.3791 87.437 55.9274 88.7349 55.9274C89.8068 55.9274 91.1619 56.4634 91.7822 57.0867L92.5742 55.6173C91.473 54.8023 90.1409 54.3593 88.771 54.3525C86.4554 54.3525 84.6697 55.5902 84.6697 57.7914Z" fill="#C4A35A"/>
                    <path d="M94.0043 6.88667V37.0622C94.0043 40.9767 93.7032 42.2926 90.978 43.7712V44.274H105.57V43.7712C102.842 42.2926 102.544 40.9647 102.544 37.0622V0H90.7251V0.502874C93.5135 1.80372 94.0043 3.16179 94.0043 6.88667Z" fill="#2D2047"/>
                    <path d="M14.9447 44.8643C21.5875 44.8643 26.3091 41.2267 28.1128 34.9935L27.372 34.8158C25.5924 38.9533 22.3945 40.8383 18.6214 40.8383C12.5719 40.8383 8.65727 35.9932 8.65727 28.5706H28.2302C28.2302 20.5667 24.0145 14.5955 14.8875 14.5955C6.82042 14.5955 0 20.6179 0 29.7871C0 39.3688 6.7602 44.8643 14.9447 44.8643ZM14.8273 15.7247C19.0972 15.7247 19.8078 20.8678 19.8078 27.1673H8.71749C8.95538 20.2746 11.3282 15.7247 14.8273 15.7247Z" fill="#2D2047"/>
                    <path d="M74.9677 44.8643C81.6104 44.8643 86.332 41.2267 88.1358 34.9935L87.395 34.8158C85.6154 38.9533 82.4204 40.8383 78.6474 40.8383C72.5948 40.8383 68.6802 35.9932 68.6802 28.5706H88.2532C88.2532 20.5667 84.0375 14.5955 74.9104 14.5955C66.8434 14.5955 60.0229 20.6179 60.0229 29.7871C60.0229 39.3688 66.7832 44.8643 74.9677 44.8643ZM74.8502 15.7247C79.1201 15.7247 79.8338 20.8678 79.8338 27.1673H68.7404C68.9783 20.2746 71.3512 15.7247 74.8502 15.7247Z" fill="#2D2047"/>
                    <path d="M61.0735 15.2068H52.2506V15.7097C55.2257 16.8208 55.6713 18.9738 54.1507 22.0061L48.1011 34.7135L38.8687 15.2068H28.4077V15.7097C30.6752 16.9413 30.9582 17.8175 32.8583 21.5906L44.4094 44.8794H44.9213L56.12 21.7682C57.9599 17.9861 59.1613 16.7817 61.0855 15.7097L61.0735 15.2068Z" fill="#2D2047"/>
                    <path d="M170.544 37.062V24.8877C170.544 18.7387 167.283 14.6013 161.233 14.6013C156.192 14.6013 152.395 17.3506 150.853 22.7316V15.2066H139.627V15.8088C141.799 16.4924 142.313 18.1576 142.313 21.7409V37.05C142.313 40.9646 142.012 42.2805 139.302 43.759V44.2619H153.892V43.759C151.163 42.2805 150.88 40.9525 150.88 37.05V28.3174C150.88 22.4636 153.491 18.8291 157.168 18.8291C160.667 18.8291 162.031 21.5392 162.031 24.8515V32.6988V44.2378H173.597V43.7349C170.842 42.3076 170.544 40.9646 170.544 37.062Z" fill="#2D2047"/>
                    <path d="M129.772 15.2068V15.7097C132.744 16.8208 132.97 18.7871 131.669 22.0061L126.035 35.659L116.429 15.2068H105.929V15.7097C108.193 16.9413 108.479 17.8175 110.377 21.5906L122.075 45.0781C118.501 53.1181 115.396 59.9446 112.49 61.8266C111.96 59.0653 110.383 57.3097 108.127 57.3097C107.598 57.3101 107.074 57.4153 106.586 57.6191C106.098 57.823 105.655 58.1215 105.282 58.4974C104.91 58.8734 104.616 59.3194 104.417 59.8096C104.218 60.2999 104.117 60.8247 104.122 61.3538C104.122 64.0368 106.125 65.8255 108.976 65.8255C113.894 65.8255 117.489 59.3544 123.731 44.8342L133.635 21.7411C133.711 21.5635 133.861 21.2774 133.861 21.2774C135.514 17.8928 136.237 16.6221 138.107 15.791V15.1887L129.772 15.2068Z" fill="#2D2047"/>
                </svg>
                <div class="app-name">Digital Briefcase</div>
            </div>
            
            <div class="login-header">
                <h1>Welcome back</h1>
                <p>Sign in to access your advisor portal</p>
            </div>
            
            <div class="login-error" id="loginError">
                Invalid email or password. Please try again.
            </div>
            
            <form class="login-form" id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="loginEmail">Email address</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="name@evelynpartners.com" required autocomplete="email">
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <div class="password-input-wrap">
                        <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password" required autocomplete="current-password">
                        <button type="button" class="password-toggle" onclick="togglePassword()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="form-options">
                    <label class="remember-me">
                        <input type="checkbox" id="rememberMe">
                        <span>Remember me</span>
                    </label>
                    <a href="#" class="forgot-link" onclick="showForgotPassword(event)">Forgot password?</a>
                </div>
                
                <button type="submit" class="login-btn" id="loginBtn">
                    Sign in
                </button>
                
                <div class="login-divider">
                    <span>or</span>
                </div>
                
                <button type="button" class="sso-btn" onclick="handleSSO()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                    Sign in with SSO
                </button>
            </form>
            
            <div class="login-footer">
                <p>Need help? Contact <a href="mailto:support@evelynpartners.com">IT Support</a></p>
            </div>
        </div>
    </div>

    <!-- Mobile Header -->
    <header class="mobile-header">
        <button class="mobile-menu-btn" onclick="toggleSidebar()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/>
            </svg>
        </button>
        <div class="mobile-header-brand">
            <div class="mobile-header-logo">
                <svg viewBox="0 0 174 66" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- PARTNERS text -->
                    <path d="M69.26 56.01V54.43H61.67V65.72H69.41V64.14H63.45V60.7H68.48V59.2H63.45V56.01H69.26Z" fill="#C4A35A"/>
                    <path d="M49.67 57.76L56.05 65.72H57.55V54.43H55.74V62.56L49.28 54.43H47.89V65.72H49.67V57.76Z" fill="#C4A35A"/>
                    <path d="M40.98 65.72V56.01H44.73V54.43H35.42V56.01H39.2V65.72H40.98Z" fill="#C4A35A"/>
                    <path d="M32.82 58.1C32.82 56.07 31.33 54.43 29.32 54.43H24.4V65.72H26.19V61.81H28.81L31.24 65.72H33.24L30.59 61.43C31.92 60.98 32.82 59.54 32.82 58.1ZM29.29 60.21H26.19V55.99H29.2C30.22 55.99 30.97 56.95 30.97 58.08C30.97 59.21 30.37 60.22 29.29 60.22V60.21Z" fill="#C4A35A"/>
                    <path d="M81.38 58.1C81.38 56.07 79.89 54.43 77.88 54.43H72.96V65.72H74.73V61.81H77.36L79.79 65.72H81.79L79.13 61.43C80.47 60.98 81.38 59.54 81.38 58.1ZM77.85 60.21H74.73V55.99H77.74C78.77 55.99 79.52 56.95 79.52 58.08C79.52 59.21 78.93 60.22 77.85 60.22V60.21Z" fill="#C4A35A"/>
                    <path d="M11 65.72H12.89L14.07 62.65H18.42L19.63 65.72H21.49L17.03 54.43H15.47L11 65.72ZM18.08 61.32H14.38L16.28 56.46L18.08 61.32Z" fill="#C4A35A"/>
                    <path d="M1.48 54.43V65.72H3.26V61.81H6.31C8.38 61.81 9.73 60 9.73 58.11C9.73 56.16 8.24 54.44 6.23 54.44L1.48 54.43ZM7.92 58.1C7.92 59.2 7.32 60.21 6.2 60.21H3.26V55.99H6.11C7.22 56.01 7.92 56.97 7.92 58.1Z" fill="#C4A35A"/>
                    <path d="M84.67 57.79C84.67 59.81 86.48 60.37 88.15 60.84C89.68 61.25 91.13 61.57 91.13 62.79C91.13 63.83 90.15 64.23 88.93 64.23C87.55 64.23 85.86 63.52 85.12 62.79L84.25 64.31C85.59 65.31 87.23 65.85 88.9 65.84C91.7 65.84 93.03 64.45 93.03 62.59C93.03 60.48 91.47 59.92 89.69 59.42C88.1 58.97 86.53 58.74 86.53 57.51C86.53 56.38 87.44 55.93 88.73 55.93C89.81 55.93 91.16 56.46 91.78 57.09L92.57 55.62C91.47 54.8 90.14 54.36 88.77 54.35C86.46 54.35 84.67 55.59 84.67 57.79Z" fill="#C4A35A"/>
                    <!-- evelyn text -->
                    <path d="M94 6.89V37.06C94 40.98 93.7 42.29 90.98 43.77V44.27H105.57V43.77C102.84 42.29 102.54 40.96 102.54 37.06V0H90.73V.5C93.51 1.8 94 3.16 94 6.89Z" fill="white"/>
                    <path d="M14.94 44.86C21.59 44.86 26.31 41.23 28.11 34.99L27.37 34.82C25.59 38.95 22.39 40.84 18.62 40.84C12.57 40.84 8.66 35.99 8.66 28.57H28.23C28.23 20.57 24.01 14.6 14.89 14.6C6.82 14.6 0 20.62 0 29.79C0 39.37 6.76 44.86 14.94 44.86ZM14.83 15.72C19.1 15.72 19.81 20.87 19.81 27.17H8.72C8.96 20.27 11.33 15.72 14.83 15.72Z" fill="white"/>
                    <path d="M74.97 44.86C81.61 44.86 86.33 41.23 88.14 34.99L87.4 34.82C85.62 38.95 82.42 40.84 78.65 40.84C72.59 40.84 68.68 35.99 68.68 28.57H88.25C88.25 20.57 84.04 14.6 74.91 14.6C66.84 14.6 60.02 20.62 60.02 29.79C60.02 39.37 66.78 44.86 74.97 44.86ZM74.85 15.72C79.12 15.72 79.83 20.87 79.83 27.17H68.74C68.98 20.27 71.35 15.72 74.85 15.72Z" fill="white"/>
                    <path d="M61.07 15.21H52.25V15.71C55.23 16.82 55.67 18.97 54.15 22.01L48.1 34.71L38.87 15.21H28.41V15.71C30.68 16.94 30.96 17.82 32.86 21.59L44.41 44.88H44.92L56.12 21.77C57.96 17.99 59.16 16.78 61.09 15.71L61.07 15.21Z" fill="white"/>
                    <path d="M170.54 37.06V24.89C170.54 18.74 167.28 14.6 161.23 14.6C156.19 14.6 152.4 17.35 150.85 22.73V15.21H139.63V15.81C141.8 16.49 142.31 18.16 142.31 21.74V37.05C142.31 40.96 142.01 42.28 139.3 43.76V44.26H153.89V43.76C151.16 42.28 150.88 40.95 150.88 37.05V28.32C150.88 22.46 153.49 18.83 157.17 18.83C160.67 18.83 162.03 21.54 162.03 24.85V32.7V44.24H173.6V43.73C170.84 42.31 170.54 40.96 170.54 37.06Z" fill="white"/>
                    <path d="M129.77 15.21V15.71C132.74 16.82 132.97 18.79 131.67 22.01L126.04 35.66L116.43 15.21H105.93V15.71C108.19 16.94 108.48 17.82 110.38 21.59L122.08 45.08C118.5 53.12 115.4 59.94 112.49 61.83C111.96 59.07 110.38 57.31 108.13 57.31C107.6 57.31 107.07 57.42 106.59 57.62C106.1 57.82 105.66 58.12 105.28 58.5C104.91 58.87 104.62 59.32 104.42 59.81C104.22 60.3 104.12 60.82 104.12 61.35C104.12 64.04 106.13 65.83 108.98 65.83C113.89 65.83 117.49 59.35 123.73 44.83L133.64 21.74C133.71 21.56 133.86 21.28 133.86 21.28C135.51 17.89 136.24 16.62 138.11 15.79V15.19L129.77 15.21Z" fill="white"/>
                </svg>
            </div>
            <div class="mobile-header-divider"></div>
            <span class="mobile-header-title">Digital Briefcase</span>
        </div>
    </header>
    
    <!-- Sidebar Backdrop -->
    <div class="sidebar-backdrop" id="sidebarBackdrop" onclick="toggleSidebar()"></div>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <button class="sidebar-close-btn" onclick="toggleSidebar()"></button>
            <div class="sidebar-logo">
                <svg width="140" height="50" viewBox="0 0 173.61 65.85" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_logo)">
                        <path d="M69.2642 56.0118V54.4309H61.6699V65.723H69.4058V64.1421H63.4496V60.6973H68.4753V59.2007H63.4496V56.0118H69.2642Z" fill="#C4A35A"/>
                        <path d="M49.6732 57.7613L56.054 65.723H57.5475V54.4309H55.7408V62.5612L49.2787 54.4309H47.8936V65.723H49.6732V57.7613Z" fill="#C4A35A"/>
                        <path d="M40.9768 65.723V56.0118H44.7318V54.4309H35.415V56.0118H39.2001V65.723H40.9768Z" fill="#C4A35A"/>
                        <path d="M32.8192 58.1016C32.8192 56.072 31.3347 54.4309 29.3171 54.4309H24.4028V65.723H26.1855V61.8084H28.8083L31.2383 65.723H33.2408L30.5879 61.432C31.9158 60.9773 32.8192 59.541 32.8192 58.1016ZM29.29 60.2094H26.1855V55.9937H29.1967C30.2235 55.9937 30.9733 56.9543 30.9733 58.0835C30.9733 59.2127 30.3681 60.2185 29.29 60.2185V60.2094Z" fill="#C4A35A"/>
                        <path d="M81.3783 58.1016C81.3783 56.072 79.8938 54.4309 77.8762 54.4309H72.9619V65.723H74.7325V61.8084H77.3553L79.7854 65.723H81.7878L79.1349 61.432C80.4749 60.9773 81.3783 59.541 81.3783 58.1016ZM77.8491 60.2094H74.7325V55.9937H77.7437C78.7706 55.9937 79.5204 56.9543 79.5204 58.0835C79.5204 59.2127 78.9272 60.2185 77.8491 60.2185V60.2094Z" fill="#C4A35A"/>
                        <path d="M10.9971 65.723H12.8881L14.0745 62.6485H18.4228L19.6272 65.723H21.4882L17.0286 54.4309H15.4748L10.9971 65.723ZM18.0825 61.3206H14.3847L16.2757 56.4605L18.0825 61.3206Z" fill="#C4A35A"/>
                        <path d="M1.48438 54.4309V65.723H3.261V61.8084H6.31137C8.38309 61.8084 9.7261 60.0017 9.7261 58.1106C9.7261 56.1624 8.24156 54.4399 6.22705 54.4399L1.48438 54.4309ZM7.91936 58.1016C7.91936 59.2037 7.31712 60.2094 6.19694 60.2094H3.261V55.9937H6.11263C7.22076 56.0118 7.91936 56.9724 7.91936 58.1016Z" fill="#C4A35A"/>
                        <path d="M84.6697 57.7914C84.6697 59.8149 86.4764 60.369 88.1537 60.8357C89.6774 61.2543 91.1348 61.5674 91.1348 62.787C91.1348 63.8319 90.1471 64.2294 88.9306 64.2294C87.5484 64.2294 85.8561 63.5217 85.1214 62.787L84.2451 64.3137C85.5919 65.3126 87.2267 65.8474 88.9035 65.8374C91.6979 65.8374 93.0258 64.4462 93.0258 62.5912C93.0258 60.4834 91.469 59.9173 89.6894 59.4174C88.1025 58.9687 86.5336 58.7369 86.5336 57.5083C86.5336 56.3791 87.437 55.9274 88.7349 55.9274C89.8068 55.9274 91.1619 56.4634 91.7822 57.0867L92.5742 55.6173C91.473 54.8023 90.1409 54.3593 88.771 54.3525C86.4554 54.3525 84.6697 55.5902 84.6697 57.7914Z" fill="#C4A35A"/>
                        <path d="M94.0043 6.88667V37.0622C94.0043 40.9767 93.7032 42.2926 90.978 43.7712V44.274H105.57V43.7712C102.842 42.2926 102.544 40.9647 102.544 37.0622V0H90.7251V0.502874C93.5135 1.80372 94.0043 3.16179 94.0043 6.88667Z" fill="white"/>
                        <path d="M14.9447 44.8643C21.5875 44.8643 26.3091 41.2267 28.1128 34.9935L27.372 34.8158C25.5924 38.9533 22.3945 40.8383 18.6214 40.8383C12.5719 40.8383 8.65727 35.9932 8.65727 28.5706H28.2302C28.2302 20.5667 24.0145 14.5955 14.8875 14.5955C6.82042 14.5955 0 20.6179 0 29.7871C0 39.3688 6.7602 44.8643 14.9447 44.8643ZM14.8273 15.7247C19.0972 15.7247 19.8078 20.8678 19.8078 27.1673H8.71749C8.95538 20.2746 11.3282 15.7247 14.8273 15.7247Z" fill="white"/>
                        <path d="M74.9677 44.8643C81.6104 44.8643 86.332 41.2267 88.1358 34.9935L87.395 34.8158C85.6154 38.9533 82.4204 40.8383 78.6474 40.8383C72.5948 40.8383 68.6802 35.9932 68.6802 28.5706H88.2532C88.2532 20.5667 84.0375 14.5955 74.9104 14.5955C66.8434 14.5955 60.0229 20.6179 60.0229 29.7871C60.0229 39.3688 66.7832 44.8643 74.9677 44.8643ZM74.8502 15.7247C79.1201 15.7247 79.8338 20.8678 79.8338 27.1673H68.7404C68.9783 20.2746 71.3512 15.7247 74.8502 15.7247Z" fill="white"/>
                        <path d="M61.0735 15.2068H52.2506V15.7097C55.2257 16.8208 55.6713 18.9738 54.1507 22.0061L48.1011 34.7135L38.8687 15.2068H28.4077V15.7097C30.6752 16.9413 30.9582 17.8175 32.8583 21.5906L44.4094 44.8794H44.9213L56.12 21.7682C57.9599 17.9861 59.1613 16.7817 61.0855 15.7097L61.0735 15.2068Z" fill="white"/>
                        <path d="M170.544 37.062V24.8877C170.544 18.7387 167.283 14.6013 161.233 14.6013C156.192 14.6013 152.395 17.3506 150.853 22.7316V15.2066H139.627V15.8088C141.799 16.4924 142.313 18.1576 142.313 21.7409V37.05C142.313 40.9646 142.012 42.2805 139.302 43.759V44.2619H153.892V43.759C151.163 42.2805 150.88 40.9525 150.88 37.05V28.3174C150.88 22.4636 153.491 18.8291 157.168 18.8291C160.667 18.8291 162.031 21.5392 162.031 24.8515V32.6988V44.2378H173.597V43.7349C170.842 42.3076 170.544 40.9646 170.544 37.062Z" fill="white"/>
                        <path d="M129.772 15.2068V15.7097C132.744 16.8208 132.97 18.7871 131.669 22.0061L126.035 35.659L116.429 15.2068H105.929V15.7097C108.193 16.9413 108.479 17.8175 110.377 21.5906L122.075 45.0781C118.501 53.1181 115.396 59.9446 112.49 61.8266C111.96 59.0653 110.383 57.3097 108.127 57.3097C107.598 57.3101 107.074 57.4153 106.586 57.6191C106.098 57.823 105.655 58.1215 105.282 58.4974C104.91 58.8734 104.616 59.3194 104.417 59.8096C104.218 60.2999 104.117 60.8247 104.122 61.3538C104.122 64.0368 106.125 65.8255 108.976 65.8255C113.894 65.8255 117.489 59.3544 123.731 44.8342L133.635 21.7411C133.711 21.5635 133.861 21.2774 133.861 21.2774C135.514 17.8928 136.237 16.6221 138.107 15.791V15.1887L129.772 15.2068Z" fill="white"/>
                    </g>
                    <defs>
                        <clipPath id="clip0_logo">
                            <rect width="173.57" height="65.8374" fill="white"/>
                        </clipPath>
                    </defs>
                </svg>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Overview</div>
                    <div class="nav-item active">
                        <svg class="nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                        <span class="nav-item-text">Dashboard</span>
                    </div>
                    <div class="nav-item">
                        <svg class="nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                        <span class="nav-item-text">All Clients</span>
                        <span class="nav-badge" id="totalClientsBadge">6</span>
                    </div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Briefcases</div>
                    <div class="nav-item">
                        <svg class="nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
                        <span class="nav-item-text">Active</span>
                        <span class="nav-badge" id="activeBadge">4</span>
                    </div>
                    <div class="nav-item">
                        <svg class="nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        <span class="nav-item-text">Awaiting Response</span>
                        <span class="nav-badge" id="awaitingBadge">2</span>
                    </div>
                    <div class="nav-item">
                        <svg class="nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                        <span class="nav-item-text">Completed</span>
                    </div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Settings</div>
                    <div class="nav-item">
                        <svg class="nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                        <span class="nav-item-text">Form Templates</span>
                    </div>
                </div>
                
                <!-- User Section (moved from footer for better mobile access) -->
                <div class="nav-section sidebar-user-section">
                    <div class="advisor-switcher">
                        <select id="advisorSelect" onchange="switchAdvisor(this.value)">
                            <option value="adv-001">Sarah Chen - Advisor</option>
                            <option value="adv-002">James Morton - Admin</option>
                            <option value="adv-003">Ciarn O'Sullivan - Advisor</option>
                            <option value="adv-004">Aoife Brennan - Admin</option>
                        </select>
                    </div>
                    <div class="sidebar-user-row">
                        <div class="advisor-info">
                            <div class="advisor-avatar" id="currentAdvisorAvatar">SC</div>
                            <div>
                                <div class="advisor-name" id="currentAdvisorName">Sarah Chen</div>
                                <div class="advisor-role" id="currentAdvisorRole">Senior Wealth Advisor</div>
                            </div>
                        </div>
                        <button class="logout-btn" onclick="logout()" title="Sign out">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                <polyline points="16 17 21 12 16 7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Wrapper (Content + Panel) -->
        <div class="main-wrapper">
            <!-- Main Content -->
            <main class="main-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title">Digital Briefcase</h1>
                    <p class="page-subtitle">Curate and deliver personalised form packs to your clients</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> Export</button>
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon gold"></div>
                        <div class="stat-value" id="statSent">4</div>
                        <div class="stat-trend up"> 12%</div>
                    </div>
                    <div class="stat-label">Briefcases Sent</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon teal"></div>
                        <div class="stat-value" id="statComplete">1</div>
                    </div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon coral"></div>
                        <div class="stat-value" id="statPending">3</div>
                    </div>
                    <div class="stat-label">In Progress</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon purple"></div>
                        <div class="stat-value" id="statRate">83%</div>
                    </div>
                    <div class="stat-label">Completion Rate</div>
                </div>
            </div>

            <!-- Toolbar -->
            <div class="toolbar">
                <div class="search-box">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                    <input type="text" placeholder="Search clients..." id="searchInput" oninput="filterClients()">
                </div>
                <button class="filter-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>
                    Filter
                </button>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="setTab('all')">All Clients</button>
                <button class="tab" onclick="setTab('draft')">Draft</button>
                <button class="tab" onclick="setTab('sent')">Sent</button>
                <button class="tab" onclick="setTab('complete')">Completed</button>
            </div>

            <!-- Client List -->
            <div class="client-list" id="clientList"></div>
        </main>
        </div> <!-- end main-wrapper -->

        <!-- Panel Backdrop -->
        <div class="panel-backdrop" id="panelBackdrop" onclick="deselectClient()"></div>

        <!-- Right Panel -->
        <aside class="panel" id="briefcasePanel">
            <div class="panel-header">
                <div class="panel-header-content">
                    <div class="panel-title"><div class="panel-title-icon"></div>Briefcase Builder</div>
                    <p class="panel-subtitle">Select a client to build their form pack</p>
                </div>
                <button class="panel-close-btn" onclick="closePanel()" title="Close panel">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="panel-body" id="panelBody">
                <div class="empty-state" id="emptyState">
                    <div class="empty-state-icon"></div>
                    <div class="empty-state-text">No client selected</div>
                    <div class="empty-state-hint">Click on a client to build their briefcase</div>
                </div>
                <div id="builderContent" style="display:none;"></div>
            </div>
            <div class="panel-footer" id="panelFooter" style="display:none;">
                <div class="send-summary">
                    <div class="send-summary-item"><div class="send-summary-label">Forms</div><div class="send-summary-value" id="formCountSummary">0</div></div>
                    <div class="send-summary-item"><div class="send-summary-label">Delivery</div><div class="send-summary-value" id="deliverySummary">Email</div></div>
                </div>
                <button class="send-btn" id="sendBtn" onclick="sendBriefcase()" disabled>
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
                    Send Briefcase
                </button>
            </div>
        </aside>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div class="modal-body">
                <div class="modal-icon success-checkmark">
                    <svg viewBox="0 0 52 52" width="32" height="32">
                        <circle class="checkmark-circle" cx="26" cy="26" r="22" fill="none" stroke="currentColor" stroke-width="3"/>
                        <path class="checkmark-check" fill="none" stroke="currentColor" stroke-width="3" d="M14 27l8 8 16-16"/>
                    </svg>
                </div>
                <h2 class="modal-title">Briefcase Sent!</h2>
                <p class="modal-message">Your client will receive a secure link to complete their forms.</p>
                <div class="modal-details">
                    <div class="modal-detail-row"><span class="modal-detail-label">Client</span><span class="modal-detail-value" id="modalClient">-</span></div>
                    <div class="modal-detail-row"><span class="modal-detail-label">Forms</span><span class="modal-detail-value" id="modalForms">-</span></div>
                    <div class="modal-detail-row"><span class="modal-detail-label">Reference</span><span class="modal-detail-value" id="modalRef">-</span></div>
                </div>
                <button class="btn btn-primary" onclick="closeModal()" style="width:100%;padding:14px;">Done</button>
            </div>
        </div>
    </div>

    <!-- Form Review Modal -->
    <div class="form-modal-overlay" id="formModalOverlay">
        <div class="form-modal">
            <div class="form-modal-header">
                <button class="form-modal-close" onclick="closeFormModal()"></button>
                <div class="form-modal-title">
                    <h3 id="formModalTitle">Form Review</h3>
                    <span id="formModalSubtitle">Reviewing client form</span>
                </div>
                <div class="form-modal-actions">
                    <button class="form-modal-btn" onclick="openFormInNewTab()">Open in New Tab</button>
                    <button class="form-modal-btn primary" onclick="closeFormModal()">Done</button>
                </div>
            </div>
            <iframe class="form-modal-iframe" id="formModalIframe" src="about:blank"></iframe>
        </div>
    </div>

    <!-- Embedded Data -->
    <script id="configData" type="application/json">
    {
        "advisors": [
            {"id":"adv-001","name":"Sarah Chen","role":"advisor","roleTitle":"Senior Wealth Advisor","initials":"SC","teamId":"team-london-01"},
            {"id":"adv-002","name":"James Morton","role":"admin","roleTitle":"Client Services Administrator","initials":"JM","teamId":"team-london-01","reportsTo":"adv-001"},
            {"id":"adv-003","name":"Ciarn O'Sullivan","role":"advisor","roleTitle":"Wealth Director","initials":"CO","teamId":"team-dublin-01"},
            {"id":"adv-004","name":"Aoife Brennan","role":"admin","roleTitle":"Client Services Coordinator","initials":"AB","teamId":"team-dublin-01","reportsTo":"adv-003"}
        ],
        "entities": [
            {"id":"UK-EPIM-LLP","shortName":"EPIM LLP","jurisdiction":"UK"},
            {"id":"IE-EPIM-DAC","shortName":"EPIM Ireland","jurisdiction":"IE"}
        ],
        "propositions": [
            {"id":"discretionary","name":"Discretionary","shortName":"DFM"},
            {"id":"advisory","name":"Advisory","shortName":"Adv"},
            {"id":"execution","name":"Execution Only","shortName":"Exec"}
        ],
        "forms": [
            {"id":"isa","name":"Stocks & Shares ISA","icon":"","class":"isa","jurisdiction":["UK"],"category":"accounts","file":"../forms/account_isa_application.html","storageKey":"evelynAccountFormData"},
            {"id":"gia","name":"General Investment Account","icon":"","class":"gia","jurisdiction":["UK","IE"],"category":"accounts","file":"../forms/account_gia_application.html","storageKey":"evelynAccountFormData"},
            {"id":"sipp","name":"SIPP","icon":"","class":"sipp","jurisdiction":["UK"],"category":"accounts","file":"../forms/account_sipp_application.html","storageKey":"evelynAccountFormData"},
            {"id":"aim","name":"AIM Portfolio","icon":"","class":"aim","jurisdiction":["UK","IE"],"category":"accounts","file":"../forms/account_aim_application.html","storageKey":"evelynAccountFormData"},
            {"id":"jisa","name":"Junior ISA","icon":"","class":"jisa","jurisdiction":["UK"],"category":"accounts","file":"../forms/account_jisa_application.html","storageKey":"evelynAccountFormData"}
        ]
    }
    </script>

    <script id="clientsData" type="application/json">
    [
        {
            "clientId":"client-001","clientRef":"EP-2025-001234","clientType":"joint","jurisdiction":"UK",
            "applicants":[{"firstName":"James","surname":"Thornton"},{"firstName":"Elizabeth","surname":"Thornton"}],
            "assignedAdvisor":"adv-001","assignedAdmin":"adv-002",
            "recommendation":{"legalEntity":"UK-EPIM-LLP","proposition":"discretionary","riskProfile":"balanced","investableAmount":850000,
                "recommendedAccounts":[{"type":"isa","holder":"primary"},{"type":"isa","holder":"secondary"},{"type":"gia","holder":"joint"},{"type":"sipp","holder":"primary"},{"type":"aim","holder":"joint"}]},
            "factFind":{"status":"complete"},
            "briefcase":{"status":"draft","forms":[]}
        },
        {
            "clientId":"client-002","clientRef":"EP-2025-001189","clientType":"individual","jurisdiction":"UK",
            "applicants":[{"firstName":"Michael","surname":"Chen"}],
            "assignedAdvisor":"adv-001","assignedAdmin":"adv-002",
            "recommendation":{"legalEntity":"UK-EPIM-LLP","proposition":"advisory","riskProfile":"growth","investableAmount":150000,
                "recommendedAccounts":[{"type":"isa","holder":"primary"},{"type":"sipp","holder":"primary"},{"type":"gia","holder":"primary"}]},
            "factFind":{"status":"complete"},
            "briefcase":{"status":"sent","forms":["isa","sipp","gia"],"progress":50,"sentDate":"5 Jan 2025","lastActivity":"2 hours ago",
                "formProgress":{"isa":75,"sipp":50,"gia":25}}
        },
        {
            "clientId":"client-003","clientRef":"EP-IE-2025-000089","clientType":"individual","jurisdiction":"IE",
            "applicants":[{"firstName":"Siobhn","surname":"O'Brien"}],
            "assignedAdvisor":"adv-003","assignedAdmin":"adv-004",
            "recommendation":{"legalEntity":"IE-EPIM-DAC","proposition":"discretionary","riskProfile":"growth","investableAmount":500000,
                "recommendedAccounts":[{"type":"gia","holder":"primary"},{"type":"aim","holder":"primary"}]},
            "factFind":{"status":"complete"},
            "briefcase":{"status":"complete","forms":["gia","aim"],"progress":100,"completedAt":"20 Dec 2024",
                "formProgress":{"gia":100,"aim":100}}
        },
        {
            "clientId":"client-004","clientRef":"EP-2025-001298","clientType":"joint","jurisdiction":"UK",
            "applicants":[{"firstName":"David","surname":"Morrison"},{"firstName":"Claire","surname":"Morrison"}],
            "dependents":[{"name":"Emily Morrison","age":12},{"name":"Thomas Morrison","age":9}],
            "assignedAdvisor":"adv-001","assignedAdmin":"adv-002",
            "recommendation":{"legalEntity":"UK-EPIM-LLP","proposition":"discretionary","riskProfile":"balanced","investableAmount":120000,
                "recommendedAccounts":[{"type":"isa","holder":"primary"},{"type":"isa","holder":"secondary"},{"type":"jisa","holder":"dependent-1"},{"type":"jisa","holder":"dependent-2"},{"type":"gia","holder":"joint"}]},
            "factFind":{"status":"complete"},
            "briefcase":{"status":"draft","forms":[]}
        },
        {
            "clientId":"client-005","clientRef":"EP-2025-001156","clientType":"individual","jurisdiction":"UK",
            "applicants":[{"firstName":"Emma","surname":"Richardson"}],
            "dependents":[{"name":"Oliver Richardson","age":4}],
            "assignedAdvisor":"adv-001","assignedAdmin":"adv-002",
            "recommendation":{"legalEntity":"UK-EPIM-LLP","proposition":"discretionary","riskProfile":"balanced","investableAmount":9000,
                "recommendedAccounts":[{"type":"jisa","holder":"dependent-1"}]},
            "factFind":{"status":"complete"},
            "briefcase":{"status":"sent","forms":["jisa"],"progress":35,"sentDate":"3 Jan 2025","lastActivity":"Yesterday",
                "formProgress":{"jisa":35}}
        },
        {
            "clientId":"client-006","clientRef":"EP-IE-2024-000312","clientType":"individual","jurisdiction":"IE",
            "applicants":[{"firstName":"Patrick","surname":"Kelly"}],
            "assignedAdvisor":"adv-003","assignedAdmin":"adv-004",
            "recommendation":{"legalEntity":"IE-EPIM-DAC","proposition":"discretionary","riskProfile":"growth","investableAmount":750000,
                "recommendedAccounts":[{"type":"gia","holder":"primary"},{"type":"aim","holder":"primary"}]},
            "factFind":{"status":"complete"},
            "briefcase":{"status":"in-progress","forms":["gia","aim"],"progress":75,"sentDate":"28 Dec 2024","lastActivity":"10 mins ago",
                "formProgress":{"gia":100,"aim":50}}
        }
    ]
    </script>

    <script>
        // ==================== STATE ====================
        let config = JSON.parse(document.getElementById('configData').textContent);
        let clients = JSON.parse(document.getElementById('clientsData').textContent);
        let currentAdvisor = config.advisors[0];
        let selectedClient = null;
        let selectedForms = [];
        let selectedEntity = null;
        let selectedProposition = null;
        let deliveryMethod = 'email';
        let currentTab = 'all';

        // ==================== LOGIN ====================
        const DEMO_USERS = {
            'sarah.chen@evelynpartners.com': { password: 'demo123', advisorId: 'adv-001' },
            'james.morton@evelynpartners.com': { password: 'demo123', advisorId: 'adv-002' },
            'ciaran.osullivan@evelynpartners.com': { password: 'demo123', advisorId: 'adv-003' },
            'aoife.brennan@evelynpartners.com': { password: 'demo123', advisorId: 'adv-004' }
        };
        
        let isLoggedIn = false;
        
        function checkLoginStatus() {
            const session = localStorage.getItem('evelynSession');
            if (session) {
                try {
                    const data = JSON.parse(session);
                    if (data.advisorId && data.expiry > Date.now()) {
                        isLoggedIn = true;
                        // Set current advisor from session
                        const advisor = config.advisors.find(a => a.id === data.advisorId);
                        if (advisor) {
                            currentAdvisor = advisor;
                            updateAdvisorUI();
                        }
                        hideLoginScreen();
                        return true;
                    }
                } catch(e) {}
            }
            showLoginScreen();
            return false;
        }
        
        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
        }
        
        function hideLoginScreen() {
            document.getElementById('loginScreen').classList.add('hidden');
        }
        
        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value.toLowerCase().trim();
            const password = document.getElementById('loginPassword').value;
            const remember = document.getElementById('rememberMe').checked;
            const btn = document.getElementById('loginBtn');
            const errorEl = document.getElementById('loginError');
            
            // Hide previous errors
            errorEl.classList.remove('show');
            
            // Show loading state
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner"></div> Signing in...';
            
            // Simulate API call
            setTimeout(() => {
                // For demo: accept any email/password, map known emails to advisors
                const user = DEMO_USERS[email];
                
                // Always succeed for demo purposes
                isLoggedIn = true;
                
                // Use matched advisor or default to Sarah Chen
                const advisorId = user ? user.advisorId : 'adv-001';
                
                // Save session
                const session = {
                    advisorId: advisorId,
                    email: email,
                    expiry: remember ? Date.now() + (7 * 24 * 60 * 60 * 1000) : Date.now() + (24 * 60 * 60 * 1000)
                };
                localStorage.setItem('evelynSession', JSON.stringify(session));
                
                // Set current advisor
                const advisor = config.advisors.find(a => a.id === advisorId);
                if (advisor) {
                    currentAdvisor = advisor;
                    updateAdvisorUI();
                    renderClients();
                    updateStats();
                }
                
                hideLoginScreen();
                
                // Reset button
                btn.disabled = false;
                btn.innerHTML = 'Sign in';
            }, 800);
        }
        
        function togglePassword() {
            const input = document.getElementById('loginPassword');
            const btn = event.currentTarget;
            if (input.type === 'password') {
                input.type = 'text';
                btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>';
            } else {
                input.type = 'password';
                btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>';
            }
        }
        
        function showForgotPassword(e) {
            e.preventDefault();
            alert('Password reset functionality would be implemented here.\n\nFor demo, use any of these accounts:\n\n sarah.chen@evelynpartners.com\n james.morton@evelynpartners.com\n ciaran.osullivan@evelynpartners.com\n aoife.brennan@evelynpartners.com\n\nPassword: demo123');
        }
        
        function handleSSO() {
            alert('SSO integration would redirect to your identity provider.\n\nFor demo, please use email/password login.');
        }
        
        function logout() {
            localStorage.removeItem('evelynSession');
            isLoggedIn = false;
            showLoginScreen();
            // Reset form
            document.getElementById('loginForm').reset();
            document.getElementById('loginError').classList.remove('show');
        }
        
        function updateAdvisorUI() {
            document.getElementById('currentAdvisorAvatar').textContent = currentAdvisor.initials;
            document.getElementById('currentAdvisorName').textContent = currentAdvisor.name;
            document.getElementById('currentAdvisorRole').textContent = currentAdvisor.roleTitle;
        }

        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', () => {
            // Check if user is already logged in
            if (checkLoginStatus()) {
                renderClients();
                updateStats();
            }
        });

        // ==================== SIDEBAR (Mobile) ====================
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const backdrop = document.getElementById('sidebarBackdrop');
            sidebar.classList.toggle('open');
            backdrop.classList.toggle('open');
        }

        // ==================== ADVISOR ====================
        function switchAdvisor(advisorId) {
            currentAdvisor = config.advisors.find(a => a.id === advisorId);
            document.getElementById('currentAdvisorAvatar').textContent = currentAdvisor.initials;
            document.getElementById('currentAdvisorName').textContent = currentAdvisor.name;
            document.getElementById('currentAdvisorRole').textContent = currentAdvisor.roleTitle;
            selectedClient = null;
            renderClients();
            renderPanel();
            // Close sidebar on mobile after selection
            if (window.innerWidth <= 600) {
                toggleSidebar();
            }
        }

        // ==================== CLIENTS ====================
        function renderClients() {
            const list = document.getElementById('clientList');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            let filtered = clients.filter(c => {
                // Filter by advisor team
                const isMyClient = c.assignedAdvisor === currentAdvisor.id || c.assignedAdmin === currentAdvisor.id || 
                    (currentAdvisor.reportsTo && c.assignedAdvisor === currentAdvisor.reportsTo);
                if (!isMyClient) return false;
                
                // Filter by tab
                if (currentTab === 'draft' && c.briefcase.status !== 'draft') return false;
                if (currentTab === 'sent' && !['sent','in-progress'].includes(c.briefcase.status)) return false;
                if (currentTab === 'complete' && c.briefcase.status !== 'complete') return false;
                
                // Filter by search
                if (searchTerm) {
                    const name = c.applicants.map(a => `${a.firstName} ${a.surname}`).join(' ').toLowerCase();
                    if (!name.includes(searchTerm) && !c.clientRef.toLowerCase().includes(searchTerm)) return false;
                }
                return true;
            });

            list.innerHTML = filtered.map(client => {
                const names = client.applicants.map(a => `${a.firstName} ${a.surname}`).join(' & ');
                const initials = client.applicants.map(a => a.firstName[0]).join('');
                const progress = getProgress(client);
                const progressClass = progress === 0 ? 'low' : progress < 50 ? 'started' : progress < 100 ? 'partial' : 'complete';
                
                return `
                <div class="client-row ${selectedClient?.clientId === client.clientId ? 'selected' : ''}" onclick="selectClient('${client.clientId}')">
                    <div class="client-header">
                        <div class="client-avatar ${client.clientType} ${client.jurisdiction.toLowerCase()}">${initials}</div>
                        <div class="client-main">
                            <div class="client-top-row">
                                <div class="client-name">${names}</div>
                                <span class="status-badge ${client.briefcase.status}">${getStatusIcon(client.briefcase.status)} ${capitalise(client.briefcase.status.replace('-',' '))}</span>
                            </div>
                            <div class="client-meta-row">
                                <span class="client-type-badge ${client.clientType}">${client.clientType}</span>
                                <span class="client-meta">${client.jurisdiction === 'UK' ? '' : ''} ${client.clientRef}  ${formatCurrency(client.recommendation.investableAmount, client.jurisdiction)}</span>
                            </div>
                        </div>
                    </div>
                    <div class="client-footer">
                        <div class="client-detail">
                            <span class="detail-label">Proposition</span>
                            <span class="detail-value">${capitalise(client.recommendation.proposition)}</span>
                        </div>
                        <div class="client-progress-wrap">
                            <div class="progress-bar-bg"><div class="progress-bar-fill ${progressClass}" style="width:${progress}%"></div></div>
                            <div class="progress-text">${progress}% complete</div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        function selectClient(clientId) {
            selectedClient = clients.find(c => c.clientId === clientId);
            selectedEntity = selectedClient.recommendation.legalEntity;
            selectedProposition = selectedClient.recommendation.proposition;
            selectedForms = getRecommendedForms(selectedClient);
            renderClients();
            renderPanel();
            // Open panel on mobile
            document.getElementById('briefcasePanel').classList.add('open');
            document.getElementById('panelBackdrop').classList.add('open');
        }

        function closePanel() {
            document.getElementById('briefcasePanel').classList.remove('open');
            document.getElementById('panelBackdrop').classList.remove('open');
        }

        function deselectClient() {
            selectedClient = null;
            selectedForms = [];
            renderClients();
            renderPanel();
            closePanel();
        }

        // ==================== PANEL ====================
        function renderPanel() {
            const body = document.getElementById('builderContent');
            const empty = document.getElementById('emptyState');
            const footer = document.getElementById('panelFooter');
            const panelHeaderContent = document.querySelector('.panel-header-content');

            if (!selectedClient) {
                empty.style.display = 'block';
                body.style.display = 'none';
                footer.style.display = 'none';
                // Reset header to default
                panelHeaderContent.innerHTML = `
                    <div class="panel-title"><div class="panel-title-icon"></div>Briefcase Builder</div>
                    <p class="panel-subtitle">Select a client to build their form pack</p>
                `;
                return;
            }

            empty.style.display = 'none';
            body.style.display = 'block';

            const names = selectedClient.applicants.map(a => `${a.firstName} ${a.surname}`).join(' & ');
            const initials = selectedClient.applicants.map(a => a.firstName[0]).join('');
            const rec = selectedClient.recommendation;
            const isSent = ['sent', 'in-progress', 'complete'].includes(selectedClient.briefcase.status);
            
            // Update panel header based on status
            if (isSent) {
                const statusColors = {
                    'sent': { bg: '#EBF5FF', color: '#1E40AF', icon: '' },
                    'in-progress': { bg: '#FEF3C7', color: '#92400E', icon: '' },
                    'complete': { bg: '#D1FAE5', color: '#065F46', icon: '' }
                };
                const status = statusColors[selectedClient.briefcase.status];
                panelHeaderContent.innerHTML = `
                    <div class="panel-title"><div class="panel-title-icon">${status.icon}</div>Briefcase ${capitalise(selectedClient.briefcase.status.replace('-', ' '))}</div>
                    <p class="panel-subtitle">Review client progress and complete on their behalf</p>
                `;
            } else {
                panelHeaderContent.innerHTML = `
                    <div class="panel-title"><div class="panel-title-icon"></div>Briefcase Builder</div>
                    <p class="panel-subtitle">Select a client to build their form pack</p>
                `;
            }

            if (isSent) {
                // SENT VIEW - Read-only with progress
                footer.style.display = 'none';
                const sentForms = selectedClient.briefcase.forms || [];
                const formProgress = selectedClient.briefcase.formProgress || {};
                
                body.innerHTML = `
                    <!-- Selected Client -->
                    <div class="selected-client">
                        <div class="selected-client-header">
                            <div class="selected-client-avatar">${initials}</div>
                            <div class="selected-client-info">
                                <div class="selected-client-name">${names}</div>
                                <div class="selected-client-detail">${selectedClient.jurisdiction === 'UK' ? ' UK' : ' Ireland'}  ${capitalise(selectedClient.clientType)}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Overall Progress -->
                    <div class="sent-progress-card">
                        <div class="sent-progress-header">
                            <span class="sent-progress-label">Overall Completion</span>
                            <span class="sent-progress-value">${selectedClient.briefcase.progress || 0}%</span>
                        </div>
                        <div class="sent-progress-bar">
                            <div class="sent-progress-fill" style="width: ${selectedClient.briefcase.progress || 0}%"></div>
                        </div>
                        <div class="sent-progress-meta">
                            <span>Sent: ${selectedClient.briefcase.sentDate || 'Today'}</span>
                            <span>Last activity: ${selectedClient.briefcase.lastActivity || 'Pending'}</span>
                        </div>
                    </div>

                    <!-- Advice Summary -->
                    <div class="advice-summary">
                        <div class="advice-row"><span class="advice-label">Risk Profile</span><span class="advice-value">${capitalise(rec.riskProfile)}</span></div>
                        <div class="advice-row"><span class="advice-label">Investable</span><span class="advice-value">${formatCurrency(rec.investableAmount, selectedClient.jurisdiction)}</span></div>
                        <div class="advice-row"><span class="advice-label">Accounts</span><span class="advice-value">${rec.recommendedAccounts.map(a => a.type.toUpperCase()).join(', ')}</span></div>
                    </div>

                    <!-- Forms Progress -->
                    <div class="panel-section">
                        <div class="panel-section-title"> Forms Progress</div>
                        ${sentForms.map(formId => {
                            const form = config.forms.find(f => f.id === formId);
                            if (!form) return '';
                            const progress = formProgress[formId] || 0;
                            const isDeclaration = formId === 'declarations';
                            const statusClass = progress === 100 ? 'complete' : progress > 0 ? 'in-progress' : 'pending';
                            const statusText = progress === 100 ? 'Complete' : progress > 0 ? `${progress}%` : 'Not started';
                            
                            return `
                            <div class="form-progress-card ${statusClass}" onclick="${isDeclaration ? 'showDeclarationNotice()' : `openFormReview('${formId}')`}">
                                <div class="form-progress-icon ${form.class}">${form.icon}</div>
                                <div class="form-progress-info">
                                    <div class="form-progress-name">${form.name}</div>
                                    <div class="form-progress-bar-wrap">
                                        <div class="form-progress-bar">
                                            <div class="form-progress-bar-fill" style="width: ${progress}%"></div>
                                        </div>
                                        <span class="form-progress-status ${statusClass}">${statusText}</span>
                                    </div>
                                </div>
                                <div class="form-progress-action">
                                    ${isDeclaration ? '' : ''}
                                </div>
                            </div>`;
                        }).join('')}
                    </div>

                    <!-- Actions -->
                    <div class="panel-section">
                        <div class="sent-actions">
                            <button class="btn btn-secondary" onclick="sendReminder()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 17H2a3 3 0 0 0 3-3V9a7 7 0 0 1 14 0v5a3 3 0 0 0 3 3zm-8.27 4a2 2 0 0 1-3.46 0"/></svg>
                                Send Reminder
                            </button>
                            <button class="btn btn-secondary" onclick="resendBriefcase()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>
                                Resend
                            </button>
                        </div>
                    </div>
                `;
            } else {
                // DRAFT VIEW - Original builder
                footer.style.display = 'block';
                const availableForms = config.forms.filter(f => f.jurisdiction.includes(selectedClient.jurisdiction));

                body.innerHTML = `
                    <!-- Selected Client -->
                    <div class="selected-client">
                        <div class="selected-client-header">
                            <div class="selected-client-avatar">${initials}</div>
                            <div class="selected-client-info">
                                <div class="selected-client-name">${names}</div>
                                <div class="selected-client-detail">${selectedClient.jurisdiction === 'UK' ? ' UK' : ' Ireland'}  ${capitalise(selectedClient.clientType)}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Advice Summary -->
                    <div class="advice-summary">
                        <div class="advice-row"><span class="advice-label">Risk Profile</span><span class="advice-value">${capitalise(rec.riskProfile)}</span></div>
                        <div class="advice-row"><span class="advice-label">Investable</span><span class="advice-value">${formatCurrency(rec.investableAmount, selectedClient.jurisdiction)}</span></div>
                        <div class="advice-row"><span class="advice-label">Accounts</span><span class="advice-value">${rec.recommendedAccounts.map(a => a.type.toUpperCase()).join(', ')}</span></div>
                    </div>

                    <!-- Entity & Proposition -->
                    <div class="panel-section">
                        <div class="panel-section-title"> Legal Entity & Proposition</div>
                        <div class="selector-grid">
                            ${config.entities.filter(e => e.jurisdiction === selectedClient.jurisdiction).map(e => `
                                <div class="selector-option ${selectedEntity === e.id ? 'selected' : ''}" onclick="selectEntity('${e.id}')">
                                    <div class="selector-icon">${e.jurisdiction === 'UK' ? '' : ''}</div>
                                    <div class="selector-label">${e.shortName}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="selector-grid">
                            ${config.propositions.map(p => `
                                <div class="selector-option ${selectedProposition === p.id ? 'selected' : ''}" onclick="selectProposition('${p.id}')">
                                    <div class="selector-label">${p.name}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Form Selection -->
                    <div class="panel-section">
                        <div class="panel-section-title"> Forms to Include</div>
                        ${availableForms.map(f => {
                            const isSelected = selectedForms.includes(f.id);
                            const isRecommended = isFormRecommended(f, selectedClient);
                            return `
                            <div class="form-option ${isSelected ? 'selected' : ''} ${isRecommended ? 'required' : ''}" onclick="toggleForm('${f.id}')">
                                <div class="form-checkbox">${isSelected ? '' : ''}</div>
                                <div class="form-icon ${f.class}">${f.icon}</div>
                                <div class="form-info">
                                    <div class="form-name">${f.name}</div>
                                    <div class="form-desc">${f.category}</div>
                                </div>
                                ${isRecommended ? '<span class="form-badge">REC</span>' : ''}
                            </div>`;
                        }).join('')}
                    </div>

                    <!-- Delivery Method -->
                    <div class="panel-section">
                        <div class="panel-section-title"> Delivery Method</div>
                        <div class="delivery-options">
                            <div class="delivery-option ${deliveryMethod === 'email' ? 'selected' : ''}" onclick="setDelivery('email')">
                                <div class="delivery-icon"></div>
                                <div class="delivery-info">
                                    <div class="delivery-name">Email</div>
                                    <div class="delivery-desc">Send secure link via email</div>
                                </div>
                                <div class="delivery-check">${deliveryMethod === 'email' ? '' : ''}</div>
                            </div>
                            <div class="delivery-option ${deliveryMethod === 'sms' ? 'selected' : ''}" onclick="setDelivery('sms')">
                                <div class="delivery-icon"></div>
                                <div class="delivery-info">
                                    <div class="delivery-name">SMS</div>
                                    <div class="delivery-desc">Send link via text message</div>
                                </div>
                                <div class="delivery-check">${deliveryMethod === 'sms' ? '' : ''}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Personal Message -->
                    <div class="panel-section">
                        <div class="panel-section-title"> Personal Message <span class="optional-label">(optional)</span></div>
                        <textarea class="message-textarea" id="personalMessage" placeholder="Add a personal note to your client..."></textarea>
                    </div>
                `;

                updateSummary();
            }
        }

        function selectEntity(entityId) { selectedEntity = entityId; renderPanel(); }
        function selectProposition(propId) { selectedProposition = propId; selectedForms = getRecommendedForms(selectedClient); renderPanel(); }
        function setDelivery(method) { deliveryMethod = method; renderPanel(); }

        function toggleForm(formId) {
            if (selectedForms.includes(formId)) {
                selectedForms = selectedForms.filter(f => f !== formId);
            } else {
                selectedForms.push(formId);
            }
            renderPanel();
        }

        function updateSummary() {
            document.getElementById('formCountSummary').textContent = selectedForms.length;
            document.getElementById('deliverySummary').textContent = capitalise(deliveryMethod);
            document.getElementById('sendBtn').disabled = selectedForms.length === 0;
        }

        // ==================== SENT BRIEFCASE ACTIONS ====================
        let currentFormUrl = '';
        
        function openFormReview(formId) {
            const form = config.forms.find(f => f.id === formId);
            if (!form || !selectedClient) return;
            
            // Build URL with advisor mode parameters
            const params = new URLSearchParams({
                mode: 'advisor',
                clientId: selectedClient.clientId,
                clientRef: selectedClient.clientRef,
                advisorId: currentAdvisor.id,
                advisorName: currentAdvisor.name
            });
            
            const url = `${form.file}?${params.toString()}`;
            openFormModal(url, form.name);
        }
        
        function openFormModal(url, formName) {
            currentFormUrl = url;
            const clientNames = selectedClient.applicants.map(a => a.firstName).join(' & ');
            
            document.getElementById('formModalTitle').textContent = formName;
            document.getElementById('formModalSubtitle').textContent = `Reviewing for ${clientNames}  ${selectedClient.clientRef}`;
            document.getElementById('formModalIframe').src = url;
            document.getElementById('formModalOverlay').classList.add('show');
            document.body.style.overflow = 'hidden';
        }
        
        function closeFormModal() {
            document.getElementById('formModalOverlay').classList.remove('show');
            document.getElementById('formModalIframe').src = 'about:blank';
            document.body.style.overflow = '';
            currentFormUrl = '';
            
            // Refresh the panel to show any progress updates
            renderPanel();
        }
        
        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const formModal = document.getElementById('formModalOverlay');
                if (formModal && formModal.classList.contains('show')) {
                    closeFormModal();
                }
            }
        });
        
        function openFormInNewTab() {
            if (currentFormUrl) {
                window.open(currentFormUrl, '_blank');
            }
        }
        
        function showDeclarationNotice() {
            alert(' Declarations & Signatures\n\nThis section must be completed by the client directly.\n\nDeclarations and electronic signatures cannot be completed on behalf of the client for regulatory compliance reasons.');
        }
        
        function sendReminder() {
            if (!selectedClient) return;
            const names = selectedClient.applicants.map(a => a.firstName).join(' & ');
            alert(` Reminder sent to ${names}\n\nThe client will receive an email reminder to complete their outstanding forms.`);
        }
        
        function resendBriefcase() {
            if (!selectedClient) return;
            const names = selectedClient.applicants.map(a => a.firstName).join(' & ');
            if (confirm(`Resend briefcase to ${names}?\n\nThis will send a new email with a fresh link to all forms.`)) {
                alert(' Briefcase resent successfully!');
            }
        }

        // ==================== HELPERS ====================
        function getRecommendedForms(client) {
            const forms = ['client-agreement', 'declarations'];
            if (selectedProposition === 'discretionary') forms.push('discretionary-mandate', 'risk-profile-confirmation');
            if (selectedProposition === 'advisory') forms.push('advisory-terms', 'risk-profile-confirmation');
            client.recommendation.recommendedAccounts.forEach(acc => {
                if (!forms.includes(acc.type)) forms.push(acc.type);
            });
            return forms.filter(f => config.forms.find(cf => cf.id === f)?.jurisdiction.includes(client.jurisdiction));
        }

        function isFormRecommended(form, client) {
            const recForms = getRecommendedForms(client);
            return recForms.includes(form.id);
        }

        function getProgress(client) {
            if (client.briefcase.status === 'complete') return 100;
            if (client.briefcase.status === 'draft') return 0;
            if (client.briefcase.progress) return client.briefcase.progress;
            if (client.factFind.progress) return client.factFind.progress;
            if (client.briefcase.status === 'sent') return 10;
            return 50;
        }

        function formatCurrency(amount, jurisdiction) {
            const symbol = jurisdiction === 'UK' ? '' : '';
            return symbol + (amount/1000).toFixed(0) + 'k';
        }

        function capitalise(str) { return str ? str.charAt(0).toUpperCase() + str.slice(1) : ''; }

        function getStatusIcon(status) {
            const icons = { draft: '', sent: '', 'in-progress': '', complete: '' };
            return icons[status] || '';
        }

        function insertTemplate(type) {
            const name = selectedClient.applicants[0].firstName;
            const templates = {
                standard: `Dear ${name},\n\nPlease find attached your onboarding forms. Take your time reviewing them.\n\nBest regards,\n${currentAdvisor.name.split(' ')[0]}`,
                urgent: `Dear ${name},\n\nPlease complete the attached forms at your earliest convenience as we approach the tax year deadline.\n\nKind regards,\n${currentAdvisor.name.split(' ')[0]}`,
                reminder: `Dear ${name},\n\nJust a gentle reminder about the outstanding forms. Please let me know if you have any questions.\n\nBest,\n${currentAdvisor.name.split(' ')[0]}`
            };
            document.getElementById('personalMessage').value = templates[type];
        }

        // ==================== ACTIONS ====================
        function setTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            renderClients();
        }

        function filterClients() { renderClients(); }

        function sendBriefcase() {
            const btn = document.getElementById('sendBtn');
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner"></div> Sending...';
            
            // Simulate sending delay
            setTimeout(() => {
                const ref = `EP-BRF-${Date.now().toString().slice(-6)}`;
                const clientIndex = clients.findIndex(c => c.clientId === selectedClient.clientId);
                clients[clientIndex].briefcase = { 
                    status: 'sent', 
                    forms: selectedForms, 
                    sentAt: new Date().toISOString(),
                    progress: 0,
                    sentDate: 'Just now',
                    lastActivity: 'Pending',
                    formProgress: selectedForms.reduce((acc, f) => { acc[f] = 0; return acc; }, {})
                };
                
                document.getElementById('modalClient').textContent = selectedClient.applicants.map(a => `${a.firstName} ${a.surname}`).join(' & ');
                document.getElementById('modalForms').textContent = selectedForms.length + ' forms';
                document.getElementById('modalRef').textContent = ref;
                document.getElementById('successModal').classList.add('show');
                
                // Reset button
                btn.disabled = false;
                btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg> Send Briefcase';
                
                deselectClient();
                updateStats();
            }, 1000);
        }

        function closeModal() {
            document.getElementById('successModal').classList.remove('show');
        }

        function updateStats() {
            const myClients = clients.filter(c => c.assignedAdvisor === currentAdvisor.id || c.assignedAdmin === currentAdvisor.id);
            
            // Animate stat updates
            animateValue('statSent', myClients.filter(c => ['sent','in-progress','complete'].includes(c.briefcase.status)).length);
            animateValue('statComplete', myClients.filter(c => c.briefcase.status === 'complete').length);
            animateValue('statPending', myClients.filter(c => ['sent','in-progress'].includes(c.briefcase.status)).length);
            document.getElementById('totalClientsBadge').textContent = myClients.length;
        }
        
        function animateValue(elementId, newValue) {
            const el = document.getElementById(elementId);
            const currentValue = parseInt(el.textContent) || 0;
            if (currentValue === newValue) return;
            
            el.style.transform = 'scale(1.2)';
            el.style.transition = 'transform 0.2s ease';
            
            setTimeout(() => {
                el.textContent = newValue;
                el.style.transform = 'scale(1)';
            }, 200);
        }
    </script>
</body>
</html>
