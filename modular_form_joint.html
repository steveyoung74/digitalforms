<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Form - Evelyn Partners</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(135deg, #6b4c9a 0%, #8b6baf 100%);
            color: white;
            padding: 40px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            bottom: -50px;
            left: -100px;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 15px 15px;
            transform: rotate(-15deg);
        }

        .header::after {
            content: '';
            position: absolute;
            top: -50px;
            right: -100px;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 15px 15px;
            transform: rotate(15deg);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 300;
            letter-spacing: 2px;
            text-transform: uppercase;
            position: relative;
            z-index: 1;
        }

        .journey-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .application-type-badge {
            display: inline-block;
            background: rgba(255,255,255,0.3);
            padding: 6px 14px;
            border-radius: 15px;
            font-size: 11px;
            margin-left: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Joint Application Styles */
        .customer-section {
            margin-bottom: 40px;
        }

        .customer-header {
            background: linear-gradient(90deg, #6b4c9a, #8b6baf);
            color: white;
            padding: 15px 25px;
            margin-bottom: 25px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 10px rgba(107, 76, 154, 0.2);
        }

        .customer-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .customer-title {
            flex: 1;
        }

        .customer-title h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .customer-title .subtitle {
            font-size: 12px;
            opacity: 0.9;
        }

        .joint-divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, #6b4c9a, transparent);
            margin: 40px 0;
            position: relative;
        }

        .joint-divider::after {
            content: 'AND';
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 5px 15px;
            color: #6b4c9a;
            font-weight: 600;
            font-size: 12px;
            letter-spacing: 2px;
        }

        /* Hide customer 2 sections by default */
        .customer-2-section {
            display: none;
        }

        /* Show when joint application */
        body.joint-application .customer-2-section {
            display: block;
        }

        body.joint-application .customer-1-section .customer-header {
            background: linear-gradient(90deg, #1976d2, #42a5f5);
        }

        body.joint-application .customer-2-section .customer-header {
            background: linear-gradient(90deg, #7b1fa2, #ba68c8);
        }

        .content {
            padding: 40px;
        }

        .intro-text {
            font-size: 14px;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.8;
        }

        .intro-text a {
            color: #6b4c9a;
            text-decoration: none;
        }

        .intro-text a:hover {
            text-decoration: underline;
        }

        /* Module System */
        .form-module {
            display: none; /* Hidden by default */
            margin-bottom: 40px;
            animation: fadeIn 0.5s ease-in;
        }

        .form-module.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            background: #6b4c9a;
            color: white;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-number {
            background: rgba(255,255,255,0.2);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 13px;
            color: #555;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .required::after {
            content: '*';
            color: #d32f2f;
            margin-left: 3px;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        input[type="number"],
        select,
        textarea {
            padding: 10px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="tel"]:focus,
        input[type="date"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #6b4c9a;
            box-shadow: 0 0 0 3px rgba(107, 76, 154, 0.1);
        }

        input:invalid:not(:placeholder-shown) {
            border-color: #d32f2f;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        input[type="radio"],
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #6b4c9a;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        th {
            background: #f5f5f5;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border: 1px solid #ddd;
            font-size: 12px;
        }

        td {
            padding: 10px;
            border: 1px solid #ddd;
        }

        td input[type="text"] {
            width: 100%;
        }

        .tax-row {
            background: #fafafa;
        }

        .note-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            font-size: 13px;
            color: #856404;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            font-size: 13px;
            color: #0d47a1;
        }

        .declaration-box {
            background: #f9f9f9;
            border: 2px solid #6b4c9a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .declaration-box p {
            margin-bottom: 15px;
            line-height: 1.8;
            font-size: 14px;
        }

        .signature-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .submit-button {
            background: #6b4c9a;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            width: 100%;
            margin-top: 20px;
        }

        .submit-button:hover {
            background: #5a3d87;
        }

        .yes-no-group {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 15px;
            align-items: center;
            padding: 10px;
            background: #fafafa;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .yes-no-options {
            display: flex;
            gap: 30px;
        }

        .footer {
            background: #f5f5f5;
            padding: 30px 40px;
            border-top: 3px solid #6b4c9a;
            position: relative;
        }

        .footer-logo {
            font-size: 36px;
            color: #6b4c9a;
            font-weight: 300;
            margin-bottom: 15px;
        }

        .footer-logo span {
            color: #8b6baf;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .footer-text {
            font-size: 11px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .progress-indicator {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6b4c9a, #8b6baf);
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 12px;
            color: #666;
            text-align: center;
        }

        .module-list {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .module-list h3 {
            font-size: 14px;
            color: #6b4c9a;
            margin-bottom: 10px;
        }

        .module-list ul {
            list-style: none;
            font-size: 13px;
        }

        .module-list li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
        }

        .module-list li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: #4caf50;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .signature-section {
                grid-template-columns: 1fr;
            }

            .content {
                padding: 20px;
            }

            .header {
                padding: 30px 20px;
            }
        }

        @media print {
            body {
                background: white;
            }

            .container {
                box-shadow: none;
            }

            .submit-button {
                display: none;
            }

            .progress-indicator {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Individual Self-Certification Form</h1>
            <div class="journey-badge" id="journeyType">Standard Journey</div>
            <span class="application-type-badge" id="applicationType">Individual Application</span>
        </div>

        <div class="content">
            <!-- Progress Indicator -->
            <div class="progress-indicator">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="progress-text" id="progressText">Loading form modules...</div>
            </div>

            <!-- Active Modules List -->
            <div class="module-list" id="moduleList" style="display: none;">
                <h3>Required Sections for This Journey:</h3>
                <ul id="moduleListItems"></ul>
            </div>

            <div class="intro-text">
                <p>For further information in relation to our use of your personal information, you can view our Privacy Notice at 
                <a href="https://www.evelyn.com/legal-compliance-regulatory/privacy-notices" target="_blank">https://www.evelyn.com/legal-compliance-regulatory/privacy-notices</a> or you can contact your Evelyn Partners 
                relationship manager. If you have any questions about how we handle your personal information, you can email us at 
                <a href="mailto:dataprotection@evelyn.com">dataprotection@evelyn.com</a>.</p>
            </div>

            <form id="dynamicForm" novalidate>
                
                <!-- MODULE 1: CUSTOMER IDENTIFICATION -->
                <div class="form-module" id="module-customer-identification" data-module="customer-identification">
                    <div class="section-title">
                        <span class="section-number">1</span>
                        Customer Identification
                    </div>

                    <p style="margin-bottom: 20px; font-weight: 500;">Name of Account Holder/Beneficial Owner (please cross out as appropriate):</p>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="required">Title</label>
                            <select name="title" required>
                                <option value="">Please select...</option>
                                <option value="Mr">Mr</option>
                                <option value="Mrs">Mrs</option>
                                <option value="Miss">Miss</option>
                                <option value="Ms">Ms</option>
                                <option value="Dr">Dr</option>
                                <option value="Prof">Prof</option>
                                <option value="Rev">Rev</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="required">First name</label>
                            <input type="text" name="firstName" required pattern="[A-Za-z\s\-']+" title="Please enter a valid first name">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="required">Middle name(s)</label>
                            <input type="text" name="middleNames" required pattern="[A-Za-z\s\-']+">
                        </div>

                        <div class="form-group">
                            <label class="required">Surname</label>
                            <input type="text" name="surname" required pattern="[A-Za-z\s\-']+">
                        </div>
                    </div>

                    <div class="form-row full">
                        <div class="form-group">
                            <label>Former name(s)</label>
                            <input type="text" name="formerNames" pattern="[A-Za-z\s\-']+">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="required">Date of birth</label>
                            <input type="date" name="dateOfBirth" required max="9999-12-31">
                        </div>

                        <div class="form-group">
                            <label class="required">Place of birth</label>
                            <input type="text" name="placeOfBirth" required>
                        </div>
                    </div>

                    <div class="form-row full">
                        <div class="form-group">
                            <label class="required">Country of birth</label>
                            <input type="text" name="countryOfBirth" required>
                        </div>
                    </div>
                </div>

                <!-- MODULE 2: CONTACT DETAILS -->
                <div class="form-module" id="module-contact-details" data-module="contact-details">
                    <div class="section-title">
                        <span class="section-number">2</span>
                        Contact Details
                    </div>

                    <div class="form-row full">
                        <div class="form-group">
                            <label class="required">Permanent residential address</label>
                            <textarea name="permanentAddress" required rows="3"></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="required">Postcode</label>
                            <input type="text" name="postcode" required pattern="[A-Za-z0-9\s]+" style="text-transform: uppercase;">
                        </div>
                    </div>

                    <div class="form-row full">
                        <div class="form-group">
                            <label>Address for correspondence (if not as above)</label>
                            <textarea name="correspondenceAddress" rows="3"></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Postcode</label>
                            <input type="text" name="correspondencePostcode" pattern="[A-Za-z0-9\s]+" style="text-transform: uppercase;">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="required">Primary contact number</label>
                            <input type="tel" name="primaryPhone" required pattern="[0-9\s\+\-\(\)]+" title="Please enter a valid phone number">
                        </div>

                        <div class="form-group">
                            <label>Secondary number</label>
                            <input type="tel" name="secondaryPhone" pattern="[0-9\s\+\-\(\)]+">
                        </div>
                    </div>

                    <div class="form-row full">
                        <div class="form-group">
                            <label class="required">Email address</label>
                            <input type="email" name="email" required>
                        </div>
                    </div>

                    <div class="form-row full">
                        <div class="form-group">
                            <label class="required">Marital status</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="single" name="maritalStatus" value="single" required>
                                    <label for="single">Single</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="married" name="maritalStatus" value="married">
                                    <label for="married">Married</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="partner" name="maritalStatus" value="partner">
                                    <label for="partner">Living with partner</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="civilPartnership" name="maritalStatus" value="civilPartnership">
                                    <label for="civilPartnership">Civil partnership</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="divorced" name="maritalStatus" value="divorced">
                                    <label for="divorced">Divorced</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="widowed" name="maritalStatus" value="widowed">
                                    <label for="widowed">Widowed</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MODULE 3: PREVIOUS ADDRESS -->
                <div class="form-module" id="module-previous-address" data-module="previous-address">
                    <div class="section-title">
                        <span class="section-number">3</span>
                        Previous Address
                    </div>

                    <div class="form-row full">
                        <div class="form-group">
                            <label>Previous Address</label>
                            <textarea name="previousAddress" rows="3"></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Postcode</label>
                            <input type="text" name="previousPostcode" pattern="[A-Za-z0-9\s]+" style="text-transform: uppercase;">
                        </div>
                    </div>
                </div>

                <!-- MODULE 4: TAX RESIDENCY -->
                <div class="form-module" id="module-tax-residency" data-module="tax-residency">
                    <div class="section-title">
                        <span class="section-number">4</span>
                        Tax Residency/Citizenship Information
                    </div>

                    <p style="margin-bottom: 20px;">Please list all countries in which you are a citizen and/or resident for tax purposes and include the relevant tax reference number:</p>

                    <div class="table-container">
                        <table id="taxTable">
                            <thead>
                                <tr>
                                    <th style="width: 20%;">Country/Countries</th>
                                    <th style="width: 15%;">Tax Resident<br>(please tick)</th>
                                    <th style="width: 15%;">Citizen<br>(please tick)</th>
                                    <th style="width: 30%;">Local Tax Identification Number (TIN)<br><small>(if UK, use National Insurance Number)</small></th>
                                    <th style="width: 20%;">TIN Type<br><small>(if UK, it is National Insurance Number)</small></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="tax-row">
                                    <td><input type="text" name="country1" placeholder="Country name"></td>
                                    <td style="text-align: center;"><input type="checkbox" name="taxResident1"></td>
                                    <td style="text-align: center;"><input type="checkbox" name="citizen1"></td>
                                    <td><input type="text" name="tin1" placeholder="TIN"></td>
                                    <td><input type="text" name="tinType1" placeholder="e.g., NIN, SSN"></td>
                                </tr>
                                <tr class="tax-row">
                                    <td><input type="text" name="country2" placeholder="Country name"></td>
                                    <td style="text-align: center;"><input type="checkbox" name="taxResident2"></td>
                                    <td style="text-align: center;"><input type="checkbox" name="citizen2"></td>
                                    <td><input type="text" name="tin2" placeholder="TIN"></td>
                                    <td><input type="text" name="tinType2" placeholder="e.g., NIN, SSN"></td>
                                </tr>
                                <tr class="tax-row">
                                    <td><input type="text" name="country3" placeholder="Country name"></td>
                                    <td style="text-align: center;"><input type="checkbox" name="taxResident3"></td>
                                    <td style="text-align: center;"><input type="checkbox" name="citizen3"></td>
                                    <td><input type="text" name="tin3" placeholder="TIN"></td>
                                    <td><input type="text" name="tinType3" placeholder="e.g., NIN, SSN"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <p style="margin-top: 20px; margin-bottom: 15px; font-weight: 500;">If the country does not issue a TIN or if a TIN cannot be obtained, please tick the reason why below:</p>

                    <div class="checkbox-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="reasonA" name="noTinReason" value="reasonA">
                            <label for="reasonA">Reason A: The Country does not issue TINs to its residents</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="reasonB" name="noTinReason" value="reasonB">
                            <label for="reasonB">Reason B: No TIN required (authorities do not require a TIN to be collected)</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="reasonC" name="noTinReason" value="reasonC">
                            <label for="reasonC">Reason C: Other (add reason why in the below box)</label>
                        </div>
                    </div>

                    <div class="form-row full" style="margin-top: 15px;">
                        <div class="form-group">
                            <label>If "Reason C" ticked, please explain why you are unable to provide a TIN:</label>
                            <textarea name="reasonCExplanation" rows="3"></textarea>
                        </div>
                    </div>
                </div>

                <!-- MODULE 5: US PERSON STATUS -->
                <div class="form-module" id="module-us-person" data-module="us-person">
                    <div class="section-title">
                        <span class="section-number">5</span>
                        US Person Status
                    </div>

                    <p style="margin-bottom: 15px; font-weight: 500;">Please answer the following questions (please tick YES or NO):</p>

                    <div class="yes-no-group">
                        <span>Do you hold a valid US Green Card?</span>
                        <div class="yes-no-options">
                            <div class="radio-option">
                                <input type="radio" id="greenCardYes" name="greenCard" value="yes" required>
                                <label for="greenCardYes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="greenCardNo" name="greenCard" value="no">
                                <label for="greenCardNo">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="yes-no-group">
                        <span>Were you born in the US or a US protectorate (i.e. Puerto Rico, US Virgin Islands, Guam)?</span>
                        <div class="yes-no-options">
                            <div class="radio-option">
                                <input type="radio" id="bornUSYes" name="bornUS" value="yes" required>
                                <label for="bornUSYes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="bornUSNo" name="bornUS" value="no">
                                <label for="bornUSNo">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="yes-no-group">
                        <span>Is or was one or both of your parents a US citizen?</span>
                        <div class="yes-no-options">
                            <div class="radio-option">
                                <input type="radio" id="parentsUSYes" name="parentsUS" value="yes" required>
                                <label for="parentsUSYes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="parentsUSNo" name="parentsUS" value="no">
                                <label for="parentsUSNo">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="note-box" style="margin-top: 20px;">
                        <strong>Note:</strong> If you are a US citizen, US tax resident, or other US person including a resident alien, please also enclose a duly completed and signed IRS 
                        form W-9 - Request for Taxpayer Identification Number and Certification. You can download this form from the IRS website.
                    </div>
                </div>

                <!-- MODULE 6: MARKETING PREFERENCES -->
                <div class="form-module" id="module-marketing" data-module="marketing">
                    <div class="section-title">
                        <span class="section-number">6</span>
                        Marketing Preferences
                    </div>

                    <p style="margin-bottom: 15px;">From time-to-time we would like to share information with you on investment guides and news, events and other 
                    ways we can help you. Our primary method for sharing this information is by email, but we may occasionally send 
                    information through the post or over the phone.</p>

                    <p style="margin-bottom: 20px; font-style: italic;">These communications are <strong>optional</strong> and separate from any service based messages required under regulations 
                    relating to products or services that you may hold.</p>

                    <div style="background: #f5f5f5; padding: 20px; border-radius: 4px;">
                        <p style="font-weight: 600; margin-bottom: 15px;">Consent given</p>

                        <div class="yes-no-group">
                            <span>I am happy to receive marketing communications and event invitations by email</span>
                            <div class="yes-no-options">
                                <div class="radio-option">
                                    <input type="radio" id="marketingEmailYes" name="marketingEmail" value="yes" required>
                                    <label for="marketingEmailYes">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="marketingEmailNo" name="marketingEmail" value="no">
                                    <label for="marketingEmailNo">No</label>
                                </div>
                            </div>
                        </div>

                        <div class="yes-no-group">
                            <span>I am happy to receive marketing communications and event invitations by post</span>
                            <div class="yes-no-options">
                                <div class="radio-option">
                                    <input type="radio" id="marketingPostYes" name="marketingPost" value="yes" required>
                                    <label for="marketingPostYes">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="marketingPostNo" name="marketingPost" value="no">
                                    <label for="marketingPostNo">No</label>
                                </div>
                            </div>
                        </div>

                        <div class="yes-no-group">
                            <span>I am happy to receive marketing communications and event invitations by telephone</span>
                            <div class="yes-no-options">
                                <div class="radio-option">
                                    <input type="radio" id="marketingPhoneYes" name="marketingPhone" value="yes" required>
                                    <label for="marketingPhoneYes">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="marketingPhoneNo" name="marketingPhone" value="no">
                                    <label for="marketingPhoneNo">No</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MODULE 7: DECLARATION -->
                <div class="form-module" id="module-declaration" data-module="declaration">
                    <div class="section-title">
                        <span class="section-number">7</span>
                        Declaration and Signature
                    </div>

                    <div class="declaration-box">
                        <p>I declare that I am not tax resident in, or citizen of, any other country beside those listed above and confirm that all 
                        the information provided on this form is to the best of my knowledge and belief, accurate and complete.</p>

                        <p>I agree to notify Evelyn Partners within 30 days of any changes to the information provided in this form and to 
                        provide a suitably updated Self-Certification form within 90 days of such a change.</p>

                        <p>I certify that I am the beneficial owner or am authorised to sign for the individual who is the beneficial owner of 
                        all the income to which this form relates and/or am using this form to document myself as an individual who is the 
                        Account Holder.</p>
                    </div>

                    <div class="signature-section">
                        <div class="form-group">
                            <label class="required">Full name</label>
                            <input type="text" name="signatureName" required pattern="[A-Za-z\s\-']+">
                        </div>

                        <div class="form-group">
                            <label class="required">Date</label>
                            <input type="date" name="signatureDate" required max="9999-12-31">
                        </div>
                    </div>

                    <div class="form-row full" style="margin-top: 20px;">
                        <div class="form-group">
                            <label>If you have signed this form on behalf of the beneficial owner, please indicate the capacity in which you are acting:</label>
                            <input type="text" name="signingCapacity" placeholder="e.g., Power of Attorney, Court of Protection Deputy">
                        </div>
                    </div>

                    <div class="form-row full">
                        <div class="form-group">
                            <label class="required">Electronic Signature</label>
                            <input type="text" name="electronicSignature" required placeholder="Type your full name as signature" pattern="[A-Za-z\s\-']+">
                            <small style="color: #666; margin-top: 5px; display: block;">By typing your name, you are electronically signing this document</small>
                        </div>
                    </div>

                    <button type="submit" class="submit-button">Submit Form</button>
                </div>

            </form>
        </div>

        <div class="footer">
            <div class="footer-logo">
                evelyn<br>
                <span>PARTNERS</span>
            </div>
            <div class="footer-text">
                <p>Evelyn Partners Investment Management Services Limited (Reg. No. 02830297), Evelyn Partners Discretionary Investment Management Limited 
                (Reg. No. 02519968) Evelyn Partners Investment Management LLP (Reg. No. OC 369632) and Evelyn Partners Investment Services Limited (Reg. No. 976145) 
                are authorised and regulated by the Financial Conduct Authority. Registered office: 45 Gresham Street, London EC2V 7BG.</p>

                <p style="margin-top: 10px;"><strong>www.evelyn.com</strong></p>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // MODULAR FORM SYSTEM
        // ==========================================

        // n8n Webhook Configuration
        const N8N_WEBHOOK_URL = 'YOUR_N8N_WEBHOOK_URL_HERE';
        
        const form = document.getElementById('dynamicForm');

        // Define all available modules
        const MODULE_DEFINITIONS = {
            'customer-identification': {
                name: 'Customer Identification',
                description: 'Basic personal information'
            },
            'contact-details': {
                name: 'Contact Details',
                description: 'Address and contact information'
            },
            'previous-address': {
                name: 'Previous Address',
                description: 'Previous residential information'
            },
            'tax-residency': {
                name: 'Tax Residency',
                description: 'Tax citizenship and residency details'
            },
            'us-person': {
                name: 'US Person Status',
                description: 'US citizenship verification'
            },
            'marketing': {
                name: 'Marketing Preferences',
                description: 'Communication preferences'
            },
            'declaration': {
                name: 'Declaration & Signature',
                description: 'Final declaration and signature'
            }
        };

        // Get URL parameters
        function getURLParams() {
            const params = new URLSearchParams(window.location.search);
            const result = {};
            for (const [key, value] of params.entries()) {
                result[key] = value;
            }
            return result;
        }

        // Initialize form modules based on URL parameters
        function initializeModules() {
            const urlParams = getURLParams();
            
            // Get modules from URL parameter (comma-separated)
            // Example: ?modules=customer-identification,contact-details,tax-residency
            const modulesParam = urlParams.modules || '';
            const requestedModules = modulesParam ? modulesParam.split(',') : [];
            
            // Get journey type
            const journeyType = urlParams.journey || 'Standard';
            document.getElementById('journeyType').textContent = journeyType + ' Journey';
            
            // Get application type (individual or joint)
            const applicationType = urlParams.applicationType || 'individual';
            const isJoint = applicationType === 'joint';
            
            // Update application type badge
            const appTypeBadge = document.getElementById('applicationType');
            if (isJoint) {
                appTypeBadge.textContent = 'Joint Application';
                document.body.classList.add('joint-application');
            } else {
                appTypeBadge.textContent = 'Individual Application';
            }
            
            // If no modules specified, show all modules (default behavior)
            if (requestedModules.length === 0) {
                requestedModules.push(
                    'customer-identification',
                    'contact-details',
                    'tax-residency',
                    'us-person',
                    'marketing',
                    'declaration'
                );
            }
            
            // If joint application, wrap relevant modules with customer headers
            if (isJoint) {
                wrapModulesForJoint(requestedModules);
            }
            
            // Activate requested modules
            let sectionNumber = 1;
            requestedModules.forEach(moduleId => {
                const moduleElement = document.getElementById(`module-${moduleId}`);
                if (moduleElement) {
                    moduleElement.classList.add('active');
                    
                    // Update section number
                    const sectionNumberElement = moduleElement.querySelector('.section-number');
                    if (sectionNumberElement) {
                        sectionNumberElement.textContent = sectionNumber;
                    }
                    sectionNumber++;
                }
            });
            
            // Show module list
            displayModuleList(requestedModules);
            
            // Update progress
            updateProgress();
            
            // Auto-populate form fields from URL
            populateFormFromURL(urlParams);
        }
        
        // Wrap modules with customer headers for joint applications
        function wrapModulesForJoint(modules) {
            // Modules that should be duplicated for each customer
            const perCustomerModules = ['customer-identification', 'contact-details', 'previous-address', 'tax-residency', 'us-person'];
            
            // Modules that are shared (only one instance)
            const sharedModules = ['marketing', 'declaration'];
            
            modules.forEach(moduleId => {
                const moduleElement = document.getElementById(`module-${moduleId}`);
                if (!moduleElement) return;
                
                if (perCustomerModules.includes(moduleId)) {
                    // This module should appear for each customer
                    // Wrap in customer 1 section
                    if (!moduleElement.classList.contains('wrapped')) {
                        const customer1Wrapper = document.createElement('div');
                        customer1Wrapper.className = 'customer-section customer-1-section';
                        customer1Wrapper.innerHTML = `
                            <div class="customer-header">
                                <div class="customer-icon">ðŸ‘¤</div>
                                <div class="customer-title">
                                    <h3>Customer 1</h3>
                                    <div class="subtitle">Primary Applicant</div>
                                </div>
                            </div>
                        `;
                        
                        moduleElement.parentNode.insertBefore(customer1Wrapper, moduleElement);
                        customer1Wrapper.appendChild(moduleElement);
                        
                        // Clone for customer 2
                        const customer2Wrapper = document.createElement('div');
                        customer2Wrapper.className = 'customer-section customer-2-section';
                        customer2Wrapper.innerHTML = `
                            <div class="customer-header">
                                <div class="customer-icon">ðŸ‘¤</div>
                                <div class="customer-title">
                                    <h3>Customer 2</h3>
                                    <div class="subtitle">Joint Applicant</div>
                                </div>
                            </div>
                        `;
                        
                        const moduleClone = moduleElement.cloneNode(true);
                        moduleClone.id = `module-${moduleId}-customer2`;
                        
                        // Update all field names to include customer2 suffix
                        updateFieldNamesForCustomer2(moduleClone);
                        
                        customer2Wrapper.appendChild(moduleClone);
                        customer1Wrapper.parentNode.insertBefore(customer2Wrapper, customer1Wrapper.nextSibling);
                        
                        // Add divider between customers (except for last per-customer module)
                        const lastPerCustomerModule = perCustomerModules[perCustomerModules.length - 1];
                        if (moduleId === lastPerCustomerModule) {
                            const divider = document.createElement('div');
                            divider.className = 'joint-divider';
                            customer2Wrapper.parentNode.insertBefore(divider, customer2Wrapper.nextSibling);
                        }
                        
                        moduleElement.classList.add('wrapped');
                    }
                }
            });
        }
        
        // Update field names for customer 2
        function updateFieldNamesForCustomer2(element) {
            // Update all input, select, and textarea names
            const fields = element.querySelectorAll('input, select, textarea');
            fields.forEach(field => {
                if (field.name) {
                    field.name = field.name + '_customer2';
                }
                if (field.id) {
                    field.id = field.id + '_customer2';
                }
                
                // Update associated labels
                if (field.id) {
                    const labels = element.querySelectorAll(`label[for="${field.id.replace('_customer2', '')}"]`);
                    labels.forEach(label => {
                        label.setAttribute('for', field.id);
                    });
                }
            });
            
            // Update radio button groups
            const radioGroups = {};
            element.querySelectorAll('input[type="radio"]').forEach(radio => {
                const baseName = radio.name;
                if (!radioGroups[baseName]) {
                    radioGroups[baseName] = [];
                }
                radioGroups[baseName].push(radio);
            });
        }

        // Display list of active modules
        function displayModuleList(modules) {
            const moduleList = document.getElementById('moduleList');
            const moduleListItems = document.getElementById('moduleListItems');
            
            if (modules.length > 0) {
                moduleList.style.display = 'block';
                moduleListItems.innerHTML = '';
                
                modules.forEach(moduleId => {
                    const moduleInfo = MODULE_DEFINITIONS[moduleId];
                    if (moduleInfo) {
                        const li = document.createElement('li');
                        li.textContent = moduleInfo.name;
                        moduleListItems.appendChild(li);
                    }
                });
            }
        }

        // Update progress indicator
        function updateProgress() {
            const activeModules = document.querySelectorAll('.form-module.active');
            const totalModules = activeModules.length;
            
            if (totalModules === 0) {
                document.getElementById('progressText').textContent = 'No modules loaded';
                return;
            }
            
            // Calculate completion based on filled required fields
            const requiredFields = form.querySelectorAll('.form-module.active [required]');
            const filledFields = Array.from(requiredFields).filter(field => {
                if (field.type === 'radio') {
                    return form.querySelector(`[name="${field.name}"]:checked`);
                } else if (field.type === 'checkbox') {
                    return field.checked;
                } else {
                    return field.value.trim() !== '';
                }
            });
            
            const progress = requiredFields.length > 0 
                ? (filledFields.length / requiredFields.length) * 100 
                : 0;
            
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = 
                `${Math.round(progress)}% Complete (${filledFields.length} of ${requiredFields.length} required fields)`;
        }

        // Auto-populate form from URL parameters
        function populateFormFromURL(params) {
            for (const [fieldName, value] of Object.entries(params)) {
                // Skip special parameters
                if (['modules', 'journey'].includes(fieldName)) continue;
                
                const field = document.querySelector(`[name="${fieldName}"]`);
                if (field && value) {
                    if (field.type === 'radio') {
                        const radioButton = document.querySelector(`[name="${fieldName}"][value="${value}"]`);
                        if (radioButton) radioButton.checked = true;
                    } else if (field.type === 'checkbox') {
                        field.checked = value === 'true' || value === '1';
                    } else {
                        field.value = value;
                    }
                }
            }
            
            // Update progress after populating
            setTimeout(updateProgress, 100);
        }

        // Monitor form changes for progress
        form.addEventListener('input', updateProgress);
        form.addEventListener('change', updateProgress);

        // Auto-uppercase postcodes
        const postcodeInputs = document.querySelectorAll('input[name*="postcode"], input[name*="Postcode"]');
        postcodeInputs.forEach(input => {
            input.addEventListener('input', function() {
                this.value = this.value.toUpperCase();
            });
        });

        // Validate phone numbers
        const phoneInputs = document.querySelectorAll('input[type="tel"]');
        phoneInputs.forEach(input => {
            input.addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9\s\+\-\(\)]/g, '');
            });
        });

        // Date validation
        const dobInput = document.querySelector('input[name="dateOfBirth"]');
        if (dobInput) {
            const today = new Date().toISOString().split('T')[0];
            dobInput.max = today;
        }

        // Auto-populate signature name
        const firstNameInput = document.querySelector('input[name="firstName"]');
        const surnameInput = document.querySelector('input[name="surname"]');
        const signatureNameInput = document.querySelector('input[name="signatureName"]');

        function updateSignatureName() {
            if (firstNameInput && surnameInput && signatureNameInput) {
                if (firstNameInput.value && surnameInput.value && !signatureNameInput.value) {
                    signatureNameInput.value = `${firstNameInput.value} ${surnameInput.value}`;
                }
            }
        }

        if (firstNameInput && surnameInput) {
            firstNameInput.addEventListener('blur', updateSignatureName);
            surnameInput.addEventListener('blur', updateSignatureName);
        }

        // Set today's date for signature
        const signatureDateInput = document.querySelector('input[name="signatureDate"]');
        if (signatureDateInput) {
            const today = new Date().toISOString().split('T')[0];
            signatureDateInput.value = today;
        }

        // Form submission
        form.addEventListener('submit', function(e) {
            e.preventDefault();

            // Only validate fields in active modules
            const activeRequiredFields = form.querySelectorAll('.form-module.active [required]');
            let isValid = true;
            let firstInvalid = null;

            activeRequiredFields.forEach(field => {
                if (field.type === 'radio') {
                    const radioGroup = form.querySelector(`[name="${field.name}"]:checked`);
                    if (!radioGroup) {
                        isValid = false;
                        if (!firstInvalid) firstInvalid = field;
                    }
                } else if (!field.value.trim()) {
                    isValid = false;
                    if (!firstInvalid) firstInvalid = field;
                }
            });

            if (!isValid) {
                if (firstInvalid) {
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstInvalid.focus();
                }
                alert('Please fill in all required fields in the active modules before submitting.');
                return;
            }

            // Collect form data
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }

            // Add module information
            const activeModules = Array.from(document.querySelectorAll('.form-module.active'))
                .map(el => el.dataset.module);
            data.completedModules = activeModules.join(',');
            data.journeyType = document.getElementById('journeyType').textContent;

            console.log('Form submitted with data:', data);

            // Submit to n8n webhook if configured
            if (N8N_WEBHOOK_URL && N8N_WEBHOOK_URL !== 'YOUR_N8N_WEBHOOK_URL_HERE') {
                fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(result => {
                    console.log('Success:', result);
                    alert('Form submitted successfully!\n\nYour data has been processed.');
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('There was an error submitting the form. Please try again.');
                });
            } else {
                alert('Form submitted successfully!\n\nData collected from modules: ' + activeModules.join(', '));
            }
        });

        // Add dynamic row functionality for tax table (only if tax module is active)
        const addRowButton = document.createElement('button');
        addRowButton.type = 'button';
        addRowButton.textContent = '+ Add Another Country';
        addRowButton.style.cssText = 'margin-top: 10px; padding: 10px 20px; background: #6b4c9a; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;';
        
        const taxModule = document.getElementById('module-tax-residency');
        if (taxModule) {
            const taxTable = taxModule.querySelector('#taxTable');
            let rowCount = 3;

            addRowButton.addEventListener('click', function() {
                rowCount++;
                const tbody = taxTable.querySelector('tbody');
                const newRow = document.createElement('tr');
                newRow.className = 'tax-row';
                newRow.innerHTML = `
                    <td><input type="text" name="country${rowCount}" placeholder="Country name"></td>
                    <td style="text-align: center;"><input type="checkbox" name="taxResident${rowCount}"></td>
                    <td style="text-align: center;"><input type="checkbox" name="citizen${rowCount}"></td>
                    <td><input type="text" name="tin${rowCount}" placeholder="TIN"></td>
                    <td><input type="text" name="tinType${rowCount}" placeholder="e.g., NIN, SSN"></td>
                `;
                tbody.appendChild(newRow);
            });

            taxTable.parentNode.appendChild(addRowButton);
        }

        // Initialize modules on page load
        window.addEventListener('DOMContentLoaded', initializeModules);
    </script>
</body>
</html>
