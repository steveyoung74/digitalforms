<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Information | Evelyn Partners Fact Find</title>
    <style>
        :root {
            /* Primary Brand Colours - Evelyn Partners Rebrand */
            --primary: #2D2047;
            --primary-dark: #1E1530;
            --primary-light: #6B3FA0;
            
            /* Secondary Accent Colours */
            --accent-teal: #34675C;
            --accent-coral: #E07065;
            --accent-blue: #5299E0;
            --accent-gold: #C4A35A;
            
            /* Semantic Colours */
            --success: #28a745;
            --success-light: #d4edda;
            --warning: #ffc107;
            --danger: #dc3545;
            
            /* Neutral Grays */
            --gray-50: #f8f9fa;
            --gray-100: #f0f1f3;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            
            /* UI Properties */
            --border-radius: 8px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
            --transition: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--gray-100);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-md);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .logo {
            font-size: 20px;
            font-weight: 600;
            letter-spacing: -0.5px;
        }

        .application-type {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .type-badge {
            background: rgba(255,255,255,0.2);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }

        .header-main {
            padding: 20px 24px;
        }

        .journey-title {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 4px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .section-description {
            font-size: 14px;
            opacity: 0.85;
        }

        /* Progress Bar */
        .progress-container {
            background: rgba(0,0,0,0.2);
            padding: 16px 24px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 8px;
            opacity: 0.9;
        }

        .progress-bar {
            height: 6px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: white;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 10px;
            opacity: 0.7;
            cursor: pointer;
            transition: var(--transition);
        }

        .progress-step:hover {
            opacity: 1;
        }

        .progress-step.active {
            opacity: 1;
        }

        .progress-step.completed {
            opacity: 1;
        }

        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            margin-bottom: 4px;
            transition: var(--transition);
        }

        .progress-step.active .step-dot {
            background: white;
            box-shadow: 0 0 0 3px rgba(255,255,255,0.3);
        }

        .progress-step.completed .step-dot {
            background: var(--success);
        }

        /* Main Content */
        .main-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Save Status Bar */
        .save-status-bar {
            background: white;
            border-radius: var(--border-radius);
            padding: 12px 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-sm);
        }

        .save-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--gray-600);
        }

        .save-status-icon {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--gray-400);
        }

        .save-status-icon.saved {
            background: var(--success);
        }

        .save-status-icon.saving {
            background: var(--warning);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .save-actions {
            display: flex;
            gap: 12px;
        }

        .btn-save {
            background: var(--gray-100);
            color: var(--gray-700);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-save:hover {
            background: var(--gray-200);
        }

        /* Section Cards */
        .section-card {
            background: white;
            border-radius: var(--border-radius);
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            border: 1px solid var(--gray-200);
        }

        .section-header {
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid transparent;
        }

        .section-card.expanded .section-header {
            border-bottom-color: var(--gray-200);
        }

        .section-header:hover {
            background: var(--gray-50);
        }

        .section-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .section-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            color: var(--gray-600);
        }

        .section-card.completed .section-number {
            background: var(--success-light);
            color: var(--success);
        }

        .section-card.active .section-number {
            background: var(--primary);
            color: white;
        }

        .section-info h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 2px;
        }

        .section-info p {
            font-size: 13px;
            color: var(--gray-500);
        }

        .section-status {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .status-badge {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 500;
        }

        .status-badge.pending {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .status-badge.in-progress {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.completed {
            background: var(--success-light);
            color: var(--success);
        }

        .toggle-icon {
            font-size: 20px;
            color: var(--gray-400);
            transition: transform 0.2s ease;
        }

        .section-card.expanded .toggle-icon {
            transform: rotate(180deg);
        }

        .section-content {
            display: none;
            padding: 24px;
            background: var(--gray-50);
        }

        .section-card.expanded .section-content {
            display: block;
        }

        /* Joint Applicant Toggle */
        .applicant-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            padding: 4px;
            background: var(--gray-100);
            border-radius: 8px;
            width: fit-content;
        }

        .applicant-btn {
            padding: 10px 20px;
            border: none;
            background: transparent;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            transition: var(--transition);
        }

        .applicant-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .applicant-form {
            display: none;
        }

        .applicant-form.active {
            display: block;
        }

        /* Form Elements */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 6px;
        }

        .form-label .required {
            color: var(--danger);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 15px;
            color: var(--gray-800);
            background: white;
            transition: var(--transition);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(45, 32, 71, 0.15);
        }

        .form-input.error,
        .form-select.error {
            border-color: var(--danger);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .error-message {
            font-size: 12px;
            color: var(--danger);
            margin-top: 4px;
            display: none;
        }

        .form-group.has-error .error-message {
            display: block;
        }

        .form-hint {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 4px;
        }

        /* Radio & Checkbox Groups */
        .option-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .option-item {
            position: relative;
        }

        .option-item input {
            position: absolute;
            opacity: 0;
        }

        .option-item label {
            display: block;
            padding: 12px 20px;
            background: white;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
        }

        .option-item input:checked + label {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .option-item label:hover {
            border-color: var(--primary);
        }

        /* Conditional Sections */
        .conditional-section {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 6px;
            border: 1px dashed var(--gray-300);
        }

        .conditional-section.visible {
            display: block;
        }

        /* Section Actions */
        .section-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-200);
        }

        .btn {
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .btn-secondary {
            background: white;
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }

        .btn-secondary:hover {
            background: var(--gray-50);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        /* Navigation */
        .page-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 32px;
            padding: 24px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 14px 28px;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            text-decoration: none;
        }

        .nav-btn-prev {
            background: var(--gray-100);
            color: var(--gray-700);
        }

        .nav-btn-prev:hover {
            background: var(--gray-200);
        }

        .nav-btn-next {
            background: var(--primary);
            color: white;
        }

        .nav-btn-next:hover {
            background: var(--primary-dark);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Address Lookup */
        .address-lookup {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .address-lookup .form-input {
            flex: 1;
        }

        .btn-lookup {
            padding: 12px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
        }

        /* Info Box */
        .info-box {
            background: #e7f3ff;
            border: 1px solid #b3d7ff;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .info-box p {
            font-size: 14px;
            color: #004085;
        }

        /* Responsive */
        /* Mobile Optimizations */
        @media (max-width: 768px) {
            /* Auto-hide header on scroll */
            .header {
                transition: transform 0.3s ease;
            }
            
            .header.header-hidden {
                transform: translateY(-100%);
            }
            
            /* Compact header on mobile */
            .header-top {
                flex-direction: row;
                padding: 10px 16px;
                gap: 8px;
            }
            
            .logo {
                font-size: 16px;
            }
            
            .type-badge {
                padding: 4px 10px;
                font-size: 11px;
            }
            
            /* Compact section info */
            .header-main {
                padding: 12px 16px;
            }
            
            .journey-title {
                font-size: 12px;
                margin-bottom: 2px;
            }
            
            .section-title {
                font-size: 18px;
                margin-bottom: 4px;
            }
            
            .section-description {
                font-size: 12px;
                display: none; /* Hide description on mobile */
            }
            
            /* Compact progress bar - thin bar only, hide step labels */
            .progress-container {
                padding: 10px 16px;
            }
            
            .progress-label {
                font-size: 11px;
                margin-bottom: 6px;
            }
            
            .progress-bar {
                height: 4px;
            }
            
            .progress-steps {
                margin-top: 8px;
            }
            
            .progress-step {
                font-size: 0; /* Hide labels */
            }
            
            .step-dot {
                width: 8px;
                height: 8px;
                margin-bottom: 0;
            }
            
            .progress-step.active .step-dot {
                box-shadow: 0 0 0 2px rgba(255,255,255,0.3);
            }

            /* Main content adjustments */
            .main-content {
                padding: 12px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .page-navigation {
                flex-direction: column;
                gap: 12px;
            }

            .nav-btn {
                width: 100%;
                justify-content: center;
            }
            
            /* Smaller section cards on mobile */
            .section-card {
                margin-bottom: 12px;
            }
            
            .section-header-bar {
                padding: 14px 16px;
            }
            
            .section-content {
                padding: 16px;
            }
            
            .form-group {
                margin-bottom: 14px;
            }
            
            .form-input, .form-select {
                padding: 10px 12px;
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }
    </style>
    
    <script>
        // Mobile header auto-hide on scroll
        (function() {
            let lastScrollTop = 0;
            let header = null;
            const scrollThreshold = 10;
            
            function initMobileHeader() {
                header = document.querySelector('.header');
                if (!header) return;
                
                // Only apply on mobile
                if (window.innerWidth > 768) return;
                
                window.addEventListener('scroll', handleScroll, { passive: true });
                window.addEventListener('resize', handleResize);
            }
            
            function handleScroll() {
                if (window.innerWidth > 768) {
                    header.classList.remove('header-hidden');
                    return;
                }
                
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                // Scrolling down - hide header
                if (scrollTop > lastScrollTop && scrollTop > 100) {
                    header.classList.add('header-hidden');
                } 
                // Scrolling up - show header
                else if (scrollTop < lastScrollTop - scrollThreshold) {
                    header.classList.remove('header-hidden');
                }
                
                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
            }
            
            function handleResize() {
                if (window.innerWidth > 768) {
                    header.classList.remove('header-hidden');
                }
            }
            
            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initMobileHeader);
            } else {
                initMobileHeader();
            }
        })();
    </script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="logo">Evelyn Partners</div>
            <div class="application-type">
                <span class="type-badge" id="applicationTypeBadge">Individual</span>
            </div>
        </div>
        <div class="header-main">
            <div class="journey-title">Fact Find A ‚Ä¢ Section 1 of 6</div>
            <h1 class="section-title">Personal Information</h1>
            <p class="section-description">Provide your personal details for identification and compliance purposes</p>
        </div>
        <div class="progress-container">
            <div class="progress-label">
                <span>Section Progress</span>
                <span id="progressPercent">0% Complete</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps">
                <div class="progress-step active" data-section="1">
                    <div class="step-dot"></div>
                    <span>Title</span>
                </div>
                <div class="progress-step" data-section="2">
                    <div class="step-dot"></div>
                    <span>Name</span>
                </div>
                <div class="progress-step" data-section="3">
                    <div class="step-dot"></div>
                    <span>Address</span>
                </div>
                <div class="progress-step" data-section="4">
                    <div class="step-dot"></div>
                    <span>DOB</span>
                </div>
                <div class="progress-step" data-section="5">
                    <div class="step-dot"></div>
                    <span>NI/Tax</span>
                </div>
                <div class="progress-step" data-section="6">
                    <div class="step-dot"></div>
                    <span>Citizenship</span>
                </div>
                <div class="progress-step" data-section="7">
                    <div class="step-dot"></div>
                    <span>Tax</span>
                </div>
                <div class="progress-step" data-section="8">
                    <div class="step-dot"></div>
                    <span>Contact</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Save Status Bar -->
        <div class="save-status-bar">
            <div class="save-status">
                <div class="save-status-icon" id="saveStatusIcon"></div>
                <span id="saveStatusText">All changes saved</span>
            </div>
            <div class="save-actions">
                <button class="btn-save" onclick="saveProgress()">üíæ Save Progress</button>
                <button class="btn-save" onclick="clearForm()">üóëÔ∏è Clear Form</button>
            </div>
        </div>

        <!-- Section 1: Title -->
        <div class="section-card expanded" data-section="1" id="section1">
            <div class="section-header" onclick="toggleSection(1)">
                <div class="section-header-left">
                    <div class="section-number">1</div>
                    <div class="section-info">
                        <h3>Title</h3>
                        <p>Select your preferred title</p>
                    </div>
                </div>
                <div class="section-status">
                    <span class="status-badge pending" id="status1">Not started</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
            </div>
            <div class="section-content">
                <!-- Applicant Toggle (for joint applications) -->
                <div class="applicant-toggle" id="applicantToggle1" style="display: none;">
                    <button class="applicant-btn active" data-applicant="1" onclick="switchApplicant(1, 1)">Primary Applicant</button>
                    <button class="applicant-btn" data-applicant="2" onclick="switchApplicant(1, 2)">Joint Applicant</button>
                </div>

                <!-- Primary Applicant Form -->
                <div class="applicant-form active" id="applicant1Form1">
                    <div class="form-group">
                        <label class="form-label">Title <span class="required">*</span></label>
                        <div class="option-group">
                            <div class="option-item">
                                <input type="radio" name="title" id="titleMr" value="Mr" onchange="handleFieldChange('title', this.value)">
                                <label for="titleMr">Mr</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="title" id="titleMrs" value="Mrs" onchange="handleFieldChange('title', this.value)">
                                <label for="titleMrs">Mrs</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="title" id="titleMiss" value="Miss" onchange="handleFieldChange('title', this.value)">
                                <label for="titleMiss">Miss</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="title" id="titleMs" value="Ms" onchange="handleFieldChange('title', this.value)">
                                <label for="titleMs">Ms</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="title" id="titleDr" value="Dr" onchange="handleFieldChange('title', this.value)">
                                <label for="titleDr">Dr</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="title" id="titleOther" value="Other" onchange="handleFieldChange('title', this.value); toggleOtherTitle(true)">
                                <label for="titleOther">Other</label>
                            </div>
                        </div>
                        <span class="error-message" id="titleError">Please select a title</span>
                    </div>

                    <div class="conditional-section" id="otherTitleSection">
                        <div class="form-group">
                            <label class="form-label">Please specify <span class="required">*</span></label>
                            <input type="text" class="form-input" id="titleOtherSpecify" placeholder="Enter title" onchange="handleFieldChange('titleOther', this.value)">
                        </div>
                    </div>
                </div>

                <!-- Joint Applicant Form -->
                <div class="applicant-form" id="applicant2Form1">
                    <div class="form-group">
                        <label class="form-label">Title <span class="required">*</span></label>
                        <div class="option-group">
                            <div class="option-item">
                                <input type="radio" name="title_customer2" id="titleMr2" value="Mr" onchange="handleFieldChange('title_customer2', this.value)">
                                <label for="titleMr2">Mr</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="title_customer2" id="titleMrs2" value="Mrs" onchange="handleFieldChange('title_customer2', this.value)">
                                <label for="titleMrs2">Mrs</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="title_customer2" id="titleMiss2" value="Miss" onchange="handleFieldChange('title_customer2', this.value)">
                                <label for="titleMiss2">Miss</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="title_customer2" id="titleMs2" value="Ms" onchange="handleFieldChange('title_customer2', this.value)">
                                <label for="titleMs2">Ms</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="title_customer2" id="titleDr2" value="Dr" onchange="handleFieldChange('title_customer2', this.value)">
                                <label for="titleDr2">Dr</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="title_customer2" id="titleOther2" value="Other" onchange="handleFieldChange('title_customer2', this.value); toggleOtherTitle2(true)">
                                <label for="titleOther2">Other</label>
                            </div>
                        </div>
                    </div>

                    <div class="conditional-section" id="otherTitleSection2">
                        <div class="form-group">
                            <label class="form-label">Please specify <span class="required">*</span></label>
                            <input type="text" class="form-input" id="titleOtherSpecify2" placeholder="Enter title" onchange="handleFieldChange('titleOther_customer2', this.value)">
                        </div>
                    </div>
                </div>

                <div class="section-actions">
                    <button class="btn btn-primary" onclick="completeSection(1)">Continue ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Section 2: Full Name -->
        <div class="section-card" data-section="2" id="section2">
            <div class="section-header" onclick="toggleSection(2)">
                <div class="section-header-left">
                    <div class="section-number">2</div>
                    <div class="section-info">
                        <h3>Full Name</h3>
                        <p>Enter your full legal name as it appears on official documents</p>
                    </div>
                </div>
                <div class="section-status">
                    <span class="status-badge pending" id="status2">Not started</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
            </div>
            <div class="section-content">
                <div class="applicant-toggle" id="applicantToggle2" style="display: none;">
                    <button class="applicant-btn active" data-applicant="1" onclick="switchApplicant(2, 1)">Primary Applicant</button>
                    <button class="applicant-btn" data-applicant="2" onclick="switchApplicant(2, 2)">Joint Applicant</button>
                </div>

                <!-- Primary Applicant -->
                <div class="applicant-form active" id="applicant1Form2">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">First Name <span class="required">*</span></label>
                            <input type="text" class="form-input" id="firstName" placeholder="Enter first name" onchange="handleFieldChange('firstName', this.value)">
                            <span class="error-message">Please enter your first name</span>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Middle Name(s)</label>
                            <input type="text" class="form-input" id="middleName" placeholder="Enter middle name(s)" onchange="handleFieldChange('middleName', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Surname <span class="required">*</span></label>
                            <input type="text" class="form-input" id="surname" placeholder="Enter surname" onchange="handleFieldChange('surname', this.value)">
                            <span class="error-message">Please enter your surname</span>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Maiden/Previous Name</label>
                            <input type="text" class="form-input" id="maidenName" placeholder="If applicable" onchange="handleFieldChange('maidenName', this.value)">
                        </div>
                    </div>
                </div>

                <!-- Joint Applicant -->
                <div class="applicant-form" id="applicant2Form2">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">First Name <span class="required">*</span></label>
                            <input type="text" class="form-input" id="firstName_customer2" placeholder="Enter first name" onchange="handleFieldChange('firstName_customer2', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Middle Name(s)</label>
                            <input type="text" class="form-input" id="middleName_customer2" placeholder="Enter middle name(s)" onchange="handleFieldChange('middleName_customer2', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Surname <span class="required">*</span></label>
                            <input type="text" class="form-input" id="surname_customer2" placeholder="Enter surname" onchange="handleFieldChange('surname_customer2', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Maiden/Previous Name</label>
                            <input type="text" class="form-input" id="maidenName_customer2" placeholder="If applicable" onchange="handleFieldChange('maidenName_customer2', this.value)">
                        </div>
                    </div>
                </div>

                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="goToSection(1)">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="completeSection(2)">Continue ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Section 3: Address -->
        <div class="section-card" data-section="3" id="section3">
            <div class="section-header" onclick="toggleSection(3)">
                <div class="section-header-left">
                    <div class="section-number">3</div>
                    <div class="section-info">
                        <h3>Address</h3>
                        <p>Your current residential address</p>
                    </div>
                </div>
                <div class="section-status">
                    <span class="status-badge pending" id="status3">Not started</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
            </div>
            <div class="section-content">
                <div class="applicant-toggle" id="applicantToggle3" style="display: none;">
                    <button class="applicant-btn active" data-applicant="1" onclick="switchApplicant(3, 1)">Primary Applicant</button>
                    <button class="applicant-btn" data-applicant="2" onclick="switchApplicant(3, 2)">Joint Applicant</button>
                </div>

                <!-- Primary Applicant Address -->
                <div class="applicant-form active" id="applicant1Form3">
                    <div class="address-lookup">
                        <input type="text" class="form-input" id="postcodeSearch" placeholder="Enter postcode to search">
                        <button class="btn-lookup" onclick="lookupAddress()">Find Address</button>
                    </div>

                    <div class="form-row">
                        <div class="form-group full-width">
                            <label class="form-label">Address Line 1 <span class="required">*</span></label>
                            <input type="text" class="form-input" id="addressLine1" placeholder="Street address" onchange="handleFieldChange('addressLine1', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label class="form-label">Address Line 2</label>
                            <input type="text" class="form-input" id="addressLine2" placeholder="Apartment, suite, etc." onchange="handleFieldChange('addressLine2', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">City/Town <span class="required">*</span></label>
                            <input type="text" class="form-input" id="city" placeholder="City or town" onchange="handleFieldChange('city', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">County</label>
                            <input type="text" class="form-input" id="county" placeholder="County" onchange="handleFieldChange('county', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Postcode <span class="required">*</span></label>
                            <input type="text" class="form-input" id="postcode" placeholder="Postcode" onchange="handleFieldChange('postcode', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Country <span class="required">*</span></label>
                            <select class="form-select" id="country" onchange="handleFieldChange('country', this.value)">
                                <option value="">Select country</option>
                                <option value="United Kingdom" selected>United Kingdom</option>
                                <option value="Ireland">Ireland</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Time at Current Address <span class="required">*</span></label>
                        <div class="form-row">
                            <div class="form-group">
                                <input type="number" class="form-input" id="yearsAtAddress" placeholder="Years" min="0" max="99" onchange="handleFieldChange('yearsAtAddress', this.value); checkPreviousAddress()">
                            </div>
                            <div class="form-group">
                                <input type="number" class="form-input" id="monthsAtAddress" placeholder="Months" min="0" max="11" onchange="handleFieldChange('monthsAtAddress', this.value); checkPreviousAddress()">
                            </div>
                        </div>
                    </div>

                    <div class="conditional-section" id="previousAddressSection">
                        <div class="info-box">
                            <p>‚ÑπÔ∏è As you've lived at your current address for less than 3 years, please provide your previous address.</p>
                        </div>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label class="form-label">Previous Address Line 1 <span class="required">*</span></label>
                                <input type="text" class="form-input" id="prevAddressLine1" placeholder="Street address" onchange="handleFieldChange('prevAddressLine1', this.value)">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label class="form-label">Previous Address Line 2</label>
                                <input type="text" class="form-input" id="prevAddressLine2" placeholder="Apartment, suite, etc." onchange="handleFieldChange('prevAddressLine2', this.value)">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">City/Town <span class="required">*</span></label>
                                <input type="text" class="form-input" id="prevCity" placeholder="City or town" onchange="handleFieldChange('prevCity', this.value)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Postcode <span class="required">*</span></label>
                                <input type="text" class="form-input" id="prevPostcode" placeholder="Postcode" onchange="handleFieldChange('prevPostcode', this.value)">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Joint Applicant Address -->
                <div class="applicant-form" id="applicant2Form3">
                    <div class="info-box">
                        <p>‚ÑπÔ∏è Does the joint applicant live at the same address?</p>
                    </div>
                    <div class="form-group" style="margin-bottom: 20px;">
                        <div class="option-group">
                            <div class="option-item">
                                <input type="radio" name="sameAddress" id="sameAddressYes" value="yes" onchange="handleSameAddress(true)">
                                <label for="sameAddressYes">Yes, same address</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="sameAddress" id="sameAddressNo" value="no" onchange="handleSameAddress(false)">
                                <label for="sameAddressNo">No, different address</label>
                            </div>
                        </div>
                    </div>

                    <div id="jointAddressFields" style="display: none;">
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label class="form-label">Address Line 1 <span class="required">*</span></label>
                                <input type="text" class="form-input" id="addressLine1_customer2" placeholder="Street address" onchange="handleFieldChange('addressLine1_customer2', this.value)">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label class="form-label">Address Line 2</label>
                                <input type="text" class="form-input" id="addressLine2_customer2" placeholder="Apartment, suite, etc." onchange="handleFieldChange('addressLine2_customer2', this.value)">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">City/Town <span class="required">*</span></label>
                                <input type="text" class="form-input" id="city_customer2" placeholder="City or town" onchange="handleFieldChange('city_customer2', this.value)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Postcode <span class="required">*</span></label>
                                <input type="text" class="form-input" id="postcode_customer2" placeholder="Postcode" onchange="handleFieldChange('postcode_customer2', this.value)">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="goToSection(2)">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="completeSection(3)">Continue ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Section 4: Date of Birth -->
        <div class="section-card" data-section="4" id="section4">
            <div class="section-header" onclick="toggleSection(4)">
                <div class="section-header-left">
                    <div class="section-number">4</div>
                    <div class="section-info">
                        <h3>Date of Birth</h3>
                        <p>Your date of birth and gender</p>
                    </div>
                </div>
                <div class="section-status">
                    <span class="status-badge pending" id="status4">Not started</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
            </div>
            <div class="section-content">
                <div class="applicant-toggle" id="applicantToggle4" style="display: none;">
                    <button class="applicant-btn active" data-applicant="1" onclick="switchApplicant(4, 1)">Primary Applicant</button>
                    <button class="applicant-btn" data-applicant="2" onclick="switchApplicant(4, 2)">Joint Applicant</button>
                </div>

                <!-- Primary Applicant -->
                <div class="applicant-form active" id="applicant1Form4">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Date of Birth <span class="required">*</span></label>
                            <input type="date" class="form-input" id="dateOfBirth" onchange="handleFieldChange('dateOfBirth', this.value); validateAge('dateOfBirth')">
                            <span class="form-hint" id="ageDisplay"></span>
                            <span class="error-message" id="dobAgeError" style="display: none; color: #dc3545;">You must be at least 18 years old to apply</span>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Gender <span class="required">*</span></label>
                            <select class="form-select" id="gender" onchange="handleFieldChange('gender', this.value)">
                                <option value="">Select gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Prefer not to say</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Marital Status <span class="required">*</span></label>
                            <select class="form-select" id="maritalStatus" onchange="handleFieldChange('maritalStatus', this.value)">
                                <option value="">Select status</option>
                                <option value="Single">Single</option>
                                <option value="Married">Married</option>
                                <option value="Civil Partnership">Civil Partnership</option>
                                <option value="Divorced">Divorced</option>
                                <option value="Widowed">Widowed</option>
                                <option value="Living with Partner">Living with Partner</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Country of Birth <span class="required">*</span></label>
                            <input type="text" class="form-input" id="countryOfBirth" placeholder="Enter country" onchange="handleFieldChange('countryOfBirth', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Town of Birth</label>
                            <input type="text" class="form-input" id="townOfBirth" placeholder="Enter town" onchange="handleFieldChange('townOfBirth', this.value)">
                        </div>
                    </div>
                </div>

                <!-- Joint Applicant -->
                <div class="applicant-form" id="applicant2Form4">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Date of Birth <span class="required">*</span></label>
                            <input type="date" class="form-input" id="dateOfBirth_customer2" onchange="handleFieldChange('dateOfBirth_customer2', this.value); validateAge('dateOfBirth_customer2')">
                            <span class="error-message" id="dobAgeError_customer2" style="display: none; color: #dc3545;">Joint applicant must be at least 18 years old</span>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Gender <span class="required">*</span></label>
                            <select class="form-select" id="gender_customer2" onchange="handleFieldChange('gender_customer2', this.value)">
                                <option value="">Select gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Prefer not to say</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Marital Status <span class="required">*</span></label>
                            <select class="form-select" id="maritalStatus_customer2" onchange="handleFieldChange('maritalStatus_customer2', this.value)">
                                <option value="">Select status</option>
                                <option value="Single">Single</option>
                                <option value="Married">Married</option>
                                <option value="Civil Partnership">Civil Partnership</option>
                                <option value="Divorced">Divorced</option>
                                <option value="Widowed">Widowed</option>
                                <option value="Living with Partner">Living with Partner</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Country of Birth <span class="required">*</span></label>
                            <input type="text" class="form-input" id="countryOfBirth_customer2" placeholder="Enter country" onchange="handleFieldChange('countryOfBirth_customer2', this.value)">
                        </div>
                    </div>
                </div>

                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="goToSection(3)">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="completeSection(4)">Continue ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Section 5: NI & Tax Reference -->
        <div class="section-card" data-section="5" id="section5">
            <div class="section-header" onclick="toggleSection(5)">
                <div class="section-header-left">
                    <div class="section-number">5</div>
                    <div class="section-info">
                        <h3>National Insurance & Tax Reference</h3>
                        <p>Your NI number and tax identifiers</p>
                    </div>
                </div>
                <div class="section-status">
                    <span class="status-badge pending" id="status5">Not started</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
            </div>
            <div class="section-content">
                <div class="applicant-toggle" id="applicantToggle5" style="display: none;">
                    <button class="applicant-btn active" data-applicant="1" onclick="switchApplicant(5, 1)">Primary Applicant</button>
                    <button class="applicant-btn" data-applicant="2" onclick="switchApplicant(5, 2)">Joint Applicant</button>
                </div>

                <!-- Primary Applicant -->
                <div class="applicant-form active" id="applicant1Form5">
                    <div class="info-box">
                        <p>‚ÑπÔ∏è Your National Insurance number helps us verify your identity and report tax information to HMRC.</p>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">National Insurance Number <span class="required">*</span></label>
                            <input type="text" class="form-input" id="niNumber" placeholder="e.g. QQ 12 34 56 C" maxlength="13" onchange="handleFieldChange('niNumber', this.value)" oninput="formatNI(this)">
                            <span class="form-hint">Format: XX XX XX XX X</span>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Unique Tax Reference (UTR)</label>
                            <input type="text" class="form-input" id="utr" placeholder="10 digit number" maxlength="10" onchange="handleFieldChange('utr', this.value)">
                            <span class="form-hint">Only required if self-employed or own a business</span>
                        </div>
                    </div>
                </div>

                <!-- Joint Applicant -->
                <div class="applicant-form" id="applicant2Form5">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">National Insurance Number <span class="required">*</span></label>
                            <input type="text" class="form-input" id="niNumber_customer2" placeholder="e.g. QQ 12 34 56 C" maxlength="13" onchange="handleFieldChange('niNumber_customer2', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Unique Tax Reference (UTR)</label>
                            <input type="text" class="form-input" id="utr_customer2" placeholder="10 digit number" maxlength="10" onchange="handleFieldChange('utr_customer2', this.value)">
                        </div>
                    </div>
                </div>

                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="goToSection(4)">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="completeSection(5)">Continue ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Section 6: Citizenship -->
        <div class="section-card" data-section="6" id="section6">
            <div class="section-header" onclick="toggleSection(6)">
                <div class="section-header-left">
                    <div class="section-number">6</div>
                    <div class="section-info">
                        <h3>Citizenship</h3>
                        <p>Your nationality and citizenship status</p>
                    </div>
                </div>
                <div class="section-status">
                    <span class="status-badge pending" id="status6">Not started</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
            </div>
            <div class="section-content">
                <div class="applicant-toggle" id="applicantToggle6" style="display: none;">
                    <button class="applicant-btn active" data-applicant="1" onclick="switchApplicant(6, 1)">Primary Applicant</button>
                    <button class="applicant-btn" data-applicant="2" onclick="switchApplicant(6, 2)">Joint Applicant</button>
                </div>

                <!-- Primary Applicant -->
                <div class="applicant-form active" id="applicant1Form6">
                    <div class="form-group">
                        <label class="form-label">Primary Nationality <span class="required">*</span></label>
                        <select class="form-select" id="nationality" onchange="handleFieldChange('nationality', this.value)">
                            <option value="">Select nationality</option>
                            <option value="British">British</option>
                            <option value="Irish">Irish</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Do you hold any other nationalities?</label>
                        <div class="option-group">
                            <div class="option-item">
                                <input type="radio" name="otherNationality" id="otherNatNo" value="no" onchange="toggleOtherNationality(false)">
                                <label for="otherNatNo">No</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="otherNationality" id="otherNatYes" value="yes" onchange="toggleOtherNationality(true)">
                                <label for="otherNatYes">Yes</label>
                            </div>
                        </div>
                    </div>

                    <div class="conditional-section" id="otherNationalitySection">
                        <div class="form-group">
                            <label class="form-label">Additional Nationality</label>
                            <input type="text" class="form-input" id="additionalNationality" placeholder="Enter nationality" onchange="handleFieldChange('additionalNationality', this.value)">
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label class="form-label">US Person Declaration <span class="required">*</span></label>
                        <div class="info-box">
                            <p>‚ÑπÔ∏è For FATCA compliance, we need to confirm you are not a US person (US citizen, green card holder, or tax resident).</p>
                        </div>
                        <div class="option-group">
                            <div class="option-item">
                                <input type="radio" name="usPerson" id="usPersonNo" value="no" onchange="handleFieldChange('usPerson', 'no')">
                                <label for="usPersonNo">I confirm I am NOT a US person</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="usPerson" id="usPersonYes" value="yes" onchange="handleFieldChange('usPerson', 'yes'); showUSPersonWarning()">
                                <label for="usPersonYes">I am a US person</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Joint Applicant -->
                <div class="applicant-form" id="applicant2Form6">
                    <div class="form-group">
                        <label class="form-label">Primary Nationality <span class="required">*</span></label>
                        <select class="form-select" id="nationality_customer2" onchange="handleFieldChange('nationality_customer2', this.value)">
                            <option value="">Select nationality</option>
                            <option value="British">British</option>
                            <option value="Irish">Irish</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-top: 20px;">
                        <label class="form-label">US Person Declaration <span class="required">*</span></label>
                        <div class="option-group">
                            <div class="option-item">
                                <input type="radio" name="usPerson_customer2" id="usPersonNo2" value="no" onchange="handleFieldChange('usPerson_customer2', 'no')">
                                <label for="usPersonNo2">I confirm I am NOT a US person</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="usPerson_customer2" id="usPersonYes2" value="yes" onchange="handleFieldChange('usPerson_customer2', 'yes')">
                                <label for="usPersonYes2">I am a US person</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="goToSection(5)">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="completeSection(6)">Continue ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Section 7: Tax Residency -->
        <div class="section-card" data-section="7" id="section7">
            <div class="section-header" onclick="toggleSection(7)">
                <div class="section-header-left">
                    <div class="section-number">7</div>
                    <div class="section-info">
                        <h3>Tax Residency</h3>
                        <p>Your tax residency status for CRS reporting</p>
                    </div>
                </div>
                <div class="section-status">
                    <span class="status-badge pending" id="status7">Not started</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
            </div>
            <div class="section-content">
                <div class="applicant-toggle" id="applicantToggle7" style="display: none;">
                    <button class="applicant-btn active" data-applicant="1" onclick="switchApplicant(7, 1)">Primary Applicant</button>
                    <button class="applicant-btn" data-applicant="2" onclick="switchApplicant(7, 2)">Joint Applicant</button>
                </div>

                <!-- Primary Applicant -->
                <div class="applicant-form active" id="applicant1Form7">
                    <div class="form-group">
                        <label class="form-label">Are you solely UK tax resident? <span class="required">*</span></label>
                        <div class="option-group">
                            <div class="option-item">
                                <input type="radio" name="ukTaxResident" id="ukTaxYes" value="yes" onchange="handleFieldChange('ukTaxResident', 'yes'); toggleOtherTaxCountry(false)">
                                <label for="ukTaxYes">Yes, UK only</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="ukTaxResident" id="ukTaxNo" value="no" onchange="handleFieldChange('ukTaxResident', 'no'); toggleOtherTaxCountry(true)">
                                <label for="ukTaxNo">No, other countries</label>
                            </div>
                        </div>
                    </div>

                    <div class="conditional-section" id="otherTaxCountrySection">
                        <div class="info-box">
                            <p>‚ÑπÔ∏è Please provide details of all countries where you are tax resident.</p>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Country <span class="required">*</span></label>
                                <input type="text" class="form-input" id="taxCountry1" placeholder="Country name" onchange="handleFieldChange('taxCountry1', this.value)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tax Identification Number (TIN)</label>
                                <input type="text" class="form-input" id="tin1" placeholder="TIN" onchange="handleFieldChange('tin1', this.value)">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Joint Applicant -->
                <div class="applicant-form" id="applicant2Form7">
                    <div class="form-group">
                        <label class="form-label">Are you solely UK tax resident? <span class="required">*</span></label>
                        <div class="option-group">
                            <div class="option-item">
                                <input type="radio" name="ukTaxResident_customer2" id="ukTaxYes2" value="yes" onchange="handleFieldChange('ukTaxResident_customer2', 'yes')">
                                <label for="ukTaxYes2">Yes, UK only</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="ukTaxResident_customer2" id="ukTaxNo2" value="no" onchange="handleFieldChange('ukTaxResident_customer2', 'no')">
                                <label for="ukTaxNo2">No, other countries</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="goToSection(6)">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="completeSection(7)">Continue ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Section 8: Contact Details -->
        <div class="section-card" data-section="8" id="section8">
            <div class="section-header" onclick="toggleSection(8)">
                <div class="section-header-left">
                    <div class="section-number">8</div>
                    <div class="section-info">
                        <h3>Contact Details</h3>
                        <p>How we can reach you</p>
                    </div>
                </div>
                <div class="section-status">
                    <span class="status-badge pending" id="status8">Not started</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
            </div>
            <div class="section-content">
                <div class="applicant-toggle" id="applicantToggle8" style="display: none;">
                    <button class="applicant-btn active" data-applicant="1" onclick="switchApplicant(8, 1)">Primary Applicant</button>
                    <button class="applicant-btn" data-applicant="2" onclick="switchApplicant(8, 2)">Joint Applicant</button>
                </div>

                <!-- Primary Applicant -->
                <div class="applicant-form active" id="applicant1Form8">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Email Address <span class="required">*</span></label>
                            <input type="email" class="form-input" id="email" placeholder="your@email.com" onchange="handleFieldChange('email', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Confirm Email <span class="required">*</span></label>
                            <input type="email" class="form-input" id="emailConfirm" placeholder="Confirm email" onchange="validateEmailMatch()">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Mobile Phone <span class="required">*</span></label>
                            <input type="tel" class="form-input" id="mobile" placeholder="07xxx xxxxxx" onchange="handleFieldChange('mobile', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Home Phone</label>
                            <input type="tel" class="form-input" id="homePhone" placeholder="Optional" onchange="handleFieldChange('homePhone', this.value)">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Preferred Contact Method</label>
                        <div class="option-group">
                            <div class="option-item">
                                <input type="radio" name="preferredContact" id="contactEmail" value="email" onchange="handleFieldChange('preferredContact', 'email')">
                                <label for="contactEmail">Email</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="preferredContact" id="contactPhone" value="phone" onchange="handleFieldChange('preferredContact', 'phone')">
                                <label for="contactPhone">Phone</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="preferredContact" id="contactPost" value="post" onchange="handleFieldChange('preferredContact', 'post')">
                                <label for="contactPost">Post</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Joint Applicant -->
                <div class="applicant-form" id="applicant2Form8">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Email Address <span class="required">*</span></label>
                            <input type="email" class="form-input" id="email_customer2" placeholder="your@email.com" onchange="handleFieldChange('email_customer2', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Mobile Phone <span class="required">*</span></label>
                            <input type="tel" class="form-input" id="mobile_customer2" placeholder="07xxx xxxxxx" onchange="handleFieldChange('mobile_customer2', this.value)">
                        </div>
                    </div>
                </div>

                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="goToSection(7)">‚Üê Previous</button>
                    <button class="btn btn-success" onclick="completeSection(8); completeForm()">Complete Section ‚úì</button>
                </div>
            </div>
        </div>

        <!-- Page Navigation -->
        <div class="page-navigation">
            <a href="evelyn_landing_page.html" class="nav-btn nav-btn-prev" id="backLink">‚Üê Back to Journey Selection</a>
            <button class="nav-btn nav-btn-next" onclick="proceedToNextForm()" id="nextFormBtn" disabled>
                Continue to Financial Profile ‚Üí
            </button>
        </div>
    </main>

    <script>
        // =========================================
        // JURISDICTION CONFIGURATION
        // =========================================
        const JURISDICTION_CONFIG = {
            UK: {
                code: 'UK',
                name: 'United Kingdom',
                currency: '¬£',
                postcodeLabel: 'Postcode',
                postcodePlaceholder: 'SW1A 1AA',
                postcodePattern: /^[A-Z]{1,2}\d[A-Z\d]?\s?\d[A-Z]{2}$/i,
                postcodeHint: 'Format: SW1A 1AA',
                taxIdLabel: 'National Insurance Number',
                taxIdPlaceholder: 'e.g. QQ 12 34 56 C',
                taxIdPattern: /^[A-Z]{2}\s?\d{2}\s?\d{2}\s?\d{2}\s?[A-Z]$/i,
                taxIdHint: 'Format: XX XX XX XX X',
                taxIdInfoText: 'Your National Insurance number helps us verify your identity and report tax information to HMRC.',
                taxAuthority: 'HMRC',
                nonResidentLabel: 'Non-UK jurisdiction',
                counties: ['Avon', 'Bedfordshire', 'Berkshire', 'Buckinghamshire', 'Cambridgeshire', 'Cheshire', 'Cornwall', 'Cumbria', 'Derbyshire', 'Devon', 'Dorset', 'Durham', 'East Sussex', 'Essex', 'Gloucestershire', 'Greater London', 'Greater Manchester', 'Hampshire', 'Hertfordshire', 'Kent', 'Lancashire', 'Leicestershire', 'Lincolnshire', 'Merseyside', 'Norfolk', 'North Yorkshire', 'Northamptonshire', 'Nottinghamshire', 'Oxfordshire', 'Shropshire', 'Somerset', 'South Yorkshire', 'Staffordshire', 'Suffolk', 'Surrey', 'Tyne and Wear', 'Warwickshire', 'West Midlands', 'West Sussex', 'West Yorkshire', 'Wiltshire', 'Worcestershire']
            },
            IE: {
                code: 'IE',
                name: 'Ireland',
                currency: '‚Ç¨',
                postcodeLabel: 'Eircode/Postcode',
                postcodePlaceholder: 'e.g. D02 AF30',
                postcodePattern: /^[A-Z]\d{2}\s?[A-Z0-9]{4}$/i,
                postcodeHint: 'Format: D02 AF30 (optional - not all Irish addresses have Eircodes)',
                taxIdLabel: 'PPS Number',
                taxIdPlaceholder: 'e.g. 1234567AB',
                taxIdPattern: /^\d{7}[A-Z]{1,2}$/i,
                taxIdHint: 'Format: 7 digits + 1-2 letters',
                taxIdInfoText: 'Your Personal Public Service (PPS) number is required for tax reporting to Revenue.',
                taxAuthority: 'Revenue',
                nonResidentLabel: 'Non-European jurisdiction',
                counties: ['Carlow', 'Cavan', 'Clare', 'Cork', 'Donegal', 'Dublin', 'Galway', 'Kerry', 'Kildare', 'Kilkenny', 'Laois', 'Leitrim', 'Limerick', 'Longford', 'Louth', 'Mayo', 'Meath', 'Monaghan', 'Offaly', 'Roscommon', 'Sligo', 'Tipperary', 'Waterford', 'Westmeath', 'Wexford', 'Wicklow']
            }
        };

        // =========================================
        // CONFIGURATION & STATE
        // =========================================
        const STORAGE_KEY = 'evelynFactFindPersonal';
        const TOTAL_SECTIONS = 8;
        
        let formData = {};
        let sectionStatus = {};
        let isJointApplication = false;
        let currentJurisdiction = 'UK';
        let saveTimeout = null;

        // =========================================
        // INITIALIZATION
        // =========================================
        document.addEventListener('DOMContentLoaded', function() {
            // Check URL params for application type and jurisdiction
            const urlParams = new URLSearchParams(window.location.search);
            isJointApplication = urlParams.get('type') === 'joint';
            
            // Get jurisdiction from URL or localStorage
            const urlJurisdiction = urlParams.get('jurisdiction');
            if (urlJurisdiction && JURISDICTION_CONFIG[urlJurisdiction]) {
                currentJurisdiction = urlJurisdiction;
                localStorage.setItem('evelynJurisdiction', currentJurisdiction);
            } else {
                const storedJurisdiction = localStorage.getItem('evelynJurisdiction');
                if (storedJurisdiction && JURISDICTION_CONFIG[storedJurisdiction]) {
                    currentJurisdiction = storedJurisdiction;
                }
            }
            
            // Apply jurisdiction-specific UI updates
            applyJurisdictionConfig();
            
            // Update UI for joint applications
            if (isJointApplication) {
                document.getElementById('applicationTypeBadge').textContent = 'Joint Application';
                document.querySelectorAll('.applicant-toggle').forEach(el => {
                    el.style.display = 'flex';
                });
            }

            // Set max date for DOB fields (must be 18+ years old)
            const today = new Date();
            const maxDate = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());
            const maxDateStr = maxDate.toISOString().split('T')[0];
            
            const dobField = document.getElementById('dateOfBirth');
            if (dobField) dobField.setAttribute('max', maxDateStr);
            
            const dobField2 = document.getElementById('dateOfBirth_customer2');
            if (dobField2) dobField2.setAttribute('max', maxDateStr);

            // Load saved data
            loadSavedData();
            
            // Initialize section statuses
            for (let i = 1; i <= TOTAL_SECTIONS; i++) {
                if (!sectionStatus[i]) {
                    sectionStatus[i] = 'pending';
                }
                updateSectionUI(i);
            }

            // Update progress
            updateProgress();
        });
        
        // =========================================
        // JURISDICTION HANDLING
        // =========================================
        function applyJurisdictionConfig() {
            const config = JURISDICTION_CONFIG[currentJurisdiction];
            
            // Update postcode fields
            updatePostcodeFields(config);
            
            // Update tax ID fields (NI/PPS)
            updateTaxIdFields(config);
            
            // Update county dropdowns
            updateCountyDropdowns(config);
            
            // Store jurisdiction in form data
            formData.jurisdiction = currentJurisdiction;
        }
        
        function updatePostcodeFields(config) {
            // Helper to update a field and its label
            function updateFieldLabel(inputId, labelText, placeholder, isRequired = true) {
                const input = document.getElementById(inputId);
                if (input) {
                    input.placeholder = placeholder;
                    // Find the label in the same form-group
                    const formGroup = input.closest('.form-group');
                    if (formGroup) {
                        const label = formGroup.querySelector('.form-label');
                        if (label) {
                            label.innerHTML = isRequired ? 
                                `${labelText} <span class="required">*</span>` : 
                                labelText;
                        }
                    }
                }
            }
            
            // Primary applicant postcode
            updateFieldLabel('postcode', config.postcodeLabel, config.postcodePlaceholder);
            
            // Previous address postcode
            updateFieldLabel('prevPostcode', config.postcodeLabel, config.postcodePlaceholder);
            
            // Joint applicant postcode
            updateFieldLabel('postcode_customer2', config.postcodeLabel, config.postcodePlaceholder);
            
            // Postcode search box
            const postcodeSearch = document.getElementById('postcodeSearch');
            if (postcodeSearch) {
                postcodeSearch.placeholder = `Enter ${config.postcodeLabel.toLowerCase()} to search`;
            }
            
            // Set country default based on jurisdiction
            const countrySelects = ['country', 'country_customer2'];
            countrySelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    // Remove existing selected attribute
                    Array.from(select.options).forEach(opt => opt.removeAttribute('selected'));
                    
                    // Set default based on jurisdiction
                    const defaultCountry = currentJurisdiction === 'IE' ? 'Ireland' : 'United Kingdom';
                    const option = Array.from(select.options).find(opt => opt.value === defaultCountry);
                    if (option) {
                        option.selected = true;
                        option.setAttribute('selected', 'selected');
                        // Trigger the change handler to store the value
                        if (!formData[selectId]) {
                            handleFieldChange(selectId, defaultCountry);
                        }
                    }
                }
            });
        }
        
        function updateTaxIdFields(config) {
            // Update section header
            const section5Header = document.querySelector('#section5 .section-info h3');
            if (section5Header) {
                section5Header.textContent = currentJurisdiction === 'IE' ? 
                    'PPS Number & Tax Reference' : 
                    'National Insurance & Tax Reference';
            }
            
            const section5Desc = document.querySelector('#section5 .section-info p');
            if (section5Desc) {
                section5Desc.textContent = currentJurisdiction === 'IE' ?
                    'Your PPS number and tax identifiers' :
                    'Your NI number and tax identifiers';
            }
            
            // Update progress step label
            const progressStep5 = document.querySelector('.progress-step[data-section="5"] span');
            if (progressStep5) {
                progressStep5.textContent = currentJurisdiction === 'IE' ? 'PPS' : 'NI/Tax';
            }
            
            // Primary applicant NI/PPS field
            const niLabel = document.querySelector('label[for="niNumber"]');
            if (niLabel) {
                niLabel.innerHTML = `${config.taxIdLabel} <span class="required">*</span>`;
            }
            
            const niInput = document.getElementById('niNumber');
            if (niInput) {
                niInput.placeholder = config.taxIdPlaceholder;
                // Update ID for Ireland
                if (currentJurisdiction === 'IE') {
                    niInput.id = 'ppsNumber';
                    niInput.name = 'ppsNumber';
                }
            }
            
            const niHint = document.querySelector('#niNumber + .form-hint, #ppsNumber + .form-hint');
            if (niHint) {
                niHint.textContent = config.taxIdHint;
            }
            
            // Update info box text
            const infoBox = document.querySelector('#applicant1Form5 .info-box p');
            if (infoBox) {
                infoBox.innerHTML = `‚ÑπÔ∏è ${config.taxIdInfoText}`;
            }
            
            // Joint applicant
            const niLabel2 = document.querySelector('label[for="niNumber_customer2"]');
            if (niLabel2) {
                niLabel2.innerHTML = `${config.taxIdLabel} <span class="required">*</span>`;
            }
            
            const niInput2 = document.getElementById('niNumber_customer2');
            if (niInput2) {
                niInput2.placeholder = config.taxIdPlaceholder;
                if (currentJurisdiction === 'IE') {
                    niInput2.id = 'ppsNumber_customer2';
                    niInput2.name = 'ppsNumber_customer2';
                }
            }
        }
        
        function updateCountyDropdowns(config) {
            // Convert county input to dropdown for better UX
            const countyInputs = ['county', 'county_customer2'];
            
            countyInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input && input.tagName === 'INPUT') {
                    // Create a datalist for autocomplete
                    const datalistId = inputId + '_list';
                    let datalist = document.getElementById(datalistId);
                    
                    if (!datalist) {
                        datalist = document.createElement('datalist');
                        datalist.id = datalistId;
                        input.parentNode.appendChild(datalist);
                        input.setAttribute('list', datalistId);
                    }
                    
                    // Populate with counties
                    datalist.innerHTML = config.counties.map(c => `<option value="${c}">`).join('');
                }
            });
        }
        
        function validatePostcode(value) {
            const config = JURISDICTION_CONFIG[currentJurisdiction];
            // For Ireland, postcode (Eircode) is optional
            if (currentJurisdiction === 'IE' && !value) return true;
            return config.postcodePattern.test(value.replace(/\s/g, ''));
        }
        
        function validateTaxId(value) {
            const config = JURISDICTION_CONFIG[currentJurisdiction];
            const cleanValue = value.replace(/\s/g, '').toUpperCase();
            return config.taxIdPattern.test(cleanValue);
        }

        // =========================================
        // DATA PERSISTENCE
        // =========================================
        function loadSavedData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const parsed = JSON.parse(saved);
                formData = parsed.formData || {};
                sectionStatus = parsed.sectionStatus || {};
                
                // Populate form fields
                Object.keys(formData).forEach(key => {
                    const value = formData[key];
                    
                    // First, try to find element by ID
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = value === true || value === 'true' || value === 'on';
                        } else {
                            element.value = value;
                        }
                    }
                    
                    // Also check for radio buttons by name (radio groups don't have ID matching the name)
                    const radios = document.querySelectorAll(`input[type="radio"][name="${key}"]`);
                    if (radios.length > 0) {
                        radios.forEach(radio => {
                            if (radio.value === value) {
                                radio.checked = true;
                            }
                        });
                    }
                });
                
                // Trigger any conditional section visibility based on loaded values
                restoreConditionalSections();

                updateSaveStatus('saved');
            }
        }
        
        // Restore visibility of conditional sections based on loaded data
        function restoreConditionalSections() {
            // Check for "Other" title selections
            if (formData.title === 'Other' && typeof toggleOtherTitle === 'function') {
                toggleOtherTitle(true);
            }
            if (formData.title_customer2 === 'Other' && typeof toggleOtherTitle2 === 'function') {
                toggleOtherTitle2(true);
            }
            
            // Check for previous address requirements (less than 3 years at current address)
            if (formData.yearsAtAddress && parseInt(formData.yearsAtAddress) < 3) {
                const prevSection = document.getElementById('previousAddressSection');
                if (prevSection) prevSection.classList.add('visible');
            }
            if (formData.yearsAtAddress_customer2 && parseInt(formData.yearsAtAddress_customer2) < 3) {
                const prevSection2 = document.getElementById('previousAddressSection2');
                if (prevSection2) prevSection2.classList.add('visible');
            }
            
            // Check for US person status
            const usPersonYes = document.getElementById('usPersonYes');
            if (usPersonYes && usPersonYes.checked) {
                const usDetails = document.getElementById('usPersonDetails');
                if (usDetails) usDetails.classList.add('visible');
            }
            const usPersonYes2 = document.getElementById('usPersonYes2');
            if (usPersonYes2 && usPersonYes2.checked) {
                const usDetails2 = document.getElementById('usPersonDetails2');
                if (usDetails2) usDetails2.classList.add('visible');
            }
        }

        function saveProgress() {
            const dataToSave = {
                formData: formData,
                sectionStatus: sectionStatus,
                lastSaved: new Date().toISOString(),
                applicationType: isJointApplication ? 'joint' : 'individual'
            };
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
            updateSaveStatus('saved');
        }

        function handleFieldChange(fieldName, value) {
            formData[fieldName] = value;
            updateSaveStatus('saving');
            
            // Debounced auto-save
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                saveProgress();
            }, 500);
        }

        function updateSaveStatus(status) {
            const icon = document.getElementById('saveStatusIcon');
            const text = document.getElementById('saveStatusText');
            
            icon.className = 'save-status-icon';
            
            if (status === 'saved') {
                icon.classList.add('saved');
                text.textContent = 'All changes saved';
            } else if (status === 'saving') {
                icon.classList.add('saving');
                text.textContent = 'Saving...';
            }
        }

        function clearForm() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        // =========================================
        // SECTION MANAGEMENT
        // =========================================
        
        // Scroll to section with offset to account for sticky header
        function scrollToSectionWithOffset(element) {
            const header = document.querySelector('.header');
            const headerHeight = header ? header.offsetHeight : 0;
            const offset = headerHeight + 20; // Extra padding for breathing room
            
            const elementPosition = element.getBoundingClientRect().top;
            const currentScrollPosition = window.pageYOffset;
            const targetPosition = currentScrollPosition + elementPosition - offset;
            
            window.scrollTo({
                top: targetPosition,
                behavior: 'smooth'
            });
        }
        
        function toggleSection(sectionNum) {
            const section = document.getElementById(`section${sectionNum}`);
            const wasExpanded = section.classList.contains('expanded');
            
            // Close all sections
            document.querySelectorAll('.section-card').forEach(card => {
                card.classList.remove('expanded');
            });
            
            // Toggle current section
            if (!wasExpanded) {
                section.classList.add('expanded');
                section.classList.add('active');
                
                // Scroll into view with offset for sticky header
                setTimeout(() => {
                    scrollToSectionWithOffset(section);
                }, 100);
            }
        }

        function goToSection(sectionNum) {
            toggleSection(sectionNum);
        }

        function completeSection(sectionNum) {
            // Validate section (basic validation)
            const isValid = validateSection(sectionNum);
            
            if (isValid) {
                sectionStatus[sectionNum] = 'completed';
                updateSectionUI(sectionNum);
                saveProgress();
                
                // Move to next section
                if (sectionNum < TOTAL_SECTIONS) {
                    toggleSection(sectionNum + 1);
                }
                
                updateProgress();
            }
        }

        function validateSection(sectionNum) {
            // Basic validation - check required fields
            const section = document.getElementById(`section${sectionNum}`);
            const requiredInputs = section.querySelectorAll('[required], .form-input');
            let isValid = true;
            
            // For now, return true (implement full validation as needed)
            return true;
        }

        function updateSectionUI(sectionNum) {
            const section = document.getElementById(`section${sectionNum}`);
            const statusBadge = document.getElementById(`status${sectionNum}`);
            const progressStep = document.querySelector(`.progress-step[data-section="${sectionNum}"]`);
            
            section.classList.remove('completed', 'in-progress');
            progressStep.classList.remove('completed', 'active');
            
            if (sectionStatus[sectionNum] === 'completed') {
                section.classList.add('completed');
                statusBadge.className = 'status-badge completed';
                statusBadge.textContent = 'Completed';
                progressStep.classList.add('completed');
            } else if (sectionStatus[sectionNum] === 'in-progress') {
                section.classList.add('in-progress');
                statusBadge.className = 'status-badge in-progress';
                statusBadge.textContent = 'In progress';
                progressStep.classList.add('active');
            } else {
                statusBadge.className = 'status-badge pending';
                statusBadge.textContent = 'Not started';
            }
        }

        function updateProgress() {
            const completed = Object.values(sectionStatus).filter(s => s === 'completed').length;
            const percent = Math.round((completed / TOTAL_SECTIONS) * 100);
            
            document.getElementById('progressFill').style.width = `${percent}%`;
            document.getElementById('progressPercent').textContent = `${percent}% Complete`;
            
            // Enable next form button if all sections complete
            const nextBtn = document.getElementById('nextFormBtn');
            if (completed === TOTAL_SECTIONS) {
                nextBtn.disabled = false;
            }
        }

        // =========================================
        // JOINT APPLICATION HANDLING
        // =========================================
        function switchApplicant(sectionNum, applicantNum) {
            const toggle = document.getElementById(`applicantToggle${sectionNum}`);
            const buttons = toggle.querySelectorAll('.applicant-btn');
            
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.dataset.applicant) === applicantNum) {
                    btn.classList.add('active');
                }
            });
            
            // Show/hide forms
            const form1 = document.getElementById(`applicant1Form${sectionNum}`);
            const form2 = document.getElementById(`applicant2Form${sectionNum}`);
            
            if (applicantNum === 1) {
                form1.classList.add('active');
                form2.classList.remove('active');
            } else {
                form1.classList.remove('active');
                form2.classList.add('active');
            }
        }

        // =========================================
        // CONDITIONAL FIELDS
        // =========================================
        function toggleOtherTitle(show) {
            document.getElementById('otherTitleSection').classList.toggle('visible', show);
        }

        function toggleOtherTitle2(show) {
            document.getElementById('otherTitleSection2').classList.toggle('visible', show);
        }

        function toggleOtherNationality(show) {
            document.getElementById('otherNationalitySection').classList.toggle('visible', show);
        }

        function toggleOtherTaxCountry(show) {
            document.getElementById('otherTaxCountrySection').classList.toggle('visible', show);
        }

        function checkPreviousAddress() {
            const years = parseInt(document.getElementById('yearsAtAddress').value) || 0;
            const show = years < 3;
            document.getElementById('previousAddressSection').classList.toggle('visible', show);
        }

        function handleSameAddress(same) {
            const jointFields = document.getElementById('jointAddressFields');
            if (same) {
                jointFields.style.display = 'none';
                // Copy address from primary
                handleFieldChange('sameAddress_customer2', 'yes');
            } else {
                jointFields.style.display = 'block';
                handleFieldChange('sameAddress_customer2', 'no');
            }
        }

        // =========================================
        // FIELD HELPERS
        // =========================================
        function formatNI(input) {
            if (currentJurisdiction === 'IE') {
                // PPS format: 7 digits + 1-2 letters (e.g., 1234567AB)
                let value = input.value.replace(/[^A-Za-z0-9]/g, '').toUpperCase();
                // Limit to 9 characters max
                input.value = value.substring(0, 9);
            } else {
                // UK NI format: XX XX XX XX X
                let value = input.value.replace(/[^A-Za-z0-9]/g, '').toUpperCase();
                let formatted = '';
                
                for (let i = 0; i < value.length && i < 9; i++) {
                    if (i === 2 || i === 4 || i === 6 || i === 8) {
                        formatted += ' ';
                    }
                    formatted += value[i];
                }
                
                input.value = formatted;
            }
        }

        function validateAge(fieldId) {
            const input = document.getElementById(fieldId);
            const dob = new Date(input.value);
            const today = new Date();
            let age = today.getFullYear() - dob.getFullYear();
            const monthDiff = today.getMonth() - dob.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
                age--;
            }
            
            // Determine error element ID
            const errorId = fieldId === 'dateOfBirth' ? 'dobAgeError' : 'dobAgeError_customer2';
            const errorEl = document.getElementById(errorId);
            
            // Display age for primary applicant
            if (fieldId === 'dateOfBirth' && !isNaN(age)) {
                document.getElementById('ageDisplay').textContent = `Age: ${age} years`;
            }
            
            // Validate age (must be 18+)
            if (!isNaN(age) && age < 18) {
                errorEl.style.display = 'block';
                input.style.borderColor = '#dc3545';
                input.value = ''; // Clear invalid date
                handleFieldChange(fieldId, ''); // Clear from form data
                if (fieldId === 'dateOfBirth') {
                    document.getElementById('ageDisplay').textContent = '';
                }
                return false;
            } else {
                errorEl.style.display = 'none';
                input.style.borderColor = '';
                return true;
            }
        }

        // Keep calculateAge as an alias for backward compatibility
        function calculateAge() {
            validateAge('dateOfBirth');
        }

        function validateEmailMatch() {
            const email = document.getElementById('email').value;
            const confirm = document.getElementById('emailConfirm').value;
            
            if (email && confirm && email !== confirm) {
                document.getElementById('emailConfirm').classList.add('error');
            } else {
                document.getElementById('emailConfirm').classList.remove('error');
            }
        }

        function lookupAddress() {
            // Placeholder for address lookup API integration
            alert('Address lookup would connect to a postcode API service.');
        }

        function showUSPersonWarning() {
            alert('Important: US persons may be subject to additional tax reporting requirements. Please consult with your financial adviser.');
        }

        // =========================================
        // NAVIGATION
        // =========================================
        function proceedToNextForm() {
            saveProgress();
            const type = isJointApplication ? 'joint' : 'individual';
            window.location.href = `factfind_02_financial_profile.html?type=${type}&jurisdiction=${currentJurisdiction}`;
        }

        function completeForm() {
            // Mark form as complete in master storage
            const masterData = JSON.parse(localStorage.getItem('evelynFactFindMaster') || '{}');
            masterData.personalInformation = {
                complete: true,
                timestamp: new Date().toISOString()
            };
            masterData.jurisdiction = currentJurisdiction;
            localStorage.setItem('evelynFactFindMaster', JSON.stringify(masterData));
        }
    </script>
</body>
</html>
