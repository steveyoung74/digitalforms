<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Profile | Evelyn Partners Fact Find</title>
    <style>
        :root {
            /* Primary Brand Colours - Evelyn Partners Rebrand */
            --primary: #2D2047;
            --primary-dark: #1E1530;
            --primary-light: #6B3FA0;
            
            /* Secondary Accent Colours */
            --accent-teal: #34675C;
            --accent-coral: #E07065;
            --accent-blue: #5299E0;
            --accent-gold: #C4A35A;
            
            /* Semantic Colours */
            --success: #28a745;
            --success-light: #d4edda;
            --warning: #ffc107;
            --danger: #dc3545;
            
            /* Neutral Grays */
            --gray-50: #f8f9fa;
            --gray-100: #f0f1f3;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            
            /* UI Properties */
            --border-radius: 8px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
            --transition: all 0.2s ease;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--gray-100);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-md);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .logo { font-size: 20px; font-weight: 600; }

        .type-badge {
            background: rgba(255,255,255,0.2);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }

        .header-main { padding: 20px 24px; }
        .journey-title { font-size: 14px; opacity: 0.9; margin-bottom: 4px; }
        .section-title { font-size: 24px; font-weight: 600; margin-bottom: 8px; }
        .section-description { font-size: 14px; opacity: 0.85; }

        .progress-container {
            background: rgba(0,0,0,0.2);
            padding: 16px 24px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 8px;
            opacity: 0.9;
        }

        .progress-bar {
            height: 6px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: white;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 10px;
            opacity: 0.7;
            cursor: pointer;
            transition: var(--transition);
        }

        .progress-step:hover, .progress-step.active, .progress-step.completed { opacity: 1; }

        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            margin-bottom: 4px;
            transition: var(--transition);
        }

        .progress-step.active .step-dot {
            background: white;
            box-shadow: 0 0 0 3px rgba(255,255,255,0.3);
        }

        .progress-step.completed .step-dot { background: var(--success); }

        .main-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 24px;
        }

        .save-status-bar {
            background: white;
            border-radius: var(--border-radius);
            padding: 12px 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-sm);
        }

        .save-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--gray-600);
        }

        .save-status-icon {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--gray-400);
        }

        .save-status-icon.saved { background: var(--success); }
        .save-status-icon.saving { background: var(--warning); animation: pulse 1s infinite; }

        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        .btn-save {
            background: var(--gray-100);
            color: var(--gray-700);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-save:hover { background: var(--gray-200); }

        .section-card {
            background: white;
            border-radius: var(--border-radius);
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            border: 1px solid var(--gray-200);
        }

        .section-header {
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid transparent;
        }

        .section-card.expanded .section-header { border-bottom-color: var(--gray-200); }
        .section-header:hover { background: var(--gray-50); }

        .section-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .section-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            color: var(--gray-600);
        }

        .section-card.completed .section-number { background: var(--success-light); color: var(--success); }
        .section-card.active .section-number { background: var(--primary); color: white; }

        .section-info h3 { font-size: 16px; font-weight: 600; color: var(--gray-800); margin-bottom: 2px; }
        .section-info p { font-size: 13px; color: var(--gray-500); }

        .status-badge {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 500;
        }

        .status-badge.pending { background: var(--gray-100); color: var(--gray-600); }
        .status-badge.completed { background: var(--success-light); color: var(--success); }

        .toggle-icon {
            font-size: 20px;
            color: var(--gray-400);
            transition: transform 0.2s ease;
        }

        .section-card.expanded .toggle-icon { transform: rotate(180deg); }

        .section-content {
            display: none;
            padding: 24px;
            background: var(--gray-50);
        }

        .section-card.expanded .section-content { display: block; }

        .applicant-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            padding: 4px;
            background: var(--gray-100);
            border-radius: 8px;
            width: fit-content;
        }

        .applicant-btn {
            padding: 10px 20px;
            border: none;
            background: transparent;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            transition: var(--transition);
        }

        .applicant-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .applicant-form { display: none; }
        .applicant-form.active { display: block; }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group.full-width { grid-column: 1 / -1; }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 6px;
        }

        .form-label .required { color: var(--danger); }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 15px;
            color: var(--gray-800);
            background: white;
            transition: var(--transition);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(45, 32, 71, 0.15);
        }

        .form-textarea { min-height: 100px; resize: vertical; }
        .form-hint { font-size: 12px; color: var(--gray-500); margin-top: 4px; }

        .option-group { display: flex; flex-wrap: wrap; gap: 12px; }

        .option-item { position: relative; }
        .option-item input { position: absolute; opacity: 0; }

        .option-item label {
            display: block;
            padding: 12px 20px;
            background: white;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
        }

        .option-item input:checked + label {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .option-item label:hover { border-color: var(--primary); }

        .conditional-section {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 6px;
            border: 1px dashed var(--gray-300);
        }

        .conditional-section.visible { display: block; }

        .section-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-200);
        }

        .btn {
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .btn-secondary {
            background: white;
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }

        .btn-secondary:hover { background: var(--gray-50); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-success { background: var(--success); color: white; }
        .btn-success:hover { background: #218838; }

        .page-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 32px;
            padding: 24px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 14px 28px;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            text-decoration: none;
        }

        .nav-btn-prev { background: var(--gray-100); color: var(--gray-700); }
        .nav-btn-prev:hover { background: var(--gray-200); }
        .nav-btn-next { background: var(--primary); color: white; }
        .nav-btn-next:hover { background: var(--primary-dark); }
        .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .info-box {
            background: #e7f3ff;
            border: 1px solid #b3d7ff;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .info-box p { font-size: 14px; color: #004085; }

        .wealth-source-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .wealth-source-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .wealth-source-title { font-weight: 600; color: var(--gray-800); }

        .btn-remove {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 14px;
        }

        .btn-add-source {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: var(--gray-50);
            border: 2px dashed var(--gray-300);
            border-radius: 8px;
            color: var(--gray-600);
            cursor: pointer;
            width: 100%;
            justify-content: center;
            transition: var(--transition);
        }

        .btn-add-source:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .currency-input {
            position: relative;
        }

        .currency-input::before {
            content: attr(data-currency);
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-500);
            z-index: 1;
        }

        .currency-input input {
            padding-left: 28px;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .header { transition: transform 0.3s ease; }
            .header.header-hidden { transform: translateY(-100%); }
            .header-top { flex-direction: row; padding: 10px 16px; gap: 8px; }
            .logo { font-size: 16px; }
            .type-badge { padding: 4px 10px; font-size: 11px; }
            .header-main { padding: 12px 16px; }
            .journey-title { font-size: 12px; margin-bottom: 2px; }
            .section-title { font-size: 18px; margin-bottom: 4px; }
            .section-description { font-size: 12px; display: none; }
            .progress-container { padding: 10px 16px; }
            .progress-label { font-size: 11px; margin-bottom: 6px; }
            .progress-bar { height: 4px; }
            .progress-steps { margin-top: 8px; }
            .progress-step { font-size: 0; }
            .step-dot { width: 8px; height: 8px; margin-bottom: 0; }
            .progress-step.active .step-dot { box-shadow: 0 0 0 2px rgba(255,255,255,0.3); }
            .main-content { padding: 12px; }
            .form-row { grid-template-columns: 1fr; }
            .page-navigation { flex-direction: column; gap: 12px; }
            .nav-btn { width: 100%; justify-content: center; }
            .section-card { margin-bottom: 12px; }
            .form-input, .form-select { padding: 10px 12px; font-size: 16px; }
        }
    </style>
    <script>
        (function() {
            let lastScrollTop = 0;
            let header = null;
            function initMobileHeader() {
                header = document.querySelector('.header');
                if (!header || window.innerWidth > 768) return;
                window.addEventListener('scroll', function() {
                    if (window.innerWidth > 768) { header.classList.remove('header-hidden'); return; }
                    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                    if (scrollTop > lastScrollTop && scrollTop > 100) { header.classList.add('header-hidden'); }
                    else if (scrollTop < lastScrollTop - 10) { header.classList.remove('header-hidden'); }
                    lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
                }, { passive: true });
                window.addEventListener('resize', function() { if (window.innerWidth > 768) header.classList.remove('header-hidden'); });
            }
            if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initMobileHeader);
            else initMobileHeader();
        })();
    </script>
</head>
<body>
    <header class="header">
        <div class="header-top">
            <div class="logo">Evelyn Partners</div>
            <div class="application-type">
                <span class="type-badge" id="applicationTypeBadge">Individual</span>
            </div>
        </div>
        <div class="header-main">
            <div class="journey-title">Fact Find A ‚Ä¢ Section 2 of 6</div>
            <h1 class="section-title">Financial Profile</h1>
            <p class="section-description">Employment, income, and the sources of your wealth and funds</p>
        </div>
        <div class="progress-container">
            <div class="progress-label">
                <span>Section Progress</span>
                <span id="progressPercent">0% Complete</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps">
                <div class="progress-step active" data-section="1">
                    <div class="step-dot"></div>
                    <span>Employment</span>
                </div>
                <div class="progress-step" data-section="2">
                    <div class="step-dot"></div>
                    <span>Income</span>
                </div>
                <div class="progress-step" data-section="3">
                    <div class="step-dot"></div>
                    <span>Wealth</span>
                </div>
                <div class="progress-step" data-section="4">
                    <div class="step-dot"></div>
                    <span>Funds</span>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="save-status-bar">
            <div class="save-status">
                <div class="save-status-icon" id="saveStatusIcon"></div>
                <span id="saveStatusText">All changes saved</span>
            </div>
            <div style="display: flex; gap: 12px;">
                <button class="btn-save" onclick="saveProgress()">üíæ Save Progress</button>
                <button class="btn-save" onclick="clearForm()">üóëÔ∏è Clear Form</button>
            </div>
        </div>

        <!-- Section 9: Employment Status -->
        <div class="section-card expanded" data-section="1" id="section1">
            <div class="section-header" onclick="toggleSection(1)">
                <div class="section-header-left">
                    <div class="section-number">9</div>
                    <div class="section-info">
                        <h3>Employment Status</h3>
                        <p>Your current employment situation</p>
                    </div>
                </div>
                <div class="section-status">
                    <span class="status-badge pending" id="status1">Not started</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
            </div>
            <div class="section-content">
                <div class="applicant-toggle" id="applicantToggle1" style="display: none;">
                    <button class="applicant-btn active" onclick="switchApplicant(1, 1)">Primary Applicant</button>
                    <button class="applicant-btn" onclick="switchApplicant(1, 2)">Joint Applicant</button>
                </div>

                <div class="applicant-form active" id="applicant1Form1">
                    <div class="form-group">
                        <label class="form-label">Employment Status <span class="required">*</span></label>
                        <div class="option-group">
                            <div class="option-item">
                                <input type="radio" name="employmentStatus" id="empEmployed" value="employed" onchange="handleEmploymentChange('employed')">
                                <label for="empEmployed">Employed</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="employmentStatus" id="empSelfEmployed" value="self-employed" onchange="handleEmploymentChange('self-employed')">
                                <label for="empSelfEmployed">Self-Employed</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="employmentStatus" id="empRetired" value="retired" onchange="handleEmploymentChange('retired')">
                                <label for="empRetired">Retired</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="employmentStatus" id="empNotWorking" value="not-working" onchange="handleEmploymentChange('not-working')">
                                <label for="empNotWorking">Not Working</label>
                            </div>
                        </div>
                    </div>

                    <!-- Employed Details -->
                    <div class="conditional-section" id="employedSection">
                        <h4 style="margin-bottom: 16px; color: var(--gray-700);">Employment Details</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Occupation <span class="required">*</span></label>
                                <input type="text" class="form-input" id="occupation" placeholder="Job title" onchange="handleFieldChange('occupation', this.value)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Industry <span class="required">*</span></label>
                                <select class="form-select" id="industry" onchange="handleFieldChange('industry', this.value)">
                                    <option value="">Select industry</option>
                                    <option value="Financial Services">Financial Services</option>
                                    <option value="Healthcare">Healthcare</option>
                                    <option value="Technology">Technology</option>
                                    <option value="Education">Education</option>
                                    <option value="Legal">Legal</option>
                                    <option value="Construction">Construction</option>
                                    <option value="Retail">Retail</option>
                                    <option value="Manufacturing">Manufacturing</option>
                                    <option value="Public Sector">Public Sector</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Employer Name <span class="required">*</span></label>
                                <input type="text" class="form-input" id="employerName" placeholder="Company name" onchange="handleFieldChange('employerName', this.value)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Position Held Since</label>
                                <input type="date" class="form-input" id="positionSince" onchange="handleFieldChange('positionSince', this.value)">
                            </div>
                        </div>
                        <div class="form-group full-width">
                            <label class="form-label">Employer Address</label>
                            <textarea class="form-textarea" id="employerAddress" placeholder="Full address including postcode" onchange="handleFieldChange('employerAddress', this.value)"></textarea>
                        </div>
                    </div>

                    <!-- Self-Employed Details -->
                    <div class="conditional-section" id="selfEmployedSection">
                        <h4 style="margin-bottom: 16px; color: var(--gray-700);">Business Details</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Business Name <span class="required">*</span></label>
                                <input type="text" class="form-input" id="businessName" placeholder="Company/trading name" onchange="handleFieldChange('businessName', this.value)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nature of Business <span class="required">*</span></label>
                                <input type="text" class="form-input" id="businessNature" placeholder="What does the business do?" onchange="handleFieldChange('businessNature', this.value)">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Business Type</label>
                                <select class="form-select" id="businessType" onchange="handleFieldChange('businessType', this.value)">
                                    <option value="">Select type</option>
                                    <option value="Sole Trader">Sole Trader</option>
                                    <option value="Partnership">Partnership</option>
                                    <option value="Limited Company">Limited Company</option>
                                    <option value="LLP">LLP</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Years Trading</label>
                                <input type="number" class="form-input" id="yearsTrading" placeholder="Number of years" min="0" onchange="handleFieldChange('yearsTrading', this.value)">
                            </div>
                        </div>
                    </div>

                    <!-- Retired Details -->
                    <div class="conditional-section" id="retiredSection">
                        <h4 style="margin-bottom: 16px; color: var(--gray-700);">Previous Employment</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Previous Occupation</label>
                                <input type="text" class="form-input" id="prevOccupation" placeholder="Previous job title" onchange="handleFieldChange('prevOccupation', this.value)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Previous Industry</label>
                                <input type="text" class="form-input" id="prevIndustry" placeholder="Industry" onchange="handleFieldChange('prevIndustry', this.value)">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Year of Retirement</label>
                                <input type="number" class="form-input" id="retirementYear" placeholder="YYYY" min="1950" max="2025" onchange="handleFieldChange('retirementYear', this.value)">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Joint Applicant Employment -->
                <div class="applicant-form" id="applicant2Form1">
                    <div class="form-group">
                        <label class="form-label">Employment Status <span class="required">*</span></label>
                        <div class="option-group">
                            <div class="option-item">
                                <input type="radio" name="employmentStatus_customer2" id="empEmployed2" value="employed" onchange="handleFieldChange('employmentStatus_customer2', 'employed')">
                                <label for="empEmployed2">Employed</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="employmentStatus_customer2" id="empSelfEmployed2" value="self-employed" onchange="handleFieldChange('employmentStatus_customer2', 'self-employed')">
                                <label for="empSelfEmployed2">Self-Employed</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="employmentStatus_customer2" id="empRetired2" value="retired" onchange="handleFieldChange('employmentStatus_customer2', 'retired')">
                                <label for="empRetired2">Retired</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="employmentStatus_customer2" id="empNotWorking2" value="not-working" onchange="handleFieldChange('employmentStatus_customer2', 'not-working')">
                                <label for="empNotWorking2">Not Working</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-row" style="margin-top: 20px;">
                        <div class="form-group">
                            <label class="form-label">Occupation</label>
                            <input type="text" class="form-input" id="occupation_customer2" placeholder="Job title" onchange="handleFieldChange('occupation_customer2', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Employer Name</label>
                            <input type="text" class="form-input" id="employerName_customer2" placeholder="Company name" onchange="handleFieldChange('employerName_customer2', this.value)">
                        </div>
                    </div>
                </div>

                <div class="section-actions">
                    <button class="btn btn-primary" onclick="completeSection(1)">Continue ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Section 10: Income Details -->
        <div class="section-card" data-section="2" id="section2">
            <div class="section-header" onclick="toggleSection(2)">
                <div class="section-header-left">
                    <div class="section-number">10</div>
                    <div class="section-info">
                        <h3>Income Details</h3>
                        <p>Your annual income from all sources</p>
                    </div>
                </div>
                <div class="section-status">
                    <span class="status-badge pending" id="status2">Not started</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
            </div>
            <div class="section-content">
                <div class="applicant-toggle" id="applicantToggle2" style="display: none;">
                    <button class="applicant-btn active" onclick="switchApplicant(2, 1)">Primary Applicant</button>
                    <button class="applicant-btn" onclick="switchApplicant(2, 2)">Joint Applicant</button>
                </div>

                <div class="applicant-form active" id="applicant1Form2">
                    <div class="info-box">
                        <p>‚ÑπÔ∏è Please provide your gross annual income (before tax) from all sources. This helps us assess your financial capacity.</p>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Employment Income <span class="required">*</span></label>
                            <div class="currency-input" data-currency="¬£">
                                <input type="number" class="form-input" id="incomeEmployment" placeholder="0" style="padding-left: 28px;" onchange="handleFieldChange('incomeEmployment', this.value); calculateTotalIncome()">
                            </div>
                            <span class="form-hint">Salary, wages, bonuses</span>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pension Income</label>
                            <div class="currency-input" data-currency="¬£">
                                <input type="number" class="form-input" id="incomePension" placeholder="0" style="padding-left: 28px;" onchange="handleFieldChange('incomePension', this.value); calculateTotalIncome()">
                            </div>
                            <span class="form-hint">State & private pensions</span>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Investment Income</label>
                            <div class="currency-input" data-currency="¬£">
                                <input type="number" class="form-input" id="incomeInvestments" placeholder="0" style="padding-left: 28px;" onchange="handleFieldChange('incomeInvestments', this.value); calculateTotalIncome()">
                            </div>
                            <span class="form-hint">Dividends, interest</span>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Rental Income</label>
                            <div class="currency-input" data-currency="¬£">
                                <input type="number" class="form-input" id="incomeRental" placeholder="0" style="padding-left: 28px;" onchange="handleFieldChange('incomeRental', this.value); calculateTotalIncome()">
                            </div>
                            <span class="form-hint">Property rental income</span>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Other Income</label>
                            <div class="currency-input" data-currency="¬£">
                                <input type="number" class="form-input" id="incomeOther" placeholder="0" style="padding-left: 28px;" onchange="handleFieldChange('incomeOther', this.value); calculateTotalIncome()">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Specify Other Income Source</label>
                            <input type="text" class="form-input" id="incomeOtherSource" placeholder="e.g. Trust income, royalties" onchange="handleFieldChange('incomeOtherSource', this.value)">
                        </div>
                    </div>

                    <div style="background: var(--gray-100); padding: 16px; border-radius: 8px; margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 600; color: var(--gray-700);">Total Annual Income</span>
                            <span style="font-size: 24px; font-weight: 700; color: var(--primary);" id="totalIncomeDisplay">¬£0</span>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 24px;">
                        <label class="form-label">Your Tax Position <span class="required">*</span></label>
                        <div class="option-group" id="taxRateOptions">
                            <div class="option-item">
                                <input type="radio" name="taxRate" id="taxNil" value="nil" onchange="handleFieldChange('taxRate', 'nil')">
                                <label for="taxNil">Non-taxpayer</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="taxRate" id="taxBasic" value="basic" onchange="handleFieldChange('taxRate', 'basic')">
                                <label for="taxBasic">Basic Rate (20%)</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="taxRate" id="taxHigher" value="higher" onchange="handleFieldChange('taxRate', 'higher')">
                                <label for="taxHigher">Higher Rate (40%)</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="taxRate" id="taxAdditional" value="additional" onchange="handleFieldChange('taxRate', 'additional')">
                                <label for="taxAdditional">Additional Rate (45%)</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="applicant-form" id="applicant2Form2">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Employment Income</label>
                            <div class="currency-input" data-currency="¬£">
                                <input type="number" class="form-input" id="incomeEmployment_customer2" placeholder="0" style="padding-left: 28px;" onchange="handleFieldChange('incomeEmployment_customer2', this.value)">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pension Income</label>
                            <div class="currency-input" data-currency="¬£">
                                <input type="number" class="form-input" id="incomePension_customer2" placeholder="0" style="padding-left: 28px;" onchange="handleFieldChange('incomePension_customer2', this.value)">
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Investment Income</label>
                            <div class="currency-input" data-currency="¬£">
                                <input type="number" class="form-input" id="incomeInvestments_customer2" placeholder="0" style="padding-left: 28px;" onchange="handleFieldChange('incomeInvestments_customer2', this.value)">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Other Income</label>
                            <div class="currency-input" data-currency="¬£">
                                <input type="number" class="form-input" id="incomeOther_customer2" placeholder="0" style="padding-left: 28px;" onchange="handleFieldChange('incomeOther_customer2', this.value)">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="goToSection(1)">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="completeSection(2)">Continue ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Section 11: Source of Wealth -->
        <div class="section-card" data-section="3" id="section3">
            <div class="section-header" onclick="toggleSection(3)">
                <div class="section-header-left">
                    <div class="section-number">11</div>
                    <div class="section-info">
                        <h3>Source of Wealth</h3>
                        <p>How you've accumulated your overall wealth</p>
                    </div>
                </div>
                <div class="section-status">
                    <span class="status-badge pending" id="status3">Not started</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
            </div>
            <div class="section-content">
                <div class="applicant-toggle" id="applicantToggle3" style="display: none;">
                    <button class="applicant-btn active" onclick="switchApplicant(3, 1)">Primary Applicant</button>
                    <button class="applicant-btn" onclick="switchApplicant(3, 2)">Joint Applicant</button>
                </div>

                <div class="applicant-form active" id="applicant1Form3">
                    <div class="info-box">
                        <p>‚ÑπÔ∏è Source of Wealth refers to how you have accumulated your total wealth over time. This is a regulatory requirement for AML compliance.</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Total Net Wealth (estimate) <span class="required">*</span></label>
                        <select class="form-select" id="totalNetWealth" onchange="handleFieldChange('totalNetWealth', this.value)">
                            <option value="">Select range</option>
                            <option value="under-100k">Under ¬£100,000</option>
                            <option value="100k-250k">¬£100,000 - ¬£250,000</option>
                            <option value="250k-500k">¬£250,000 - ¬£500,000</option>
                            <option value="500k-1m">¬£500,000 - ¬£1,000,000</option>
                            <option value="1m-5m">¬£1,000,000 - ¬£5,000,000</option>
                            <option value="over-5m">Over ¬£5,000,000</option>
                        </select>
                    </div>

                    <div class="form-group" style="margin-top: 24px;">
                        <label class="form-label">How was your wealth acquired? <span class="required">*</span></label>
                        <p class="form-hint" style="margin-bottom: 12px;">Select all that apply</p>
                    </div>

                    <div id="wealthSources">
                        <div class="wealth-source-card" id="wealthSource1">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Source Type <span class="required">*</span></label>
                                    <select class="form-select" id="wealthSourceType1" onchange="handleWealthSourceChange(1)">
                                        <option value="">Select source</option>
                                        <option value="salary">Salary/Employment Income</option>
                                        <option value="self-employment">Self-Employment/Business</option>
                                        <option value="inheritance">Inheritance</option>
                                        <option value="property-sale">Sale of Property</option>
                                        <option value="business-sale">Sale of Business</option>
                                        <option value="investments">Investment Returns</option>
                                        <option value="pension">Pension Transfers</option>
                                        <option value="divorce">Divorce Settlement</option>
                                        <option value="gift">Gift</option>
                                        <option value="lottery">Lottery/Gambling Winnings</option>
                                        <option value="compensation">Compensation/Legal Award</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Approximate Value</label>
                                    <div class="currency-input" data-currency="¬£">
                                        <input type="number" class="form-input" id="wealthSourceValue1" placeholder="0" style="padding-left: 28px;" onchange="handleFieldChange('wealthSourceValue1', this.value)">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Please provide details</label>
                                <textarea class="form-textarea" id="wealthSourceDetails1" placeholder="e.g. Employment at XYZ Company from 2010-2023 as Senior Manager" onchange="handleFieldChange('wealthSourceDetails1', this.value)"></textarea>
                            </div>
                        </div>
                    </div>

                    <button class="btn-add-source" onclick="addWealthSource()">+ Add Another Source of Wealth</button>
                </div>

                <div class="applicant-form" id="applicant2Form3">
                    <div class="form-group">
                        <label class="form-label">Total Net Wealth (estimate)</label>
                        <select class="form-select" id="totalNetWealth_customer2" onchange="handleFieldChange('totalNetWealth_customer2', this.value)">
                            <option value="">Select range</option>
                            <option value="under-100k">Under ¬£100,000</option>
                            <option value="100k-250k">¬£100,000 - ¬£250,000</option>
                            <option value="250k-500k">¬£250,000 - ¬£500,000</option>
                            <option value="500k-1m">¬£500,000 - ¬£1,000,000</option>
                            <option value="1m-5m">¬£1,000,000 - ¬£5,000,000</option>
                            <option value="over-5m">Over ¬£5,000,000</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-top: 16px;">
                        <label class="form-label">Primary Source of Wealth</label>
                        <select class="form-select" id="wealthSourceType_customer2" onchange="handleFieldChange('wealthSourceType_customer2', this.value)">
                            <option value="">Select source</option>
                            <option value="salary">Salary/Employment Income</option>
                            <option value="self-employment">Self-Employment/Business</option>
                            <option value="inheritance">Inheritance</option>
                            <option value="property-sale">Sale of Property</option>
                            <option value="investments">Investment Returns</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="goToSection(2)">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="completeSection(3)">Continue ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Section 12: Source of Funds -->
        <div class="section-card" data-section="4" id="section4">
            <div class="section-header" onclick="toggleSection(4)">
                <div class="section-header-left">
                    <div class="section-number">12</div>
                    <div class="section-info">
                        <h3>Source of Funds</h3>
                        <p>Where the funds for this investment are coming from</p>
                    </div>
                </div>
                <div class="section-status">
                    <span class="status-badge pending" id="status4">Not started</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
            </div>
            <div class="section-content">
                <div class="applicant-toggle" id="applicantToggle4" style="display: none;">
                    <button class="applicant-btn active" onclick="switchApplicant(4, 1)">Primary Applicant</button>
                    <button class="applicant-btn" onclick="switchApplicant(4, 2)">Joint Applicant</button>
                </div>

                <div class="applicant-form active" id="applicant1Form4">
                    <div class="info-box">
                        <p>‚ÑπÔ∏è Source of Funds refers specifically to the money you will be investing with us. This may differ from your overall source of wealth.</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Intended Investment Amount <span class="required">*</span></label>
                        <div class="currency-input" data-currency="¬£">
                            <input type="number" class="form-input" id="investmentAmount" placeholder="0" style="padding-left: 28px;" onchange="handleFieldChange('investmentAmount', this.value)">
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 24px;">
                        <label class="form-label">Where are these funds coming from? <span class="required">*</span></label>
                        <div class="option-group" style="flex-direction: column; gap: 8px;">
                            <div class="option-item" style="width: 100%;">
                                <input type="checkbox" name="fundSource" id="fundSavings" value="savings" onchange="handleFundSourceChange('savings', this.checked)">
                                <label for="fundSavings" style="width: 100%;">Savings / Cash in bank</label>
                            </div>
                            <div class="option-item" style="width: 100%;">
                                <input type="checkbox" name="fundSource" id="fundTransfer" value="transfer" onchange="handleFundSourceChange('transfer', this.checked)">
                                <label for="fundTransfer" style="width: 100%;">Transfer from another investment manager</label>
                            </div>
                            <div class="option-item" style="width: 100%;">
                                <input type="checkbox" name="fundSource" id="fundPropertySale" value="property-sale" onchange="handleFundSourceChange('property-sale', this.checked)">
                                <label for="fundPropertySale" style="width: 100%;">Proceeds from property sale</label>
                            </div>
                            <div class="option-item" style="width: 100%;">
                                <input type="checkbox" name="fundSource" id="fundInheritance" value="inheritance" onchange="handleFundSourceChange('inheritance', this.checked)">
                                <label for="fundInheritance" style="width: 100%;">Inheritance</label>
                            </div>
                            <div class="option-item" style="width: 100%;">
                                <input type="checkbox" name="fundSource" id="fundPension" value="pension" onchange="handleFundSourceChange('pension', this.checked)">
                                <label for="fundPension" style="width: 100%;">Pension lump sum / PCLS</label>
                            </div>
                            <div class="option-item" style="width: 100%;">
                                <input type="checkbox" name="fundSource" id="fundOther" value="other" onchange="handleFundSourceChange('other', this.checked); toggleOtherFundSource(this.checked)">
                                <label for="fundOther" style="width: 100%;">Other</label>
                            </div>
                        </div>
                    </div>

                    <div class="conditional-section" id="otherFundSourceSection">
                        <div class="form-group">
                            <label class="form-label">Please specify the source</label>
                            <input type="text" class="form-input" id="otherFundSourceDetail" placeholder="Describe the source" onchange="handleFieldChange('otherFundSourceDetail', this.value)">
                        </div>
                    </div>

                    <div class="conditional-section visible" id="fundSourceDetailSection" style="margin-top: 20px;">
                        <div class="form-group">
                            <label class="form-label">Please provide more details about the source of these funds <span class="required">*</span></label>
                            <textarea class="form-textarea" id="fundSourceDetails" placeholder="Example: Proceeds from sale of property at 14 High Street, London in March 2024 for ¬£500,000. Now held in Barclays savings account." onchange="handleFieldChange('fundSourceDetails', this.value)"></textarea>
                            <span class="form-hint">Please be specific - include dates, amounts, and institutions where applicable</span>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 24px;">
                        <label class="form-label">If transferring from another manager, please provide:</label>
                        <div class="form-row" style="margin-top: 12px;">
                            <div class="form-group">
                                <label class="form-label">Manager/Broker Name</label>
                                <input type="text" class="form-input" id="transferManagerName" placeholder="e.g. Hargreaves Lansdown" onchange="handleFieldChange('transferManagerName', this.value)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Account/Reference Number</label>
                                <input type="text" class="form-input" id="transferAccountRef" placeholder="Account reference" onchange="handleFieldChange('transferAccountRef', this.value)">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="applicant-form" id="applicant2Form4">
                    <div class="form-group">
                        <label class="form-label">Contribution to Joint Investment</label>
                        <div class="currency-input" data-currency="¬£">
                            <input type="number" class="form-input" id="investmentAmount_customer2" placeholder="0" style="padding-left: 28px;" onchange="handleFieldChange('investmentAmount_customer2', this.value)">
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 16px;">
                        <label class="form-label">Source of Funds</label>
                        <select class="form-select" id="fundSource_customer2" onchange="handleFieldChange('fundSource_customer2', this.value)">
                            <option value="">Select source</option>
                            <option value="savings">Savings / Cash</option>
                            <option value="transfer">Transfer from another manager</option>
                            <option value="property-sale">Property Sale</option>
                            <option value="inheritance">Inheritance</option>
                            <option value="pension">Pension lump sum</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="goToSection(3)">‚Üê Previous</button>
                    <button class="btn btn-success" onclick="completeSection(4); completeForm()">Complete Section ‚úì</button>
                </div>
            </div>
        </div>

        <div class="page-navigation">
            <a href="factfind_01_personal_information.html" class="nav-btn nav-btn-prev">‚Üê Back to Personal Information</a>
            <button class="nav-btn nav-btn-next" onclick="proceedToNextForm()" id="nextFormBtn" disabled>
                Continue to Investment Suitability ‚Üí
            </button>
        </div>
    </main>

    <script>
        // =========================================
        // JURISDICTION CONFIGURATION
        // =========================================
        const JURISDICTION_CONFIG = {
            UK: {
                code: 'UK',
                currency: '¬£',
                currencyCode: 'GBP',
                netWorthBands: [
                    { value: 'under-100k', label: 'Under ¬£100,000' },
                    { value: '100k-250k', label: '¬£100,000 - ¬£250,000' },
                    { value: '250k-500k', label: '¬£250,000 - ¬£500,000' },
                    { value: '500k-1m', label: '¬£500,000 - ¬£1,000,000' },
                    { value: '1m-5m', label: '¬£1,000,000 - ¬£5,000,000' },
                    { value: 'over-5m', label: 'Over ¬£5,000,000' }
                ],
                incomeBands: [
                    { value: 'under-25k', label: 'Under ¬£25,000' },
                    { value: '25k-50k', label: '¬£25,000 - ¬£50,000' },
                    { value: '50k-100k', label: '¬£50,000 - ¬£100,000' },
                    { value: '100k-200k', label: '¬£100,000 - ¬£200,000' },
                    { value: 'over-200k', label: 'Over ¬£200,000' }
                ],
                taxRates: [
                    { value: 'nil', label: 'Non-taxpayer' },
                    { value: 'basic', label: 'Basic Rate (20%)' },
                    { value: 'higher', label: 'Higher Rate (40%)' },
                    { value: 'additional', label: 'Additional Rate (45%)' }
                ],
                examplePlaceholder: 'Example: Proceeds from sale of property at 14 High Street, London in March 2024 for ¬£500,000. Now held in Barclays savings account.'
            },
            IE: {
                code: 'IE',
                currency: '‚Ç¨',
                currencyCode: 'EUR',
                netWorthBands: [
                    { value: 'under-100k', label: 'Under ‚Ç¨100,000' },
                    { value: '100k-300k', label: '‚Ç¨100,000 - ‚Ç¨300,000' },
                    { value: '300k-600k', label: '‚Ç¨300,000 - ‚Ç¨600,000' },
                    { value: '600k-1m', label: '‚Ç¨600,000 - ‚Ç¨1,000,000' },
                    { value: '1m-3m', label: '‚Ç¨1,000,000 - ‚Ç¨3,000,000' },
                    { value: 'over-3m', label: 'Over ‚Ç¨3,000,000' }
                ],
                incomeBands: [
                    { value: 'under-30k', label: 'Under ‚Ç¨30,000' },
                    { value: '30k-60k', label: '‚Ç¨30,000 - ‚Ç¨60,000' },
                    { value: '60k-120k', label: '‚Ç¨60,000 - ‚Ç¨120,000' },
                    { value: '120k-250k', label: '‚Ç¨120,000 - ‚Ç¨250,000' },
                    { value: 'over-250k', label: 'Over ‚Ç¨250,000' }
                ],
                taxRates: [
                    { value: 'standard', label: 'Standard Rate (20%)' },
                    { value: 'marginal', label: 'Marginal Rate (40%)' }
                ],
                examplePlaceholder: 'Example: Proceeds from sale of property at 14 Main Street, Dublin in March 2024 for ‚Ç¨500,000. Now held in AIB savings account.'
            }
        };
        
        const STORAGE_KEY = 'evelynFactFindFinancial';
        const TOTAL_SECTIONS = 4;
        
        let formData = {};
        let sectionStatus = {};
        let isJointApplication = false;
        let currentJurisdiction = 'UK';
        let saveTimeout = null;
        let wealthSourceCount = 1;
        let selectedFundSources = [];

        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            isJointApplication = urlParams.get('type') === 'joint';
            
            // Get jurisdiction from URL or localStorage
            const urlJurisdiction = urlParams.get('jurisdiction');
            if (urlJurisdiction && JURISDICTION_CONFIG[urlJurisdiction]) {
                currentJurisdiction = urlJurisdiction;
            } else {
                const storedJurisdiction = localStorage.getItem('evelynJurisdiction');
                if (storedJurisdiction && JURISDICTION_CONFIG[storedJurisdiction]) {
                    currentJurisdiction = storedJurisdiction;
                }
            }
            
            // Apply jurisdiction-specific UI updates
            applyJurisdictionConfig();
            
            if (isJointApplication) {
                document.getElementById('applicationTypeBadge').textContent = 'Joint Application';
                document.querySelectorAll('.applicant-toggle').forEach(el => el.style.display = 'flex');
            }

            loadSavedData();
            
            for (let i = 1; i <= TOTAL_SECTIONS; i++) {
                if (!sectionStatus[i]) sectionStatus[i] = 'pending';
                updateSectionUI(i);
            }
            updateProgress();
        });
        
        // =========================================
        // JURISDICTION HANDLING
        // =========================================
        function applyJurisdictionConfig() {
            const config = JURISDICTION_CONFIG[currentJurisdiction];
            
            // Update all currency symbols via data-currency attribute
            document.querySelectorAll('.currency-input').forEach(el => {
                el.setAttribute('data-currency', config.currency);
            });
            
            // Update total income display
            const totalIncomeDisplay = document.getElementById('totalIncomeDisplay');
            if (totalIncomeDisplay) {
                const currentValue = totalIncomeDisplay.textContent.replace(/[¬£‚Ç¨,]/g, '') || '0';
                totalIncomeDisplay.textContent = config.currency + parseInt(currentValue).toLocaleString();
            }
            
            // Update net worth dropdowns
            updateSelectOptions('totalNetWealth', config.netWorthBands);
            updateSelectOptions('totalNetWealth_customer2', config.netWorthBands);
            
            // Update tax rate options
            updateTaxRateOptions(config.taxRates);
            
            // Update example placeholder text
            const fundSourceDetails = document.getElementById('fundSourceDetails');
            if (fundSourceDetails) {
                fundSourceDetails.placeholder = config.examplePlaceholder;
            }
            
            // Store jurisdiction in form data
            formData.jurisdiction = currentJurisdiction;
            formData.currencyCode = config.currencyCode;
        }
        
        function updateTaxRateOptions(taxRates) {
            // Primary applicant tax rates
            const taxGroup = document.getElementById('taxRateOptions');
            if (taxGroup) {
                taxGroup.innerHTML = '';
                taxRates.forEach((rate, index) => {
                    const optionItem = document.createElement('div');
                    optionItem.className = 'option-item';
                    optionItem.innerHTML = `
                        <input type="radio" name="taxRate" id="tax${index}" value="${rate.value}" onchange="handleFieldChange('taxRate', '${rate.value}')">
                        <label for="tax${index}">${rate.label}</label>
                    `;
                    taxGroup.appendChild(optionItem);
                });
                
                // Restore previous selection if it exists
                if (formData.taxRate) {
                    const radio = document.querySelector(`input[name="taxRate"][value="${formData.taxRate}"]`);
                    if (radio) radio.checked = true;
                }
            }
        }
        
        function updateSelectOptions(selectId, options) {
            const select = document.getElementById(selectId);
            if (select) {
                const currentValue = select.value;
                select.innerHTML = '<option value="">Select range</option>';
                options.forEach(opt => {
                    const option = document.createElement('option');
                    option.value = opt.value;
                    option.textContent = opt.label;
                    select.appendChild(option);
                });
                // Restore previous selection if it exists
                if (currentValue) select.value = currentValue;
            }
        }

        function loadSavedData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const parsed = JSON.parse(saved);
                formData = parsed.formData || {};
                sectionStatus = parsed.sectionStatus || {};
                
                Object.keys(formData).forEach(key => {
                    const value = formData[key];
                    
                    // First, try to find element by ID
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = value === true || value === 'true' || value === 'on';
                        } else {
                            element.value = value;
                        }
                    }
                    
                    // Also check for radio buttons by name
                    const radios = document.querySelectorAll(`input[type="radio"][name="${key}"]`);
                    if (radios.length > 0) {
                        radios.forEach(radio => {
                            if (radio.value === value) {
                                radio.checked = true;
                            }
                        });
                    }
                });
                
                // Restore conditional sections
                restoreConditionalSections();

                updateSaveStatus('saved');
            }
        }
        
        // Restore visibility of conditional sections based on loaded data
        function restoreConditionalSections() {
            // Employment type conditional fields
            const empStatus = formData.employmentStatus;
            if (empStatus === 'employed' || empStatus === 'selfEmployed') {
                const empDetails = document.getElementById('employmentDetails');
                if (empDetails) empDetails.classList.add('visible');
            }
            if (empStatus === 'retired') {
                const retiredDetails = document.getElementById('retiredDetails');
                if (retiredDetails) retiredDetails.classList.add('visible');
            }
            
            // Source of wealth - other
            if (formData.sourceOfWealth === 'other') {
                const otherSection = document.getElementById('otherWealthSection');
                if (otherSection) otherSection.classList.add('visible');
            }
            
            // Source of funds - other
            if (formData.sourceOfFunds === 'other') {
                const otherSection = document.getElementById('otherFundsSection');
                if (otherSection) otherSection.classList.add('visible');
            }
        }

        function saveProgress() {
            const dataToSave = {
                formData: formData,
                sectionStatus: sectionStatus,
                lastSaved: new Date().toISOString()
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
            updateSaveStatus('saved');
        }

        function handleFieldChange(fieldName, value) {
            formData[fieldName] = value;
            updateSaveStatus('saving');
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => saveProgress(), 500);
        }

        function updateSaveStatus(status) {
            const icon = document.getElementById('saveStatusIcon');
            const text = document.getElementById('saveStatusText');
            icon.className = 'save-status-icon';
            if (status === 'saved') {
                icon.classList.add('saved');
                text.textContent = 'All changes saved';
            } else if (status === 'saving') {
                icon.classList.add('saving');
                text.textContent = 'Saving...';
            }
        }

        function clearForm() {
            if (confirm('Clear all data? This cannot be undone.')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        // Scroll to section with offset to account for sticky header
        function scrollToSectionWithOffset(element) {
            const header = document.querySelector('.header');
            const headerHeight = header ? header.offsetHeight : 0;
            const offset = headerHeight + 20;
            const elementPosition = element.getBoundingClientRect().top;
            const currentScrollPosition = window.pageYOffset;
            const targetPosition = currentScrollPosition + elementPosition - offset;
            window.scrollTo({ top: targetPosition, behavior: 'smooth' });
        }

        function toggleSection(sectionNum) {
            const section = document.getElementById(`section${sectionNum}`);
            const wasExpanded = section.classList.contains('expanded');
            document.querySelectorAll('.section-card').forEach(card => card.classList.remove('expanded'));
            if (!wasExpanded) {
                section.classList.add('expanded');
                setTimeout(() => scrollToSectionWithOffset(section), 100);
            }
        }

        function goToSection(sectionNum) { toggleSection(sectionNum); }

        function completeSection(sectionNum) {
            sectionStatus[sectionNum] = 'completed';
            updateSectionUI(sectionNum);
            saveProgress();
            if (sectionNum < TOTAL_SECTIONS) toggleSection(sectionNum + 1);
            updateProgress();
        }

        function updateSectionUI(sectionNum) {
            const section = document.getElementById(`section${sectionNum}`);
            const statusBadge = document.getElementById(`status${sectionNum}`);
            const progressStep = document.querySelector(`.progress-step[data-section="${sectionNum}"]`);
            
            section.classList.remove('completed');
            progressStep.classList.remove('completed', 'active');
            
            if (sectionStatus[sectionNum] === 'completed') {
                section.classList.add('completed');
                statusBadge.className = 'status-badge completed';
                statusBadge.textContent = 'Completed';
                progressStep.classList.add('completed');
            } else {
                statusBadge.className = 'status-badge pending';
                statusBadge.textContent = 'Not started';
            }
        }

        function updateProgress() {
            const completed = Object.values(sectionStatus).filter(s => s === 'completed').length;
            const percent = Math.round((completed / TOTAL_SECTIONS) * 100);
            document.getElementById('progressFill').style.width = `${percent}%`;
            document.getElementById('progressPercent').textContent = `${percent}% Complete`;
            document.getElementById('nextFormBtn').disabled = completed !== TOTAL_SECTIONS;
        }

        function switchApplicant(sectionNum, applicantNum) {
            const toggle = document.getElementById(`applicantToggle${sectionNum}`);
            toggle.querySelectorAll('.applicant-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i + 1 === applicantNum);
            });
            document.getElementById(`applicant1Form${sectionNum}`).classList.toggle('active', applicantNum === 1);
            document.getElementById(`applicant2Form${sectionNum}`).classList.toggle('active', applicantNum === 2);
        }

        function handleEmploymentChange(status) {
            handleFieldChange('employmentStatus', status);
            document.getElementById('employedSection').classList.toggle('visible', status === 'employed');
            document.getElementById('selfEmployedSection').classList.toggle('visible', status === 'self-employed');
            document.getElementById('retiredSection').classList.toggle('visible', status === 'retired');
        }

        function calculateTotalIncome() {
            const employment = parseFloat(document.getElementById('incomeEmployment').value) || 0;
            const pension = parseFloat(document.getElementById('incomePension').value) || 0;
            const investments = parseFloat(document.getElementById('incomeInvestments').value) || 0;
            const rental = parseFloat(document.getElementById('incomeRental').value) || 0;
            const other = parseFloat(document.getElementById('incomeOther').value) || 0;
            const total = employment + pension + investments + rental + other;
            const currencySymbol = JURISDICTION_CONFIG[currentJurisdiction].currency;
            document.getElementById('totalIncomeDisplay').textContent = currencySymbol + total.toLocaleString();
            handleFieldChange('totalIncome', total);
        }

        function handleWealthSourceChange(index) {
            const type = document.getElementById(`wealthSourceType${index}`).value;
            handleFieldChange(`wealthSourceType${index}`, type);
        }

        function addWealthSource() {
            wealthSourceCount++;
            const container = document.getElementById('wealthSources');
            const newCard = document.createElement('div');
            newCard.className = 'wealth-source-card';
            newCard.id = `wealthSource${wealthSourceCount}`;
            newCard.innerHTML = `
                <div class="wealth-source-header">
                    <span class="wealth-source-title">Source ${wealthSourceCount}</span>
                    <button class="btn-remove" onclick="removeWealthSource(${wealthSourceCount})">‚úï Remove</button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Source Type</label>
                        <select class="form-select" id="wealthSourceType${wealthSourceCount}" onchange="handleWealthSourceChange(${wealthSourceCount})">
                            <option value="">Select source</option>
                            <option value="salary">Salary/Employment Income</option>
                            <option value="self-employment">Self-Employment/Business</option>
                            <option value="inheritance">Inheritance</option>
                            <option value="property-sale">Sale of Property</option>
                            <option value="business-sale">Sale of Business</option>
                            <option value="investments">Investment Returns</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Approximate Value</label>
                        <div class="currency-input" data-currency="¬£">
                            <input type="number" class="form-input" id="wealthSourceValue${wealthSourceCount}" placeholder="0" style="padding-left: 28px;" onchange="handleFieldChange('wealthSourceValue${wealthSourceCount}', this.value)">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Details</label>
                    <textarea class="form-textarea" id="wealthSourceDetails${wealthSourceCount}" placeholder="Please provide details" onchange="handleFieldChange('wealthSourceDetails${wealthSourceCount}', this.value)"></textarea>
                </div>
            `;
            container.appendChild(newCard);
        }

        function removeWealthSource(index) {
            const card = document.getElementById(`wealthSource${index}`);
            if (card && wealthSourceCount > 1) {
                card.remove();
                handleFieldChange(`wealthSourceType${index}`, '');
                handleFieldChange(`wealthSourceValue${index}`, '');
                handleFieldChange(`wealthSourceDetails${index}`, '');
            }
        }

        function handleFundSourceChange(source, checked) {
            if (checked) {
                if (!selectedFundSources.includes(source)) selectedFundSources.push(source);
            } else {
                selectedFundSources = selectedFundSources.filter(s => s !== source);
            }
            handleFieldChange('fundSources', selectedFundSources.join(','));
        }

        function toggleOtherFundSource(show) {
            document.getElementById('otherFundSourceSection').classList.toggle('visible', show);
        }

        function proceedToNextForm() {
            saveProgress();
            const type = isJointApplication ? 'joint' : 'individual';
            window.location.href = `factfind_03_investment_suitability.html?type=${type}&jurisdiction=${currentJurisdiction}`;
        }

        function completeForm() {
            const masterData = JSON.parse(localStorage.getItem('evelynFactFindMaster') || '{}');
            masterData.financialProfile = { complete: true, timestamp: new Date().toISOString() };
            masterData.jurisdiction = currentJurisdiction;
            localStorage.setItem('evelynFactFindMaster', JSON.stringify(masterData));
        }
    </script>
</body>
</html>
