<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Source of Funds - Evelyn Partners</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .form-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .form-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .form-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .form-header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .form-content {
            padding: 40px;
        }

        .section {
            margin-bottom: 35px;
        }

        .section-title {
            font-size: 20px;
            color: #1e3c72;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .applicant-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-primary {
            background: #e3f2fd;
            color: #1976d2;
        }

        .badge-joint {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .info-box {
            background: #f0f7ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 4px;
        }

        .info-box p {
            color: #1565c0;
            font-size: 14px;
            line-height: 1.6;
        }

        .source-item {
            background: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .source-item-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .source-checkbox {
            width: 22px;
            height: 22px;
            cursor: pointer;
        }

        .source-label {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .source-fields {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
            gap: 15px;
        }

        .source-fields.active {
            display: grid;
            grid-template-columns: 1fr;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }

        .required {
            color: #d32f2f;
            margin-left: 3px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .form-group input.error,
        .form-group select.error,
        .form-group textarea.error {
            border-color: #d32f2f;
        }

        .error-message {
            color: #d32f2f;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .row-thirds {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .help-text {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .total-row {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 15px 20px;
            margin-top: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .total-label {
            font-size: 16px;
            font-weight: 600;
            color: #2e7d32;
        }

        .total-amount {
            font-size: 20px;
            font-weight: 700;
            color: #2e7d32;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }

        .btn {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #f5f5f5;
        }

        @media (max-width: 768px) {
            .form-content {
                padding: 25px;
            }

            .row,
            .row-thirds {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="form-header">
            <h1>Source of Funds Declaration</h1>
            <p>Anti-Money Laundering Compliance | Immediate Transaction Funding</p>
        </div>

        <div class="form-content">
            <form id="sourceOfFundsForm">
                
                <!-- Primary Applicant Section -->
                <div class="section">
                    <h2 class="section-title">
                        <span>üí∞</span>
                        <span>Source of Funds</span>
                        <span class="applicant-badge badge-primary">Primary Applicant</span>
                    </h2>

                    <div class="info-box">
                        <p><strong>Important:</strong> Please declare the immediate source from which the funds being invested will be drawn. This must specify where the money is currently held (e.g., "HSBC current account", "Fidelity ISA") and the original source of those funds (e.g., salary, inheritance, property sale). All sources must total the investment amount.</p>
                    </div>

                    <!-- Source 1: Current Account -->
                    <div class="source-item">
                        <div class="source-item-header">
                            <input type="checkbox" class="source-checkbox" id="source1_enabled" onchange="toggleSourceFields('source1')">
                            <label for="source1_enabled" class="source-label">Current/Savings Account</label>
                        </div>
                        <div class="source-fields" id="source1_fields">
                            <div class="form-group">
                                <label for="source1_original">Original Source of Funds <span class="required">*</span></label>
                                <select id="source1_original" name="source1_original">
                                    <option value="">Please select...</option>
                                    <option value="salary">Salary/Employment Income</option>
                                    <option value="business">Business Income</option>
                                    <option value="investment">Investment Returns</option>
                                    <option value="inheritance">Inheritance</option>
                                    <option value="gift">Gift</option>
                                    <option value="property_sale">Property Sale</option>
                                    <option value="business_sale">Business Sale</option>
                                    <option value="pension">Pension/Retirement Income</option>
                                    <option value="insurance">Insurance Policy Payout</option>
                                    <option value="compensation">Compensation/Settlement</option>
                                    <option value="other">Other (please specify)</option>
                                </select>
                                <span class="error-message">Please select the original source</span>
                            </div>

                            <div class="form-group">
                                <label for="source1_description">Where Currently Held <span class="required">*</span></label>
                                <input type="text" id="source1_description" name="source1_description" placeholder="e.g., Barclays Bank Current Account, Account No: ****1234">
                                <span class="error-message">Please specify where funds are currently held</span>
                            </div>

                            <div class="form-group">
                                <label for="source1_amount">Amount (¬£) <span class="required">*</span></label>
                                <input type="text" id="source1_amount" name="source1_amount" placeholder="0.00" oninput="formatCurrency(this); calculateTotal()">
                                <span class="error-message">Please enter a valid amount</span>
                            </div>

                            <div class="form-group">
                                <label for="source1_highrisk">
                                    <input type="checkbox" id="source1_highrisk" name="source1_highrisk" style="width: auto; margin-right: 8px;">
                                    These funds are associated with high-risk business activity
                                </label>
                                <p class="help-text">Check this box if the funds originate from or are connected to high-risk business sectors</p>
                            </div>
                        </div>
                    </div>

                    <!-- Source 2: Investment Account -->
                    <div class="source-item">
                        <div class="source-item-header">
                            <input type="checkbox" class="source-checkbox" id="source2_enabled" onchange="toggleSourceFields('source2')">
                            <label for="source2_enabled" class="source-label">Investment Account (ISA, GIA, etc.)</label>
                        </div>
                        <div class="source-fields" id="source2_fields">
                            <div class="form-group">
                                <label for="source2_original">Original Source of Funds <span class="required">*</span></label>
                                <select id="source2_original" name="source2_original">
                                    <option value="">Please select...</option>
                                    <option value="salary">Salary/Employment Income</option>
                                    <option value="business">Business Income</option>
                                    <option value="investment">Investment Returns</option>
                                    <option value="inheritance">Inheritance</option>
                                    <option value="gift">Gift</option>
                                    <option value="property_sale">Property Sale</option>
                                    <option value="business_sale">Business Sale</option>
                                    <option value="pension">Pension/Retirement Income</option>
                                    <option value="insurance">Insurance Policy Payout</option>
                                    <option value="compensation">Compensation/Settlement</option>
                                    <option value="other">Other (please specify)</option>
                                </select>
                                <span class="error-message">Please select the original source</span>
                            </div>

                            <div class="form-group">
                                <label for="source2_description">Where Currently Held <span class="required">*</span></label>
                                <input type="text" id="source2_description" name="source2_description" placeholder="e.g., Fidelity ISA, Account No: ****5678">
                                <span class="error-message">Please specify where funds are currently held</span>
                            </div>

                            <div class="form-group">
                                <label for="source2_amount">Amount (¬£) <span class="required">*</span></label>
                                <input type="text" id="source2_amount" name="source2_amount" placeholder="0.00" oninput="formatCurrency(this); calculateTotal()">
                                <span class="error-message">Please enter a valid amount</span>
                            </div>

                            <div class="form-group">
                                <label for="source2_highrisk">
                                    <input type="checkbox" id="source2_highrisk" name="source2_highrisk" style="width: auto; margin-right: 8px;">
                                    These funds are associated with high-risk business activity
                                </label>
                                <p class="help-text">Check this box if the funds originate from or are connected to high-risk business sectors</p>
                            </div>
                        </div>
                    </div>

                    <!-- Source 3: Pension -->
                    <div class="source-item">
                        <div class="source-item-header">
                            <input type="checkbox" class="source-checkbox" id="source3_enabled" onchange="toggleSourceFields('source3')">
                            <label for="source3_enabled" class="source-label">Pension/Retirement Account</label>
                        </div>
                        <div class="source-fields" id="source3_fields">
                            <div class="form-group">
                                <label for="source3_original">Original Source of Funds <span class="required">*</span></label>
                                <select id="source3_original" name="source3_original">
                                    <option value="">Please select...</option>
                                    <option value="salary">Salary/Employment Income</option>
                                    <option value="business">Business Income</option>
                                    <option value="investment">Investment Returns</option>
                                    <option value="inheritance">Inheritance</option>
                                    <option value="gift">Gift</option>
                                    <option value="property_sale">Property Sale</option>
                                    <option value="business_sale">Business Sale</option>
                                    <option value="pension">Pension/Retirement Income</option>
                                    <option value="insurance">Insurance Policy Payout</option>
                                    <option value="compensation">Compensation/Settlement</option>
                                    <option value="other">Other (please specify)</option>
                                </select>
                                <span class="error-message">Please select the original source</span>
                            </div>

                            <div class="form-group">
                                <label for="source3_description">Where Currently Held <span class="required">*</span></label>
                                <input type="text" id="source3_description" name="source3_description" placeholder="e.g., Aviva Pension Plan, Policy No: ****9012">
                                <span class="error-message">Please specify where funds are currently held</span>
                            </div>

                            <div class="form-group">
                                <label for="source3_amount">Amount (¬£) <span class="required">*</span></label>
                                <input type="text" id="source3_amount" name="source3_amount" placeholder="0.00" oninput="formatCurrency(this); calculateTotal()">
                                <span class="error-message">Please enter a valid amount</span>
                            </div>

                            <div class="form-group">
                                <label for="source3_highrisk">
                                    <input type="checkbox" id="source3_highrisk" name="source3_highrisk" style="width: auto; margin-right: 8px;">
                                    These funds are associated with high-risk business activity
                                </label>
                                <p class="help-text">Check this box if the funds originate from or are connected to high-risk business sectors</p>
                            </div>
                        </div>
                    </div>

                    <!-- Source 4: Other -->
                    <div class="source-item">
                        <div class="source-item-header">
                            <input type="checkbox" class="source-checkbox" id="source4_enabled" onchange="toggleSourceFields('source4')">
                            <label for="source4_enabled" class="source-label">Other Source</label>
                        </div>
                        <div class="source-fields" id="source4_fields">
                            <div class="form-group">
                                <label for="source4_original">Original Source of Funds <span class="required">*</span></label>
                                <select id="source4_original" name="source4_original">
                                    <option value="">Please select...</option>
                                    <option value="salary">Salary/Employment Income</option>
                                    <option value="business">Business Income</option>
                                    <option value="investment">Investment Returns</option>
                                    <option value="inheritance">Inheritance</option>
                                    <option value="gift">Gift</option>
                                    <option value="property_sale">Property Sale</option>
                                    <option value="business_sale">Business Sale</option>
                                    <option value="pension">Pension/Retirement Income</option>
                                    <option value="insurance">Insurance Policy Payout</option>
                                    <option value="compensation">Compensation/Settlement</option>
                                    <option value="other">Other (please specify)</option>
                                </select>
                                <span class="error-message">Please select the original source</span>
                            </div>

                            <div class="form-group">
                                <label for="source4_description">Where Currently Held <span class="required">*</span></label>
                                <input type="text" id="source4_description" name="source4_description" placeholder="e.g., Building Society Account, Premium Bonds, etc.">
                                <span class="error-message">Please specify where funds are currently held</span>
                            </div>

                            <div class="form-group">
                                <label for="source4_amount">Amount (¬£) <span class="required">*</span></label>
                                <input type="text" id="source4_amount" name="source4_amount" placeholder="0.00" oninput="formatCurrency(this); calculateTotal()">
                                <span class="error-message">Please enter a valid amount</span>
                            </div>

                            <div class="form-group">
                                <label for="source4_highrisk">
                                    <input type="checkbox" id="source4_highrisk" name="source4_highrisk" style="width: auto; margin-right: 8px;">
                                    These funds are associated with high-risk business activity
                                </label>
                                <p class="help-text">Check this box if the funds originate from or are connected to high-risk business sectors</p>
                            </div>
                        </div>
                    </div>

                    <!-- Total Row -->
                    <div class="total-row">
                        <span class="total-label">Total Source of Funds Declared:</span>
                        <span class="total-amount" id="total_amount">¬£0.00</span>
                    </div>
                </div>

                <!-- Joint Applicant Section -->
                <div class="section" id="jointSection" style="display: none;">
                    <h2 class="section-title">
                        <span>üí∞</span>
                        <span>Source of Funds</span>
                        <span class="applicant-badge badge-joint">Joint Applicant</span>
                    </h2>

                    <div class="info-box">
                        <p><strong>Important:</strong> Please declare the immediate source from which the funds being invested will be drawn. This must specify where the money is currently held and the original source of those funds. All sources must total the investment amount.</p>
                    </div>

                    <!-- Source 1: Current Account - Customer 2 -->
                    <div class="source-item">
                        <div class="source-item-header">
                            <input type="checkbox" class="source-checkbox" id="source1_enabled_customer2" onchange="toggleSourceFields('source1_customer2')">
                            <label for="source1_enabled_customer2" class="source-label">Current/Savings Account</label>
                        </div>
                        <div class="source-fields" id="source1_customer2_fields">
                            <div class="form-group">
                                <label for="source1_original_customer2">Original Source of Funds <span class="required">*</span></label>
                                <select id="source1_original_customer2" name="source1_original_customer2">
                                    <option value="">Please select...</option>
                                    <option value="salary">Salary/Employment Income</option>
                                    <option value="business">Business Income</option>
                                    <option value="investment">Investment Returns</option>
                                    <option value="inheritance">Inheritance</option>
                                    <option value="gift">Gift</option>
                                    <option value="property_sale">Property Sale</option>
                                    <option value="business_sale">Business Sale</option>
                                    <option value="pension">Pension/Retirement Income</option>
                                    <option value="insurance">Insurance Policy Payout</option>
                                    <option value="compensation">Compensation/Settlement</option>
                                    <option value="other">Other (please specify)</option>
                                </select>
                                <span class="error-message">Please select the original source</span>
                            </div>

                            <div class="form-group">
                                <label for="source1_description_customer2">Where Currently Held <span class="required">*</span></label>
                                <input type="text" id="source1_description_customer2" name="source1_description_customer2" placeholder="e.g., Barclays Bank Current Account, Account No: ****1234">
                                <span class="error-message">Please specify where funds are currently held</span>
                            </div>

                            <div class="form-group">
                                <label for="source1_amount_customer2">Amount (¬£) <span class="required">*</span></label>
                                <input type="text" id="source1_amount_customer2" name="source1_amount_customer2" placeholder="0.00" oninput="formatCurrency(this); calculateTotalCustomer2()">
                                <span class="error-message">Please enter a valid amount</span>
                            </div>

                            <div class="form-group">
                                <label for="source1_highrisk_customer2">
                                    <input type="checkbox" id="source1_highrisk_customer2" name="source1_highrisk_customer2" style="width: auto; margin-right: 8px;">
                                    These funds are associated with high-risk business activity
                                </label>
                                <p class="help-text">Check this box if the funds originate from or are connected to high-risk business sectors</p>
                            </div>
                        </div>
                    </div>

                    <!-- Source 2: Investment Account - Customer 2 -->
                    <div class="source-item">
                        <div class="source-item-header">
                            <input type="checkbox" class="source-checkbox" id="source2_enabled_customer2" onchange="toggleSourceFields('source2_customer2')">
                            <label for="source2_enabled_customer2" class="source-label">Investment Account (ISA, GIA, etc.)</label>
                        </div>
                        <div class="source-fields" id="source2_customer2_fields">
                            <div class="form-group">
                                <label for="source2_original_customer2">Original Source of Funds <span class="required">*</span></label>
                                <select id="source2_original_customer2" name="source2_original_customer2">
                                    <option value="">Please select...</option>
                                    <option value="salary">Salary/Employment Income</option>
                                    <option value="business">Business Income</option>
                                    <option value="investment">Investment Returns</option>
                                    <option value="inheritance">Inheritance</option>
                                    <option value="gift">Gift</option>
                                    <option value="property_sale">Property Sale</option>
                                    <option value="business_sale">Business Sale</option>
                                    <option value="pension">Pension/Retirement Income</option>
                                    <option value="insurance">Insurance Policy Payout</option>
                                    <option value="compensation">Compensation/Settlement</option>
                                    <option value="other">Other (please specify)</option>
                                </select>
                                <span class="error-message">Please select the original source</span>
                            </div>

                            <div class="form-group">
                                <label for="source2_description_customer2">Where Currently Held <span class="required">*</span></label>
                                <input type="text" id="source2_description_customer2" name="source2_description_customer2" placeholder="e.g., Fidelity ISA, Account No: ****5678">
                                <span class="error-message">Please specify where funds are currently held</span>
                            </div>

                            <div class="form-group">
                                <label for="source2_amount_customer2">Amount (¬£) <span class="required">*</span></label>
                                <input type="text" id="source2_amount_customer2" name="source2_amount_customer2" placeholder="0.00" oninput="formatCurrency(this); calculateTotalCustomer2()">
                                <span class="error-message">Please enter a valid amount</span>
                            </div>

                            <div class="form-group">
                                <label for="source2_highrisk_customer2">
                                    <input type="checkbox" id="source2_highrisk_customer2" name="source2_highrisk_customer2" style="width: auto; margin-right: 8px;">
                                    These funds are associated with high-risk business activity
                                </label>
                                <p class="help-text">Check this box if the funds originate from or are connected to high-risk business sectors</p>
                            </div>
                        </div>
                    </div>

                    <!-- Source 3: Pension - Customer 2 -->
                    <div class="source-item">
                        <div class="source-item-header">
                            <input type="checkbox" class="source-checkbox" id="source3_enabled_customer2" onchange="toggleSourceFields('source3_customer2')">
                            <label for="source3_enabled_customer2" class="source-label">Pension/Retirement Account</label>
                        </div>
                        <div class="source-fields" id="source3_customer2_fields">
                            <div class="form-group">
                                <label for="source3_original_customer2">Original Source of Funds <span class="required">*</span></label>
                                <select id="source3_original_customer2" name="source3_original_customer2">
                                    <option value="">Please select...</option>
                                    <option value="salary">Salary/Employment Income</option>
                                    <option value="business">Business Income</option>
                                    <option value="investment">Investment Returns</option>
                                    <option value="inheritance">Inheritance</option>
                                    <option value="gift">Gift</option>
                                    <option value="property_sale">Property Sale</option>
                                    <option value="business_sale">Business Sale</option>
                                    <option value="pension">Pension/Retirement Income</option>
                                    <option value="insurance">Insurance Policy Payout</option>
                                    <option value="compensation">Compensation/Settlement</option>
                                    <option value="other">Other (please specify)</option>
                                </select>
                                <span class="error-message">Please select the original source</span>
                            </div>

                            <div class="form-group">
                                <label for="source3_description_customer2">Where Currently Held <span class="required">*</span></label>
                                <input type="text" id="source3_description_customer2" name="source3_description_customer2" placeholder="e.g., Aviva Pension Plan, Policy No: ****9012">
                                <span class="error-message">Please specify where funds are currently held</span>
                            </div>

                            <div class="form-group">
                                <label for="source3_amount_customer2">Amount (¬£) <span class="required">*</span></label>
                                <input type="text" id="source3_amount_customer2" name="source3_amount_customer2" placeholder="0.00" oninput="formatCurrency(this); calculateTotalCustomer2()">
                                <span class="error-message">Please enter a valid amount</span>
                            </div>

                            <div class="form-group">
                                <label for="source3_highrisk_customer2">
                                    <input type="checkbox" id="source3_highrisk_customer2" name="source3_highrisk_customer2" style="width: auto; margin-right: 8px;">
                                    These funds are associated with high-risk business activity
                                </label>
                                <p class="help-text">Check this box if the funds originate from or are connected to high-risk business sectors</p>
                            </div>
                        </div>
                    </div>

                    <!-- Source 4: Other - Customer 2 -->
                    <div class="source-item">
                        <div class="source-item-header">
                            <input type="checkbox" class="source-checkbox" id="source4_enabled_customer2" onchange="toggleSourceFields('source4_customer2')">
                            <label for="source4_enabled_customer2" class="source-label">Other Source</label>
                        </div>
                        <div class="source-fields" id="source4_customer2_fields">
                            <div class="form-group">
                                <label for="source4_original_customer2">Original Source of Funds <span class="required">*</span></label>
                                <select id="source4_original_customer2" name="source4_original_customer2">
                                    <option value="">Please select...</option>
                                    <option value="salary">Salary/Employment Income</option>
                                    <option value="business">Business Income</option>
                                    <option value="investment">Investment Returns</option>
                                    <option value="inheritance">Inheritance</option>
                                    <option value="gift">Gift</option>
                                    <option value="property_sale">Property Sale</option>
                                    <option value="business_sale">Business Sale</option>
                                    <option value="pension">Pension/Retirement Income</option>
                                    <option value="insurance">Insurance Policy Payout</option>
                                    <option value="compensation">Compensation/Settlement</option>
                                    <option value="other">Other (please specify)</option>
                                </select>
                                <span class="error-message">Please select the original source</span>
                            </div>

                            <div class="form-group">
                                <label for="source4_description_customer2">Where Currently Held <span class="required">*</span></label>
                                <input type="text" id="source4_description_customer2" name="source4_description_customer2" placeholder="e.g., Building Society Account, Premium Bonds, etc.">
                                <span class="error-message">Please specify where funds are currently held</span>
                            </div>

                            <div class="form-group">
                                <label for="source4_amount_customer2">Amount (¬£) <span class="required">*</span></label>
                                <input type="text" id="source4_amount_customer2" name="source4_amount_customer2" placeholder="0.00" oninput="formatCurrency(this); calculateTotalCustomer2()">
                                <span class="error-message">Please enter a valid amount</span>
                            </div>

                            <div class="form-group">
                                <label for="source4_highrisk_customer2">
                                    <input type="checkbox" id="source4_highrisk_customer2" name="source4_highrisk_customer2" style="width: auto; margin-right: 8px;">
                                    These funds are associated with high-risk business activity
                                </label>
                                <p class="help-text">Check this box if the funds originate from or are connected to high-risk business sectors</p>
                            </div>
                        </div>
                    </div>

                    <!-- Total Row Customer 2 -->
                    <div class="total-row">
                        <span class="total-label">Total Source of Funds Declared:</span>
                        <span class="total-amount" id="total_amount_customer2">¬£0.00</span>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-secondary" onclick="window.history.back()">‚Üê Previous</button>
                    <button type="submit" class="btn btn-primary">Save & Continue ‚Üí</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Check URL parameters for joint application
        const urlParams = new URLSearchParams(window.location.search);
        const isJoint = urlParams.get('joint') === 'true';

        if (isJoint) {
            document.getElementById('jointSection').style.display = 'block';
        }

        // Toggle source fields visibility
        function toggleSourceFields(sourceId) {
            const checkbox = document.getElementById(sourceId + '_enabled');
            const fields = document.getElementById(sourceId + '_fields');
            
            if (checkbox.checked) {
                fields.classList.add('active');
                // Make fields required
                const inputs = fields.querySelectorAll('input[type="text"], select');
                inputs.forEach(input => {
                    if (!input.id.includes('highrisk')) {
                        input.setAttribute('required', 'required');
                    }
                });
            } else {
                fields.classList.remove('active');
                // Remove required attribute and clear values
                const inputs = fields.querySelectorAll('input, select');
                inputs.forEach(input => {
                    input.removeAttribute('required');
                    if (input.type === 'checkbox') {
                        input.checked = false;
                    } else {
                        input.value = '';
                    }
                    input.classList.remove('error');
                    const errorMsg = input.parentElement.querySelector('.error-message');
                    if (errorMsg) errorMsg.classList.remove('show');
                });
                
                // Recalculate totals
                if (sourceId.includes('customer2')) {
                    calculateTotalCustomer2();
                } else {
                    calculateTotal();
                }
            }
        }

        // Format currency input
        function formatCurrency(input) {
            let value = input.value.replace(/[^\d.]/g, '');
            
            // Allow only one decimal point
            const parts = value.split('.');
            if (parts.length > 2) {
                value = parts[0] + '.' + parts.slice(1).join('');
            }
            
            // Limit to 2 decimal places
            if (parts.length === 2 && parts[1].length > 2) {
                value = parts[0] + '.' + parts[1].substring(0, 2);
            }
            
            input.value = value;
        }

        // Calculate total for primary applicant
        function calculateTotal() {
            let total = 0;
            
            for (let i = 1; i <= 4; i++) {
                const checkbox = document.getElementById('source' + i + '_enabled');
                if (checkbox && checkbox.checked) {
                    const amountField = document.getElementById('source' + i + '_amount');
                    if (amountField && amountField.value) {
                        const amount = parseFloat(amountField.value.replace(/[^\d.]/g, ''));
                        if (!isNaN(amount)) {
                            total += amount;
                        }
                    }
                }
            }
            
            document.getElementById('total_amount').textContent = '¬£' + total.toLocaleString('en-GB', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        // Calculate total for joint applicant
        function calculateTotalCustomer2() {
            let total = 0;
            
            for (let i = 1; i <= 4; i++) {
                const checkbox = document.getElementById('source' + i + '_enabled_customer2');
                if (checkbox && checkbox.checked) {
                    const amountField = document.getElementById('source' + i + '_amount_customer2');
                    if (amountField && amountField.value) {
                        const amount = parseFloat(amountField.value.replace(/[^\d.]/g, ''));
                        if (!isNaN(amount)) {
                            total += amount;
                        }
                    }
                }
            }
            
            document.getElementById('total_amount_customer2').textContent = '¬£' + total.toLocaleString('en-GB', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        // Form validation
        document.getElementById('sourceOfFundsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            let isValid = true;
            let hasAtLeastOneSource = false;
            
            // Validate primary applicant
            for (let i = 1; i <= 4; i++) {
                const checkbox = document.getElementById('source' + i + '_enabled');
                if (checkbox && checkbox.checked) {
                    hasAtLeastOneSource = true;
                    
                    // Validate original source
                    const originalField = document.getElementById('source' + i + '_original');
                    if (!originalField.value) {
                        originalField.classList.add('error');
                        originalField.parentElement.querySelector('.error-message').classList.add('show');
                        isValid = false;
                    } else {
                        originalField.classList.remove('error');
                        originalField.parentElement.querySelector('.error-message').classList.remove('show');
                    }
                    
                    // Validate description
                    const descField = document.getElementById('source' + i + '_description');
                    if (!descField.value.trim()) {
                        descField.classList.add('error');
                        descField.parentElement.querySelector('.error-message').classList.add('show');
                        isValid = false;
                    } else {
                        descField.classList.remove('error');
                        descField.parentElement.querySelector('.error-message').classList.remove('show');
                    }
                    
                    // Validate amount
                    const amountField = document.getElementById('source' + i + '_amount');
                    const amount = parseFloat(amountField.value.replace(/[^\d.]/g, ''));
                    if (!amountField.value || isNaN(amount) || amount <= 0) {
                        amountField.classList.add('error');
                        amountField.parentElement.querySelector('.error-message').classList.add('show');
                        isValid = false;
                    } else {
                        amountField.classList.remove('error');
                        amountField.parentElement.querySelector('.error-message').classList.remove('show');
                    }
                }
            }
            
            // Check if at least one source is declared
            if (!hasAtLeastOneSource) {
                alert('Please declare at least one source of funds.');
                isValid = false;
            }
            
            // Validate joint applicant if applicable
            if (isJoint) {
                let hasJointSource = false;
                for (let i = 1; i <= 4; i++) {
                    const checkbox = document.getElementById('source' + i + '_enabled_customer2');
                    if (checkbox && checkbox.checked) {
                        hasJointSource = true;
                        
                        const originalField = document.getElementById('source' + i + '_original_customer2');
                        if (!originalField.value) {
                            originalField.classList.add('error');
                            originalField.parentElement.querySelector('.error-message').classList.add('show');
                            isValid = false;
                        } else {
                            originalField.classList.remove('error');
                            originalField.parentElement.querySelector('.error-message').classList.remove('show');
                        }
                        
                        const descField = document.getElementById('source' + i + '_description_customer2');
                        if (!descField.value.trim()) {
                            descField.classList.add('error');
                            descField.parentElement.querySelector('.error-message').classList.add('show');
                            isValid = false;
                        } else {
                            descField.classList.remove('error');
                            descField.parentElement.querySelector('.error-message').classList.remove('show');
                        }
                        
                        const amountField = document.getElementById('source' + i + '_amount_customer2');
                        const amount = parseFloat(amountField.value.replace(/[^\d.]/g, ''));
                        if (!amountField.value || isNaN(amount) || amount <= 0) {
                            amountField.classList.add('error');
                            amountField.parentElement.querySelector('.error-message').classList.add('show');
                            isValid = false;
                        } else {
                            amountField.classList.remove('error');
                            amountField.parentElement.querySelector('.error-message').classList.remove('show');
                        }
                    }
                }
                
                if (!hasJointSource) {
                    alert('Please declare at least one source of funds for the joint applicant.');
                    isValid = false;
                }
            }
            
            if (isValid) {
                alert('Form validated successfully! Data would be submitted here.');
                // In production, this would submit to your backend
                console.log('Form data:', new FormData(this));
            } else {
                alert('Please correct the errors highlighted in red.');
            }
        });

        // Auto-populate from URL parameters (for n8n integration)
        window.addEventListener('DOMContentLoaded', function() {
            // Example: ?source1_original=salary&source1_description=HSBC Current Account
            const params = new URLSearchParams(window.location.search);
            
            params.forEach((value, key) => {
                const field = document.getElementById(key);
                if (field) {
                    field.value = decodeURIComponent(value);
                    
                    // If it's a source field, enable the checkbox
                    if (key.includes('source') && key.includes('_')) {
                        const sourceNum = key.match(/source(\d+)/)[1];
                        const customer = key.includes('customer2') ? '_customer2' : '';
                        const checkbox = document.getElementById('source' + sourceNum + '_enabled' + customer);
                        if (checkbox) {
                            checkbox.checked = true;
                            toggleSourceFields('source' + sourceNum + customer);
                        }
                    }
                }
            });
            
            // Recalculate totals after auto-population
            calculateTotal();
            if (isJoint) {
                calculateTotalCustomer2();
            }
        });
    </script>
</body>
</html>
