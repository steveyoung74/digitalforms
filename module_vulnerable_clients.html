<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vulnerable Clients Assessment - Evelyn Partners</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }

        .form-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #00857d;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: #00857d;
            margin-bottom: 10px;
        }

        h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        .customer-section {
            margin-bottom: 40px;
            padding: 30px;
            background-color: #f9f9f9;
            border-radius: 6px;
            border-left: 4px solid #00857d;
        }

        .customer-section h2 {
            color: #00857d;
            font-size: 20px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .customer-badge {
            display: inline-block;
            background-color: #00857d;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .info-box {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 4px;
        }

        .info-box p {
            color: #856404;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .info-box p:last-child {
            margin-bottom: 0;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            font-size: 15px;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .checkbox-option {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .checkbox-option:hover {
            border-color: #00857d;
            background-color: #f0faf9;
        }

        .checkbox-option input[type="checkbox"] {
            margin-right: 12px;
            margin-top: 3px;
            cursor: pointer;
            accent-color: #00857d;
        }

        .checkbox-option label {
            cursor: pointer;
            flex: 1;
            font-size: 14px;
            color: #333;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            min-height: 100px;
            transition: border-color 0.2s;
        }

        textarea:focus {
            outline: none;
            border-color: #00857d;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            font-weight: normal;
            cursor: pointer;
        }

        .radio-group input[type="radio"] {
            margin-right: 8px;
            cursor: pointer;
            accent-color: #00857d;
        }

        .error-message {
            color: #d32f2f;
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }

        button {
            flex: 1;
            padding: 14px 28px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background-color: #00857d;
            color: white;
        }

        .btn-primary:hover {
            background-color: #006d66;
        }

        .btn-secondary {
            background-color: white;
            color: #00857d;
            border: 2px solid #00857d;
        }

        .btn-secondary:hover {
            background-color: #f0faf9;
        }

        .details-section {
            margin-top: 15px;
            padding: 15px;
            background-color: #f0faf9;
            border-radius: 6px;
            display: none;
        }

        .details-section.active {
            display: block;
        }

        @media (max-width: 768px) {
            .form-container {
                padding: 20px;
            }

            .customer-section {
                padding: 20px;
            }

            .button-group {
                flex-direction: column;
            }

            .radio-group {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="header">
            <div class="logo">EVELYN PARTNERS</div>
            <h1>Vulnerable Clients Assessment</h1>
            <p class="subtitle">Understanding Your Circumstances</p>
        </div>

        <form id="vulnerableClientsForm">
            <!-- Customer 1 Section -->
            <div class="customer-section" id="customer1Section">
                <h2>
                    Vulnerable Clients Assessment
                    <span class="customer-badge">Primary Applicant</span>
                </h2>

                <div class="info-box">
                    <p><strong>What is a vulnerable client?</strong></p>
                    <p>A vulnerable client is someone who, due to their personal circumstances, is especially susceptible to harm, particularly when a firm is not acting with appropriate levels of care.</p>
                    <p>Vulnerability can be caused by health, life events, resilience, or capability issues. This information helps us provide appropriate support and communication.</p>
                </div>

                <!-- Question 1: Health -->
                <div class="form-group">
                    <label>Do any of the following health conditions apply to you?</label>
                    <div class="checkbox-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="health_none" name="health_conditions" value="none">
                            <label for="health_none">None of these apply</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="health_physical" name="health_conditions" value="physical_disability">
                            <label for="health_physical">Physical disability or mobility issues</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="health_hearing" name="health_conditions" value="hearing_visual">
                            <label for="health_hearing">Hearing or visual impairment</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="health_mental" name="health_conditions" value="mental_health">
                            <label for="health_mental">Mental health condition</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="health_learning" name="health_conditions" value="learning_difficulty">
                            <label for="health_learning">Learning difficulty</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="health_serious" name="health_conditions" value="serious_illness">
                            <label for="health_serious">Serious or long-term illness</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="health_cognitive" name="health_conditions" value="cognitive_decline">
                            <label for="health_cognitive">Memory problems or cognitive decline</label>
                        </div>
                    </div>
                    <div class="details-section" id="healthDetails">
                        <label for="health_details_text">Please provide any additional details that would help us support you better:</label>
                        <textarea id="health_details_text" name="health_details"></textarea>
                    </div>
                </div>

                <!-- Question 2: Life Events -->
                <div class="form-group">
                    <label>Are you currently experiencing any of the following life events?</label>
                    <div class="checkbox-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="life_none" name="life_events" value="none">
                            <label for="life_none">None of these apply</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="life_bereavement" name="life_events" value="bereavement">
                            <label for="life_bereavement">Recent bereavement</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="life_divorce" name="life_events" value="divorce">
                            <label for="life_divorce">Divorce or relationship breakdown</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="life_job" name="life_events" value="job_loss">
                            <label for="life_job">Job loss or income reduction</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="life_financial" name="life_events" value="financial_difficulty">
                            <label for="life_financial">Financial difficulty or debt problems</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="life_caring" name="life_events" value="caring_responsibilities">
                            <label for="life_caring">New caring responsibilities</label>
                        </div>
                    </div>
                    <div class="details-section" id="lifeDetails">
                        <label for="life_details_text">Please provide any additional details:</label>
                        <textarea id="life_details_text" name="life_details"></textarea>
                    </div>
                </div>

                <!-- Question 3: Capability -->
                <div class="form-group">
                    <label>Do you have difficulty with any of the following?</label>
                    <div class="checkbox-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="capability_none" name="capability_issues" value="none">
                            <label for="capability_none">None of these apply</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="capability_english" name="capability_issues" value="english_language">
                            <label for="capability_english">English is not my first language</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="capability_literacy" name="capability_issues" value="literacy">
                            <label for="capability_literacy">Reading or writing</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="capability_numeracy" name="capability_issues" value="numeracy">
                            <label for="capability_numeracy">Understanding numbers or calculations</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="capability_financial" name="capability_issues" value="financial_understanding">
                            <label for="capability_financial">Understanding financial matters</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="capability_digital" name="capability_issues" value="digital_skills">
                            <label for="capability_digital">Using computers or online services</label>
                        </div>
                    </div>
                    <div class="details-section" id="capabilityDetails">
                        <label for="capability_details_text">Please provide any additional details:</label>
                        <textarea id="capability_details_text" name="capability_details"></textarea>
                    </div>
                </div>

                <!-- Question 4: Communication Preferences -->
                <div class="form-group">
                    <label>How can we best communicate with you?</label>
                    <div class="checkbox-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="comm_large_print" name="communication_preferences" value="large_print">
                            <label for="comm_large_print">Large print documents</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="comm_braille" name="communication_preferences" value="braille">
                            <label for="comm_braille">Braille</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="comm_audio" name="communication_preferences" value="audio">
                            <label for="comm_audio">Audio format</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="comm_simple" name="communication_preferences" value="simple_language">
                            <label for="comm_simple">Simple, clear language</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="comm_extra_time" name="communication_preferences" value="extra_time">
                            <label for="comm_extra_time">Extra time to understand information</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="comm_third_party" name="communication_preferences" value="third_party">
                            <label for="comm_third_party">Include a third party in communications</label>
                        </div>
                    </div>
                    <div class="details-section" id="commDetails">
                        <label for="comm_details_text">Please provide any additional details or preferences:</label>
                        <textarea id="comm_details_text" name="communication_details"></textarea>
                    </div>
                </div>

                <!-- Question 5: Third Party Support -->
                <div class="form-group">
                    <label>Would you like to nominate someone to receive copies of correspondence or help you manage your account?</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="third_party_support" value="yes" required>
                            Yes
                        </label>
                        <label>
                            <input type="radio" name="third_party_support" value="no">
                            No
                        </label>
                    </div>
                    <div class="details-section" id="thirdPartyDetails">
                        <label for="third_party_name">Third Party Name:</label>
                        <input type="text" id="third_party_name" name="third_party_name" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; margin-bottom: 15px;">
                        
                        <label for="third_party_relationship">Relationship to you:</label>
                        <input type="text" id="third_party_relationship" name="third_party_relationship" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; margin-bottom: 15px;">
                        
                        <label for="third_party_contact">Contact Details:</label>
                        <textarea id="third_party_contact" name="third_party_contact" style="min-height: 60px;"></textarea>
                    </div>
                    <span class="error-message">Please select an option</span>
                </div>
            </div>

            <!-- Customer 2 Section (Hidden by default) -->
            <div class="customer-section" id="customer2Section" style="display: none;">
                <h2>
                    Vulnerable Clients Assessment
                    <span class="customer-badge" style="background-color: #005f5a;">Joint Applicant</span>
                </h2>

                <div class="info-box">
                    <p><strong>What is a vulnerable client?</strong></p>
                    <p>A vulnerable client is someone who, due to their personal circumstances, is especially susceptible to harm, particularly when a firm is not acting with appropriate levels of care.</p>
                    <p>Vulnerability can be caused by health, life events, resilience, or capability issues. This information helps us provide appropriate support and communication.</p>
                </div>

                <!-- Question 1: Health -->
                <div class="form-group">
                    <label>Do any of the following health conditions apply to you?</label>
                    <div class="checkbox-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="health_none_customer2" name="health_conditions_customer2" value="none">
                            <label for="health_none_customer2">None of these apply</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="health_physical_customer2" name="health_conditions_customer2" value="physical_disability">
                            <label for="health_physical_customer2">Physical disability or mobility issues</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="health_hearing_customer2" name="health_conditions_customer2" value="hearing_visual">
                            <label for="health_hearing_customer2">Hearing or visual impairment</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="health_mental_customer2" name="health_conditions_customer2" value="mental_health">
                            <label for="health_mental_customer2">Mental health condition</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="health_learning_customer2" name="health_conditions_customer2" value="learning_difficulty">
                            <label for="health_learning_customer2">Learning difficulty</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="health_serious_customer2" name="health_conditions_customer2" value="serious_illness">
                            <label for="health_serious_customer2">Serious or long-term illness</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="health_cognitive_customer2" name="health_conditions_customer2" value="cognitive_decline">
                            <label for="health_cognitive_customer2">Memory problems or cognitive decline</label>
                        </div>
                    </div>
                    <div class="details-section" id="healthDetailsCustomer2">
                        <label for="health_details_text_customer2">Please provide any additional details that would help us support you better:</label>
                        <textarea id="health_details_text_customer2" name="health_details_customer2"></textarea>
                    </div>
                </div>

                <!-- Question 2: Life Events -->
                <div class="form-group">
                    <label>Are you currently experiencing any of the following life events?</label>
                    <div class="checkbox-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="life_none_customer2" name="life_events_customer2" value="none">
                            <label for="life_none_customer2">None of these apply</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="life_bereavement_customer2" name="life_events_customer2" value="bereavement">
                            <label for="life_bereavement_customer2">Recent bereavement</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="life_divorce_customer2" name="life_events_customer2" value="divorce">
                            <label for="life_divorce_customer2">Divorce or relationship breakdown</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="life_job_customer2" name="life_events_customer2" value="job_loss">
                            <label for="life_job_customer2">Job loss or income reduction</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="life_financial_customer2" name="life_events_customer2" value="financial_difficulty">
                            <label for="life_financial_customer2">Financial difficulty or debt problems</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="life_caring_customer2" name="life_events_customer2" value="caring_responsibilities">
                            <label for="life_caring_customer2">New caring responsibilities</label>
                        </div>
                    </div>
                    <div class="details-section" id="lifeDetailsCustomer2">
                        <label for="life_details_text_customer2">Please provide any additional details:</label>
                        <textarea id="life_details_text_customer2" name="life_details_customer2"></textarea>
                    </div>
                </div>

                <!-- Question 3: Capability -->
                <div class="form-group">
                    <label>Do you have difficulty with any of the following?</label>
                    <div class="checkbox-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="capability_none_customer2" name="capability_issues_customer2" value="none">
                            <label for="capability_none_customer2">None of these apply</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="capability_english_customer2" name="capability_issues_customer2" value="english_language">
                            <label for="capability_english_customer2">English is not my first language</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="capability_literacy_customer2" name="capability_issues_customer2" value="literacy">
                            <label for="capability_literacy_customer2">Reading or writing</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="capability_numeracy_customer2" name="capability_issues_customer2" value="numeracy">
                            <label for="capability_numeracy_customer2">Understanding numbers or calculations</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="capability_financial_customer2" name="capability_issues_customer2" value="financial_understanding">
                            <label for="capability_financial_customer2">Understanding financial matters</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="capability_digital_customer2" name="capability_issues_customer2" value="digital_skills">
                            <label for="capability_digital_customer2">Using computers or online services</label>
                        </div>
                    </div>
                    <div class="details-section" id="capabilityDetailsCustomer2">
                        <label for="capability_details_text_customer2">Please provide any additional details:</label>
                        <textarea id="capability_details_text_customer2" name="capability_details_customer2"></textarea>
                    </div>
                </div>

                <!-- Question 4: Communication Preferences -->
                <div class="form-group">
                    <label>How can we best communicate with you?</label>
                    <div class="checkbox-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="comm_large_print_customer2" name="communication_preferences_customer2" value="large_print">
                            <label for="comm_large_print_customer2">Large print documents</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="comm_braille_customer2" name="communication_preferences_customer2" value="braille">
                            <label for="comm_braille_customer2">Braille</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="comm_audio_customer2" name="communication_preferences_customer2" value="audio">
                            <label for="comm_audio_customer2">Audio format</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="comm_simple_customer2" name="communication_preferences_customer2" value="simple_language">
                            <label for="comm_simple_customer2">Simple, clear language</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="comm_extra_time_customer2" name="communication_preferences_customer2" value="extra_time">
                            <label for="comm_extra_time_customer2">Extra time to understand information</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="comm_third_party_customer2" name="communication_preferences_customer2" value="third_party">
                            <label for="comm_third_party_customer2">Include a third party in communications</label>
                        </div>
                    </div>
                    <div class="details-section" id="commDetailsCustomer2">
                        <label for="comm_details_text_customer2">Please provide any additional details or preferences:</label>
                        <textarea id="comm_details_text_customer2" name="communication_details_customer2"></textarea>
                    </div>
                </div>

                <!-- Question 5: Third Party Support -->
                <div class="form-group">
                    <label>Would you like to nominate someone to receive copies of correspondence or help you manage your account?</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="third_party_support_customer2" value="yes">
                            Yes
                        </label>
                        <label>
                            <input type="radio" name="third_party_support_customer2" value="no">
                            No
                        </label>
                    </div>
                    <div class="details-section" id="thirdPartyDetailsCustomer2">
                        <label for="third_party_name_customer2">Third Party Name:</label>
                        <input type="text" id="third_party_name_customer2" name="third_party_name_customer2" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; margin-bottom: 15px;">
                        
                        <label for="third_party_relationship_customer2">Relationship to you:</label>
                        <input type="text" id="third_party_relationship_customer2" name="third_party_relationship_customer2" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; margin-bottom: 15px;">
                        
                        <label for="third_party_contact_customer2">Contact Details:</label>
                        <textarea id="third_party_contact_customer2" name="third_party_contact_customer2" style="min-height: 60px;"></textarea>
                    </div>
                    <span class="error-message">Please select an option</span>
                </div>
            </div>

            <div class="button-group">
                <button type="button" class="btn-secondary" onclick="window.history.back()">Previous</button>
                <button type="submit" class="btn-primary">Continue</button>
            </div>
        </form>
    </div>

    <script>
        // Check URL parameters for joint application
        const urlParams = new URLSearchParams(window.location.search);
        const isJoint = urlParams.get('joint') === 'true';

        // Show customer 2 section if joint application
        if (isJoint) {
            document.getElementById('customer2Section').style.display = 'block';
            
            // Make customer 2 third party support required
            const customer2Radio = document.querySelector('input[name="third_party_support_customer2"]');
            if (customer2Radio) {
                customer2Radio.setAttribute('required', 'required');
            }
        }

        // Pre-populate form from URL parameters
        window.addEventListener('DOMContentLoaded', function() {
            const params = new URLSearchParams(window.location.search);
            
            params.forEach((value, key) => {
                // Handle checkboxes
                const checkbox = document.querySelector(`input[name="${key}"][value="${value}"]`);
                if (checkbox && checkbox.type === 'checkbox') {
                    checkbox.checked = true;
                }
                
                // Handle radio buttons
                const radio = document.querySelector(`input[name="${key}"][value="${value}"]`);
                if (radio && radio.type === 'radio') {
                    radio.checked = true;
                    // Trigger change event to show details section if needed
                    radio.dispatchEvent(new Event('change'));
                }
                
                // Handle text inputs and textareas
                const textInput = document.querySelector(`[name="${key}"]`);
                if (textInput && (textInput.tagName === 'TEXTAREA' || textInput.tagName === 'INPUT')) {
                    textInput.value = value;
                }
            });
        });

        // Show/hide details sections based on checkbox selections
        function setupCheckboxLogic(checkboxGroupName, noneCheckboxId, detailsSectionId) {
            const checkboxes = document.querySelectorAll(`input[name="${checkboxGroupName}"]`);
            const noneCheckbox = document.getElementById(noneCheckboxId);
            const detailsSection = document.getElementById(detailsSectionId);

            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    if (this.value === 'none' && this.checked) {
                        // Uncheck all other checkboxes
                        checkboxes.forEach(cb => {
                            if (cb !== this) cb.checked = false;
                        });
                        detailsSection.classList.remove('active');
                    } else if (this.checked && this.value !== 'none') {
                        // Uncheck 'none' if any other checkbox is checked
                        if (noneCheckbox) noneCheckbox.checked = false;
                        detailsSection.classList.add('active');
                    }

                    // Hide details if no non-'none' checkboxes are checked
                    const anyChecked = Array.from(checkboxes).some(cb => 
                        cb.checked && cb.value !== 'none'
                    );
                    if (!anyChecked) {
                        detailsSection.classList.remove('active');
                    }
                });
            });
        }

        // Setup checkbox logic for customer 1
        setupCheckboxLogic('health_conditions', 'health_none', 'healthDetails');
        setupCheckboxLogic('life_events', 'life_none', 'lifeDetails');
        setupCheckboxLogic('capability_issues', 'capability_none', 'capabilityDetails');
        setupCheckboxLogic('communication_preferences', null, 'commDetails');

        // Setup for customer 2 if joint
        if (isJoint) {
            setupCheckboxLogic('health_conditions_customer2', 'health_none_customer2', 'healthDetailsCustomer2');
            setupCheckboxLogic('life_events_customer2', 'life_none_customer2', 'lifeDetailsCustomer2');
            setupCheckboxLogic('capability_issues_customer2', 'capability_none_customer2', 'capabilityDetailsCustomer2');
            setupCheckboxLogic('communication_preferences_customer2', null, 'commDetailsCustomer2');
        }

        // Show/hide third party details based on radio selection
        document.querySelectorAll('input[name="third_party_support"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const detailsSection = document.getElementById('thirdPartyDetails');
                if (this.value === 'yes') {
                    detailsSection.classList.add('active');
                } else {
                    detailsSection.classList.remove('active');
                }
            });
        });

        if (isJoint) {
            document.querySelectorAll('input[name="third_party_support_customer2"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const detailsSection = document.getElementById('thirdPartyDetailsCustomer2');
                    if (this.value === 'yes') {
                        detailsSection.classList.add('active');
                    } else {
                        detailsSection.classList.remove('active');
                    }
                });
            });
        }

        // Form submission
        document.getElementById('vulnerableClientsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            let isValid = true;
            const errorMessages = document.querySelectorAll('.error-message');
            errorMessages.forEach(msg => msg.style.display = 'none');

            // Validate third party support selection for customer 1
            const thirdPartyChecked = document.querySelector('input[name="third_party_support"]:checked');
            if (!thirdPartyChecked) {
                isValid = false;
                document.querySelector('input[name="third_party_support"]')
                    .closest('.form-group')
                    .querySelector('.error-message').style.display = 'block';
            }

            // Validate third party support selection for customer 2 if joint
            if (isJoint) {
                const thirdPartyChecked2 = document.querySelector('input[name="third_party_support_customer2"]:checked');
                if (!thirdPartyChecked2) {
                    isValid = false;
                    document.querySelector('input[name="third_party_support_customer2"]')
                        .closest('.form-group')
                        .querySelector('.error-message').style.display = 'block';
                }
            }

            if (isValid) {
                // Collect form data
                const formData = new FormData(this);
                const params = new URLSearchParams(window.location.search);
                
                // Add all form data to params
                for (let [key, value] of formData.entries()) {
                    params.set(key, value);
                }

                // Navigate to next module
                window.location.href = 'module_employment.html?' + params.toString();
            } else {
                // Scroll to first error
                const firstError = document.querySelector('.error-message[style*="block"]');
                if (firstError) {
                    firstError.closest('.form-group').scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        });
    </script>
</body>
</html>
